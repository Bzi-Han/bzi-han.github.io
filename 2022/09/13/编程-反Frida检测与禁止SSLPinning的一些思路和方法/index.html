<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>[ç¼–ç¨‹] åFridaæ£€æµ‹ä¸ç¦æ­¢SSLPinningçš„ä¸€äº›æ€è·¯å’Œæ–¹æ³•</title><meta name="description" content="Bzi-Han's blog, Bzi-Hançš„åšå®¢"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="æŠ›ç –å¼•ç‰ã€‚
å‰è¨€æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚
å·¥å…·
Visual Studio Code
Frida

ç®€è¦ä»‹ç»Fridaå®˜æ–¹è§£é‡Šï¼š

Itâ€™s Greasemonkey for native apps, or, put in more technical terms, itâ€™s a dynamic code instrumentation toolkit. It lets you inject snippets of JavaScript or your own library into native apps on Windows, macOS, GNU&amp;#x2F;Linux, iOS, Android, and QNX. Frida also provides you wit.."><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Bzi-Hançš„åšå®¢" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Bzi-Han's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">[ç¼–ç¨‹] åFridaæ£€æµ‹ä¸ç¦æ­¢SSLPinningçš„ä¸€äº›æ€è·¯å’Œæ–¹æ³•</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-text">å·¥å…·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D"><span class="toc-text">ç®€è¦ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida"><span class="toc-text">Frida</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSLPinning"><span class="toc-text">SSLPinning</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida%E6%A3%80%E6%B5%8B"><span class="toc-text">Fridaæ£€æµ‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8SSLPinning"><span class="toc-text">ç¦ç”¨SSLPinning</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-text">éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E6%AD%A2SSLPinning"><span class="toc-text">é˜²æ­¢SSLPinning</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8DFrida%E6%A3%80%E6%B5%8B"><span class="toc-text">åFridaæ£€æµ‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-text">æ€è€ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-text">ç»“è¯­</span></a></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">[ç¼–ç¨‹] åFridaæ£€æµ‹ä¸ç¦æ­¢SSLPinningçš„ä¸€äº›æ€è·¯å’Œæ–¹æ³•</h1><time class="has-text-grey" datetime="2022-09-12T23:49:23.000Z">2022-09-13</time><article class="mt-2 post-content"><p>æŠ›ç –å¼•ç‰ã€‚</p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p>
<h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ol>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/" title="Visual Studio Code Official">Visual Studio Code</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/frida/frida" title="Frida Official">Frida</a></li>
</ol>
<h2 id="ç®€è¦ä»‹ç»"><a href="#ç®€è¦ä»‹ç»" class="headerlink" title="ç®€è¦ä»‹ç»"></a>ç®€è¦ä»‹ç»</h2><h3 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h3><p><a target="_blank" rel="noopener" href="https://frida.re/docs/home/">å®˜æ–¹è§£é‡Š</a>ï¼š</p>
<blockquote>
<p>Itâ€™s Greasemonkey for native apps, or, put in more technical terms, itâ€™s a dynamic code instrumentation toolkit. It lets you inject snippets of JavaScript or your own library into native apps on Windows, macOS, GNU&#x2F;Linux, iOS, Android, and QNX. Frida also provides you with some simple tools built on top of the Frida API. These can be used as-is, tweaked to your needs, or serve as examples of how to use the API.</p>
</blockquote>
<p>ç®€å•æ¥è¯´æœ€ä¸»è¦çš„ç‰¹è‰²å°±æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¯ä»¥ä½¿ç”¨<code>JavaScript</code>ä»£ç ç‰‡æ®µæ¥è¿›è¡Œ<code>ç¨‹åºå®‰å…¨æµ‹è¯•</code>çš„å·¥å…·é›†ï¼Œå¹¶æä¾›è¾ƒå¤šçš„æ˜“ç”¨APIä¸å„ç§å¼ºå¤§çš„ç‰¹æ€§ã€‚</p>
<h3 id="SSLPinning"><a href="#SSLPinning" class="headerlink" title="SSLPinning"></a>SSLPinning</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“é€šè¿‡å®‰è£…ä¼ªé€ çš„è¯ä¹¦ä¸ä¸­é—´äººæ”»å‡»å¯ä»¥è½»æ¾çš„æŠ“å–HTTPSçš„åŠ å¯†æµé‡ä¿¡æ¯ï¼Œå¦‚<a target="_blank" rel="noopener" href="https://mitmproxy.org/">mitmproxy</a>ã€<a target="_blank" rel="noopener" href="https://www.charlesproxy.com/">Charles</a>ã€<a target="_blank" rel="noopener" href="https://www.telerik.com/fiddler">Fiddler</a>ç­‰å·¥å…·éƒ½æ˜¯åŸºäºè¿™ä¸ªåŸç†ã€‚</p>
<p>è€ŒSSLPinningå°±æ˜¯å¯¹äºHTTPSåè®®çš„åä¸­é—´äººæ”»å‡»çš„ä¸€ç§æ‰‹æ®µã€‚å°†æœåŠ¡å™¨è¿”å›çš„è¯ä¹¦ä¸æœ¬åœ°å®¢æˆ·ç«¯çš„è¯ä¹¦è¿›è¡Œæ ¡éªŒï¼Œå¦‚ä¸ä¸€è‡´åˆ™ä¸­æ–­è¿æ¥ã€‚</p>
<h3 id="Fridaæ£€æµ‹"><a href="#Fridaæ£€æµ‹" class="headerlink" title="Fridaæ£€æµ‹"></a>Fridaæ£€æµ‹</h3><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯APPä¸­åŒ…å«äº†æœ‰ä¸“é—¨ç”¨æ¥æ£€æµ‹Fridaæ˜¯å¦é™„åŠ äº†æˆ–æ­£åœ¨è°ƒè¯•è‡ªèº«è¿›ç¨‹çš„ä»£ç ã€‚å¦‚æœæœ‰æ£€æµ‹åˆ°çš„è¯è½»åˆ™APPé—ªé€€ï¼Œé‡åˆ™å°å·ã€‚å¦‚ä¸€äº›æ¸¸æˆçš„åä½œå¼Šå¼•æ“å°±ä¼šæ£€æµ‹Fridaï¼Œè¿æ°”ä¸å¥½å°±ä¼šè¢«å°ï¼Œä½†éæ¸¸æˆçš„å¤§éƒ¨åˆ†APPåªåšé—ªé€€å¤„ç†ã€‚</p>
<h3 id="ç¦ç”¨SSLPinning"><a href="#ç¦ç”¨SSLPinning" class="headerlink" title="ç¦ç”¨SSLPinning"></a>ç¦ç”¨SSLPinning</h3><p>é€šè¿‡Hookä¹‹ç±»çš„æ–¹å¼åœ¨è¯ä¹¦è·å–ç¯èŠ‚è¿”å›ä¸€ä¸ªç©ºçš„è¯ä¹¦ç®¡ç†å™¨ï¼Œä»è€Œå®ç°ä¸è®©å®¢æˆ·ç«¯æ ¡éªŒæˆ–è€…é€šè¿‡Hookå…³é”®æ ¡éªŒå‡½æ•°å¹¶è¿”å›<code>true</code>æ¥å®ç°æ ¡éªŒæˆåŠŸã€‚</p>
<h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>ç°å¦‚ä»Šçš„APPåªè¦æ˜¯æ­£ç»ä¸€ç‚¹çš„åŸºæœ¬ä¸Šéƒ½ä¼šä½¿ç”¨SSLPinningæ¥é˜²æ­¢ç”¨æˆ·è½»æ¾çš„æŠ“å–HTTPSæµé‡ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœè¦æŠ“åŒ…çš„è¯å°±å¿…é¡»å¾—æŠŠSSLPinningå¹²æ‰ã€‚</p>
<p>å¯¹äºå¦‚ä½•å¹²æ‰SSLPinningå…¶å®å·²ç»æœ‰å¾ˆå¤šçš„å¼€æºé¡¹ç›®äº†ã€‚æœ‰åŸºäº<code>Xposed</code>çš„ã€<code>LSPosed</code>çš„ï¼Œç”šè‡³<code>Magisk</code>çš„ï¼Œä½†è¿™äº›éƒ½å­˜åœ¨ä¸€å®šçš„å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰‹æœºå˜ç –é‚£çœŸçš„æ˜¯å¸¸æ€äº†ã€‚</p>
<p>è€ŒFridaçš„è¯åˆ™åªéœ€è¦æœ‰rootæƒé™å³å¯ï¼Œè¿™ä¹Ÿæ˜¯é€‰æ‹©Fridaçš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚ä½†Fridaåˆå±äºæ£€æµ‹çš„é‡ç‚¹ç…§é¡¾å¯¹è±¡ä¹‹ä¸€ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œ<code>Anti Anti-Frida</code>ã€‚</p>
<h2 id="é˜²æ­¢SSLPinning"><a href="#é˜²æ­¢SSLPinning" class="headerlink" title="é˜²æ­¢SSLPinning"></a>é˜²æ­¢SSLPinning</h2><pre><code>/**
 * ä¿®æ”¹é»˜è®¤ä¸´æ—¶æ–‡ä»¶åå‰ç¼€
 * @see https://github.com/frida/frida-java-bridge/blob/main/lib/class-factory.js#L103
*/
if (&#39;frida&#39; === Java.classFactory.tempFileNaming.prefix)
    Java.classFactory.tempFileNaming.prefix = &#39;gc&#39;;

Java.perform(() =&gt; &#123;
    const X509TrustManager = Java.use(&quot;javax.net.ssl.X509TrustManager&quot;);
    const SSLContext = Java.use(&quot;javax.net.ssl.SSLContext&quot;);

    // æ³¨å†Œä¸ªå‡çš„TrustManagerç±»
    const TrustManager = Java.registerClass(&#123;
        implements: [X509TrustManager],
        methods: &#123;
            checkClientTrusted(chain, authType) &#123; &#125;,
            checkServerTrusted(chain, authType) &#123; &#125;,
            getAcceptedIssuers() &#123;
                return [];
            &#125;,
        &#125;,
        name: &quot;com.network.TrustManager&quot;,
    &#125;);
    // åˆ›å»ºç”¨æ¥æ›¿æ¢çš„TrustManagerå¯¹è±¡æ•°ç»„
    const trustManagers = [TrustManager.$new()];

    const SSLContextInit = SSLContext.init.overload(
        &quot;[Ljavax.net.ssl.KeyManager;&quot;,
        &quot;[Ljavax.net.ssl.TrustManager;&quot;,
        &quot;java.security.SecureRandom&quot;
    );
    // Hook SSLContext.init æ–¹æ³•
    SSLContextInit.implementation = function (keyManager, trustManager, secureRandom) &#123;
        console.log(&#39;[=] Intercepted SSLContext.init()&#39;);
    
        // æ›¿æ¢å‡çš„TrustManagers
        SSLContextInit.call(this, keyManager, trustManagers, secureRandom);
    &#125;;
&#125;);
</code></pre>
<p>è¿™é‡Œåªåšäº†ä¸€ä¸ªæœ€åŸºæœ¬çš„é˜²æ­¢SSLPinningæ ¡éªŒçš„æ¼”ç¤ºï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„è¯æ¨èæŸ¥çœ‹<a target="_blank" rel="noopener" href="https://github.com/sensepost/objection/blob/master/agent/src/android/pinning.ts">objection</a>çš„å®ç°ã€‚</p>
<h2 id="åFridaæ£€æµ‹"><a href="#åFridaæ£€æµ‹" class="headerlink" title="åFridaæ£€æµ‹"></a>åFridaæ£€æµ‹</h2><pre><code>let i = 0;

Interceptor.attach(Module.findExportByName(&#39;libc.so&#39;, &#39;strstr&#39;), &#123;
    onEnter(args) &#123;
        this.fridaDetection = false;
        const haystack = Memory.readCString(args[0]).toLowerCase();
        const needle = Memory.readCString(args[1]).toLowerCase();

        if (-1 !== haystack.indexOf(needle) &amp;&amp; (
            -1 !== haystack.indexOf(&#39;frida&#39;) || // fridaç›¸å…³çš„å­—ç¬¦ä¸²
            -1 !== haystack.indexOf(&#39;gdbus&#39;) || // dbusçº¿ç¨‹å
            -1 !== haystack.indexOf(&#39;gum-js-loop&#39;) || // gumjsçº¿ç¨‹å
            -1 !== haystack.indexOf(&#39;gmain&#39;) || // valaçº¿ç¨‹å
            -1 !== haystack.indexOf(&#39;linjector&#39;) || // å‘½åç®¡é“ç›¸å…³
            -1 !== needle.indexOf(&#39;/data/local/tmp&#39;)) // ç›®å½•æ£€æµ‹
        ) &#123;
            this.fridaDetection = true;

            if (100 &gt; i) &#123;
                console.log(
                    `[=] æ£€æµ‹ä½ ğŸå‘¢\n` +
                    `    haystack: $&#123;haystack&#125;\n` +
                    `    needle: $&#123;needle&#125;\n` +
                    `    i: $&#123;i++&#125;\n`
                );
            &#125; else &#123;
                const detectionModule = Process.findModuleByAddress(this.returnAddress);

                console.log(
                    `[=] æ£€æµ‹ä½ ğŸå‘¢\n` +
                    `    haystack: $&#123;haystack&#125;\n` +
                    `    moduleName: $&#123;detectionModule ? detectionModule.name : &#39;null&#39;&#125;\n` +
                    `    modulePath: $&#123;detectionModule ? detectionModule.path : &#39;null&#39;&#125;\n` +
                    `    moduleBase: $&#123;detectionModule ? detectionModule.base : &#39;null&#39;&#125; moduleSize: $&#123;detectionModule ? detectionModule.size : &#39;null&#39;&#125;\n` +
                    `    detectionPointOffset: $&#123;detectionModule ? this.returnAddress.sub(detectionModule.base) : this.returnAddress&#125;\n`
                );
            &#125;
        &#125;
    &#125;,
    onLeave(retval) &#123;
        if (this.fridaDetection)
            retval.replace(0);
    &#125;
&#125;);
</code></pre>
<p>åœ¨è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬é€šè¿‡Hook<code>libc</code>ä¸­çš„<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/c/string/byte/strstr">strstr</a>å‡½æ•°æ¥å®ç°ç®€æ˜“çš„è¿‡æ£€æµ‹ï¼Œç©¶å…¶åŸå› æ˜¯å› ä¸ºä¸ç®¡ä½ ç”¨å•¥æ–¹æ³•ï¼ŒåŸºäºå­—ç¬¦ä¸²æŸ¥æ‰¾çš„æ£€æµ‹æœ€ç»ˆè¿˜æ˜¯å¾—è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯è¿™ç§æ–¹æ³•ä¸æ˜¯è‚¯å®šèƒ½è¿‡ï¼Œåªæ˜¯é€‚ç”¨éƒ¨åˆ†æƒ…å†µã€‚å¾ˆå¤šç”¨å¿ƒç‚¹åšçš„æ£€æµ‹æ˜¯å¯ä»¥è½»æ¾ç»•è¿‡è¿™ä»½ä»£ç çš„ï¼Œå½“ç„¶ä¹Ÿèƒ½Anti Antiå°±æ˜¯äº†ï¼Œè¿™éƒ¨åˆ†æ”¾åœ¨åé¢å†è¯´ï¼Œå…ˆæ¥çœ‹çœ‹ä»£ç æ•ˆæœã€‚</p>
<p>æœªåŠ è½½è„šæœ¬æ—¶å¯¹è¿›ç¨‹é™„åŠ Frida</p>
<p><img src="/images/1650222130.jpg" alt="UnAntiAntiFrida"></p>
<p>åŠ è½½åFridaæ£€æµ‹è„šæœ¬åå¯¹è¿›ç¨‹é™„åŠ Frida</p>
<p><img src="/images/1650222131.jpg" alt="AntiAntiFrida"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æœªåŠ è½½è„šæœ¬ä¹‹å‰æˆ‘ä»¬é™„åŠ åˆ°è¿›ç¨‹ä¹‹åæ˜¯ä¼šç›´æ¥è¢«å¸è½½æ‰çš„ï¼Œè€ŒåŠ è½½ä¹‹ååˆ™å¯ä»¥æ­£å¸¸é™„åŠ ï¼Œå¹¶ä¸”Frida APIçš„è°ƒç”¨ä¹Ÿæ­£å¸¸ã€‚</p>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>ä¸Šé¢è¯´åˆ°ä¸¾ä¾‹çš„è¿™ç§æ–¹æ³•åªé€‚ç”¨äºåŸºäºå­—ç¬¦ä¸²åŒ¹é…çš„Fridaç‰¹å¾æ£€æµ‹çš„æƒ…å†µï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±ä¸¾å‡ºä¸€äº›ä¸é€‚ç”¨çš„æƒ…å†µä»¥åŠä¸€äº›åæ£€æµ‹çš„æ€è·¯ã€‚åˆ—ä¸¾çš„ä¸€äº›æƒ…å†µä»…ä¸ºæˆ‘æ‰€çŸ¥é“çš„ï¼Œå¦‚æœä½ çŸ¥é“æ›´å¤šçš„è¯·å‘Šè¯‰æˆ‘ã€‚</p>
<p><img src="/images/sticker_genius.gif" alt="nice"></p>
<ol>
<li>è‡ªå·±ç¼–å†™æ‰§è¡Œ<code>syscall</code>çš„æ±‡ç¼–ä»£ç æ¥ä»£æ›¿å¯¹äºlibcä¸­å‡½æ•°çš„è°ƒç”¨ã€‚</li>
<li>ä½¿ç”¨è‡ªå·±å®ç°çš„æ¨¡å¼åŒ¹é…ç®—æ³•ã€‚</li>
<li>æ‰«æå¯æ‰§è¡Œæ–‡ä»¶æ‰€å±å†…å­˜å—ï¼Œå¹¶æš´åŠ›åŒ¹é…fridaç›¸å…³ç‰¹å¾ã€‚</li>
<li>å¯¹æŒ‡å®šlibè¿›è¡Œç›‘æ§ï¼Œå¾ªç¯è®¡ç®—<code>checksum</code>å¹¶æ ¡éªŒï¼Œå¦‚æœå¯¹ä¸ä¸Šè¯´æ˜è¢«ä¿®æ”¹æˆ–è€…Hookäº†ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒæš´åŠ›æ— å·®åˆ«ã€‚</li>
<li>å¯¹æŒ‡å®šå‡½æ•°å¤´éƒ¨å‡ ä¸ªå­—èŠ‚è¿›è¡Œæ‰«æï¼Œæ£€æµ‹æ˜¯å¦è¢«Hookä»¥åŠç‰¹å¾æ˜¯å¦ä¸ºFridaæ‰€å±ã€‚</li>
</ol>
<p>å¯¹äºå…¶ä¸­<code>2</code>ã€<code>4</code>ã€<code>5</code>ä¸‰ç§æƒ…å†µç›®å‰æˆ‘å¹¶æ²¡æœ‰æ€è·¯ï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ³•å°±æ˜¯æ‰¾åˆ°æ£€æµ‹ç‚¹ç›´æ¥æŠŠæ£€æµ‹åšæ‰ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>1</code>ã€<code>3</code>æƒ…å†µçš„å¤„ç†æ–¹å¼ï¼Œå¯¹äºè¿™ä¸¤ç§æƒ…å†µæœ‰ä¸€ä¸ªé€šç”¨çš„åšæ³•ã€‚å³é€šè¿‡<code>ptrace(PTRACE_SYSCALL)</code>çš„æ–¹å¼æ¥ç›‘å¬APPçš„<code>syscall</code>è°ƒç”¨ï¼Œå¹¶æ‹¦æˆªå‡½æ•°åºå·<code>__NR_openat</code>(å¯¹åº”ä¸ºlibcä¸­çš„openatå‡½æ•°)ã€‚</p>
<p>ç›¸å…³å‡½æ•°ä¸å®åœ¨<code>linux/ptrace.h</code>ä¸<code>fcntl.h</code>ä¸­æœ‰å®šä¹‰ã€‚åœ¨æ‹¦æˆªåˆ°ç›¸å…³è°ƒç”¨çš„æ—¶å€™æ£€æŸ¥è°ƒç”¨å‚æ•°<code>pathname</code>æ˜¯å¦åŒ…å«<code>/proc/self/</code>ï¼Œå¦‚æœåŒ…å«åˆ™å–æ¶ˆè°ƒç”¨å¹¶å°†è¿”å›å€¼ä¹Ÿå³<code>fd</code>æ”¹ä¸ºæˆ‘ä»¬æå‰å‡†å¤‡å¥½çš„å»æ‰fridaç‰¹å¾çš„ç›¸å…³ä¸´æ—¶æ–‡ä»¶çš„<code>fd</code>ã€‚</p>
<p>è¿™æ ·å½“ç¨‹åºåœ¨å¯¹æ‰“å¼€çš„ä¿¡æ¯æµè¿›è¡Œæ‰«æçš„æ—¶å€™å°±å‘ç°ä¸äº†fridaäº†ã€‚</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åˆ°è¿™é‡Œæ–‡ç« å°±ç»“æŸäº†ï¼Œè¿·è¿·ç³Šç³Šçš„ä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰è¯´æ¸…æ¥šï¼Œ<del>åˆæ°´äº†ä¸€ç¯‡æ–‡ç« </del>ã€‚</p>
<p>é‚£ä¹ˆæœ‰ç¼˜å†è§~</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2022/09/15/%E9%80%86%E5%90%91-%E7%B1%B3%E6%B8%B8%E7%A4%BE%E5%8E%9F%E7%A5%9E%E6%AF%8F%E6%97%A5%E7%AD%BE%E5%88%B0%E4%B9%8BDS%E7%AE%97%E6%B3%95/" title="[é€†å‘] ç±³æ¸¸ç¤¾åŸç¥æ¯æ—¥ç­¾åˆ°ä¹‹DSç®—æ³•"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">ä¸Šä¸€é¡µ: [é€†å‘] ç±³æ¸¸ç¤¾åŸç¥æ¯æ—¥ç­¾åˆ°ä¹‹DSç®—æ³•</span></a><a class="button is-default" href="/2022/07/02/%E9%A1%B9%E7%9B%AE-Taskcloud%E5%9F%BA%E6%9C%AC%E9%87%8D%E6%9E%84%E5%AE%8C%E6%88%90%E4%B8%8E%E5%90%8E%E7%BB%AD%E5%A1%AB%E5%9D%91%E8%AE%B0%E5%BD%95%E8%AE%A1%E5%88%92%E8%B4%B4/" title="[é¡¹ç›®] TaskcloudåŸºæœ¬é‡æ„å®Œæˆä¸åç»­å¡«å‘è®°å½•è®¡åˆ’è´´"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: [é¡¹ç›®] TaskcloudåŸºæœ¬é‡æ„å®Œæˆä¸åç»­å¡«å‘è®°å½•è®¡åˆ’è´´</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Bzi-Han/bzi-han.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Bzi-Han"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p><span>Copyright Â©</span><span> Bzi-Han 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>