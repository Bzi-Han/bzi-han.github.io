<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bzi-Hançš„åšå®¢</title>
  
  <subtitle>Bzi-Han&#39;s blog</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-09-15T07:10:18.634Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Bzi-Han</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[é€†å‘] ç±³æ¸¸ç¤¾åŸç¥æ¯æ—¥ç­¾åˆ°ä¹‹DSç®—æ³•</title>
    <link href="http://example.com/2022/09/15/%E9%80%86%E5%90%91-%E7%B1%B3%E6%B8%B8%E7%A4%BE%E5%8E%9F%E7%A5%9E%E6%AF%8F%E6%97%A5%E7%AD%BE%E5%88%B0%E4%B9%8BDS%E7%AE%97%E6%B3%95/"/>
    <id>http://example.com/2022/09/15/%E9%80%86%E5%90%91-%E7%B1%B3%E6%B8%B8%E7%A4%BE%E5%8E%9F%E7%A5%9E%E6%AF%8F%E6%97%A5%E7%AD%BE%E5%88%B0%E4%B9%8BDS%E7%AE%97%E6%B3%95/</id>
    <published>2022-09-15T02:36:45.000Z</published>
    <updated>2022-09-15T07:10:18.634Z</updated>
    
    <content type="html"><![CDATA[<p>æ¼ç­¾çœŸçš„å¾ˆçƒ¦ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ol><li><a href="https://www.telerik.com/fiddler" title="Fiddler Official">Fiddler</a></li><li><a href="https://github.com/skylot/jadx" title="JADX Official">JADX</a></li><li><a href="https://hex-rays.com/" title="IDA Official">IDA</a></li><li><a href="https://github.com/frida/frida" title="Frida Official">Frida</a></li></ol><h2 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h2><p><img src="/images/1650222132.jpg" alt="ç­¾åˆ°åŒ…å†…å®¹"></p><h2 id="é‡æ”¾æµ‹è¯•"><a href="#é‡æ”¾æµ‹è¯•" class="headerlink" title="é‡æ”¾æµ‹è¯•"></a>é‡æ”¾æµ‹è¯•</h2><p>ä½¿ç”¨<code>Shift + R</code>è¿›è¡Œä¸€ä¸ªåŒ…çš„é‡æ”¾ã€‚</p><p><img src="/images/1650222133.jpg" alt="é‡æ”¾æµ‹è¯•ç»“æœ"></p><p>æ²¡æœ‰é—®é¢˜ï¼Œè¿™å…¶ä¸­æœ‰ä¸ª<code>DS</code>å‚æ•°çœ‹èµ·æ¥æŒºå¯ç–‘çš„ï¼Œå»æ‰å†è¯•è¯•ã€‚</p><p><img src="/images/1650222134.jpg" alt="é‡æ”¾æµ‹è¯•ç»“æœ"></p><p>æœåŠ¡å™¨ç›´æ¥ä¸è®¤äº†ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šè¿™å°±æ˜¯ä¸ªæ—¶é—´æˆ³ç­¾åä¿¡æ¯ã€‚</p><h2 id="JADX"><a href="#JADX" class="headerlink" title="JADX"></a>JADX</h2><p>å°†apkæ‹–è¿›<code>jadx</code>å¹¶ç­‰å¾…åˆ†æå®Œæˆåæ‰“å¼€æœç´¢çª—å£ç›´æ¥æœç´¢<code>DS</code>å…³é”®å­—</p><p><img src="/images/1650222135.jpg" alt="æœç´¢ç»“æœ"></p><p>ç„¶åå•¥ä¹Ÿæ²¡æœåˆ°ï¼Œé‚£ä¹ˆæ¢ä¸ª<code>&quot;DS&quot;</code>å…³é”®å­—</p><p><img src="/images/1650222136.jpg" alt="æœç´¢ç»“æœ"></p><p>çœ‹åˆ°å‡ ä¸ªå¯ç–‘çš„ç›®æ ‡ï¼Œæ¯”å¦‚è¿™ä¸ªåœˆèµ·æ¥çš„ç±»åå°±å«åš<code>GetDSMethodImpl</code>ï¼Œå¯ä»¥è¯´éå¸¸çš„ç›´æ¥ï¼Œé‚£ä¹ˆè·Ÿè¿‡å»çœ‹çœ‹</p><p><img src="/images/1650222137.jpg" alt="è·Ÿè¸ªç»“æœ"></p><p>ç»è¿‡åˆ†æä»£ç åï¼Œå‘ç°<code>DS</code>æ¥è‡ªä¸è¿™ä¸ªå‡½æ•°ï¼Œç»§ç»­è·Ÿè¿‡å»çœ‹çœ‹</p><p><img src="/images/1650222138.jpg" alt="è·Ÿè¸ªç»“æœ"></p><p>å¯ä»¥çœ‹åˆ°åˆ°è¿™é‡Œå°±å·²ç»è¿›å…¥äº†<code>so</code>å±‚äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¿›å…¥ä¸‹ä¸€å±‚çš„åˆ†æã€‚</p><h2 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h2><p>å…¨éƒ¨çš„ä¼ªä»£ç æ¯”è¾ƒé•¿ï¼Œæˆ‘å°±æˆªå–ä¸€å°éƒ¨åˆ†å…ˆæ¥çœ‹çœ‹</p><pre><code>v4 = (*a1)-&gt;GetStringUTFChars(a1, a3, 0LL); v64 = 0LL;v65 = 0LL;v66 = 0LL;v5 = strlen(v4);                             v6 = v5;if ( v5 &gt;= 0x17 )&#123;    v8 = (v5 + 16) &amp; 0xFFFFFFFFFFFFFFF0LL;    v7 = (char *)operator new(v8);    v65 = v6;    v66 = v7;    v64 = v8 | 1;    goto LABEL_5;&#125;v7 = (char *)&amp;v64 + 1;LOBYTE(v64) = 2 * v5;if ( v5 )LABEL_5:    memcpy(v7, v4, v6);                       v7[v6] = 0;                          gettimeofday(&amp;tv, 0LL);std::to_string((std::__ndk1 *)(v63 / 1000000 + *(_QWORD *)&amp;tv), v9);Random::random((Random *)v58);std::operator+&lt;char&gt;(&quot;salt=&quot;, &amp;v64);v10 = std::string::append((int)&amp;v48, &quot;&amp;t=&quot;, 3u);</code></pre><p>å¯ä»¥çœ‹åˆ°å…¶ä¸­å¤§é‡ä½¿ç”¨äº†<code>std::string::append</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥Hookè¿™ä¸ªå‡½æ•°çœ‹çœ‹ã€‚</p><p>éœ€è¦è¯´æ˜ä¸€ä¸‹çš„æ˜¯ç±³æ¸¸ç¤¾æœ‰<code>Anti-Frida</code>ï¼Œæ‰€ä»¥éœ€è¦åä¸€ä¸‹ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://localhost:4000/2022/09/13/%E7%BC%96%E7%A8%8B-%E5%8F%8DFrida%E6%A3%80%E6%B5%8B%E4%B8%8E%E7%A6%81%E6%AD%A2SSLPinning%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%B7%AF%E5%92%8C%E6%96%B9%E6%B3%95/">åFridaæ£€æµ‹ä¸ç¦æ­¢SSLPinningçš„ä¸€äº›æ€è·¯å’Œæ–¹æ³•</a>ã€‚</p><p>æ¥çœ‹ä¸‹Hookç»“æœ</p><p><img src="/images/1650222139.jpg" alt="Hookç»“æœ"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªç»“æœè·Ÿæˆ‘ä»¬æŠ“åˆ°çš„åŒ…çš„<code>DS</code>å‚æ•°æœ€ç»ˆæ•ˆæœæ˜¯ä¸€è‡´çš„</p><p><code>DS: 1663216865,2bfm47,b6069f6088a02f2ff35b1407034b520c</code></p><p>é‚£ä¹ˆæˆ‘ä»¬æ ¹æ®è¿™ä¸ªç»“æœå†å›åˆ°IDAè¿›è¡Œä¸€æ³¢åˆ†æé€»è¾‘ã€‚</p><p>ç»è¿‡ä¸€ç•ªæ¢³ç†ä¹‹åå¾—åˆ°ä»¥ä¸‹æµç¨‹</p><pre><code>CMD5::CMD5((CMD5 *)&amp;v70);                     // new MD5ç±»</code></pre><hr><pre><code>v4 = (*a1)-&gt;GetStringUTFChars(a1, a3, 0LL);   // è·å–ä¼ è¿›æ¥çš„saltå‚æ•°v64 = 0LL;v65 = 0LL;v66 = 0LL;v5 = strlen(v4);                              // è®¡ç®—saltçš„é•¿åº¦v6 = v5;if ( v5 &gt;= 0x17 )&#123;    v8 = (v5 + 16) &amp; 0xFFFFFFFFFFFFFFF0LL;    v7 = (char *)operator new(v8);    v65 = v6;    v66 = v7;    v64 = v8 | 1;    goto LABEL_5;&#125;v7 = (char *)&amp;v64 + 1;LOBYTE(v64) = 2 * v5;if ( v5 )LABEL_5:    memcpy(v7, v4, v6);                         // copy v4(saltå­—ç¬¦ä¸²)ç»™v64v7[v6] = 0;                                   // ç»“å°¾è®¾\0gettimeofday(&amp;tv, 0LL);std::to_string((std::__ndk1 *)(v63 / 1000000 + *(_QWORD *)&amp;tv), v9);Random::random((Random *)v58);                // ç”Ÿæˆéšæœºå­—ç¬¦ä¸²std::operator+&lt;char&gt;(&quot;salt=&quot;, &amp;v64);          // æ‹¼æ¥salt=ä¼ è¿›æ¥çš„saltv10 = std::string::append((int)&amp;v48, &quot;&amp;t=&quot;, 3u);// æ‹¼æ¥&amp;t=v11 = *(_OWORD *)v10;v51 = *(void **)(v10 + 16);v50 = v11;*(_QWORD *)(v10 + 8) = 0LL;*(_QWORD *)(v10 + 16) = 0LL;*(_QWORD *)v10 = 0LL;if ( (v59 &amp; 1) != 0 )    v12 = v61;else    v12 = v60;if ( (v59 &amp; 1) != 0 )    LODWORD(v13) = *(_DWORD *)&amp;v60[7];else    v13 = (unsigned __int64)v59 &gt;&gt; 1;v14 = std::string::append((int)&amp;v50, v12, v13);// æ‹¼æ¥å½“å‰æ—¶é—´æˆ³v15 = *(_OWORD *)v14;v53 = *(void **)(v14 + 16);v52 = v15;*(_QWORD *)(v14 + 8) = 0LL;*(_QWORD *)(v14 + 16) = 0LL;*(_QWORD *)v14 = 0LL;v16 = std::string::append((int)&amp;v52, &quot;&amp;r=&quot;, 3u);// æ‹¼æ¥&amp;r=v17 = *(_OWORD *)v16;v71 = *(void **)(v16 + 16);v70 = v17;*(_QWORD *)(v16 + 8) = 0LL;*(_QWORD *)(v16 + 16) = 0LL;*(_QWORD *)v16 = 0LL;if ( (v54 &amp; 1) != 0 )    v18 = v57;else    v18 = v55;if ( (v54 &amp; 1) != 0 )    LODWORD(v19) = v56;else    v19 = (unsigned __int64)v54 &gt;&gt; 1;v20 = std::string::append((int)&amp;v70, v18, v19);// æ‹¼æ¥éšæœºå­—ç¬¦ä¸²v21 = *(_WORD *)(v20 + 5);v22 = *(_DWORD *)(v20 + 1);v23 = *(_BYTE *)v20;                          // v23è·å¾—å¾…è®¡ç®—å­—ç¬¦ä¸²æ‰€æœ‰æƒv69 = *(_BYTE *)(v20 + 7);v68 = v21;v67 = v22;v25 = *(_QWORD *)(v20 + 8);v24 = *(void **)(v20 + 16);*(_QWORD *)v20 = 0LL;*(_QWORD *)(v20 + 8) = 0LL;*(_QWORD *)(v20 + 16) = 0LL;</code></pre><hr><pre><code>v40 = 0LL;v41 = 0LL;v42 = 0LL;if ( (v23 &amp; 1) == 0 )&#123;    LOBYTE(v40) = v23;                          // v40è·å¾—å¾…è®¡ç®—å­—ç¬¦ä¸²æ‰€æœ‰æƒ    HIBYTE(v40) = v69;    *(_WORD *)((char *)&amp;v40 + 5) = v68;    *(_DWORD *)((char *)&amp;v40 + 1) = v67;    v41 = v25;    v42 = v24;    goto LABEL_42;&#125;</code></pre><hr><pre><code>CMD5::md5(&amp;v70, &amp;v40);                        // è®¡ç®—v40 md5hashå€¼if ( (v43 &amp; 1) != 0 )    v33 = v45;else    v33 = v44;if ( (v43 &amp; 1) != 0 )    LODWORD(v34) = *(_DWORD *)&amp;v44[7];else    v34 = (unsigned __int64)v43 &gt;&gt; 1;</code></pre><hr><pre><code>sub_13C40((int)&amp;v59, &quot;,&quot;);                    // æ‹¼æ¥ å½“å‰æ—¶é—´æˆ³ + &quot;,&quot;if ( (v54 &amp; 1) != 0 )    v26 = v57;else    v26 = v55;if ( (v54 &amp; 1) != 0 )    LODWORD(v27) = v56;else    v27 = (unsigned __int64)v54 &gt;&gt; 1;v28 = std::string::append((int)&amp;v46, v26, v27);// æ‹¼æ¥éšæœºå­—ç¬¦ä¸²v29 = *(_OWORD *)v28;ptr = *(void **)(v28 + 16);v48 = v29;*(_QWORD *)(v28 + 8) = 0LL;*(_QWORD *)(v28 + 16) = 0LL;*(_QWORD *)v28 = 0LL;v30 = std::string::append((int)&amp;v48, &quot;,&quot;, 1u);// æ‹¼æ¥ ,</code></pre><hr><pre><code>v35 = std::string::append((int)&amp;v50, v33, v34);// æ‹¼æ¥hashå€¼ï¼Œå®Œæˆæ•´ä¸ªç­¾åè¿‡ç¨‹</code></pre><h2 id="è®¡ç®—è¿‡ç¨‹"><a href="#è®¡ç®—è¿‡ç¨‹" class="headerlink" title="è®¡ç®—è¿‡ç¨‹"></a>è®¡ç®—è¿‡ç¨‹</h2><p>å¯èƒ½ä¸Šé¢çœ‹èµ·æ¥ä¼šæœ‰ç‚¹ä¹±ï¼Œæ¥ä¸‹æ¥æ€»ç»“ä¸€ä¸‹å¯¹äº<code>DS</code>çš„è®¡ç®—è¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„</p><pre><code>input saltinput timestampinput randomStringprocess params = &quot;salt=&quot; + salt + &quot;&amp;t=&quot; + timestamp + &quot;&amp;r=&quot; + randomStringoutput hash = md5(params)output DS = timestamp + &quot;,&quot; + randomString + &quot;,&quot; + hash</code></pre><h2 id="ä»£ç éªŒè¯"><a href="#ä»£ç éªŒè¯" class="headerlink" title="ä»£ç éªŒè¯"></a>ä»£ç éªŒè¯</h2><p>æ¥å†™ä¸€ä»½ä»£ç éªŒè¯ä¸€ä¸‹ã€‚</p><pre><code>import hashlibimport timeimport randomsalt = &#39;n0KjuIrKgLHh08LWSCYP0WXlVXaYvV64&#39;# timestamp = str(int(time.time()))timestamp = &#39;1663216865&#39;# randomString = &#39;&#39;.join(random.sample(&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;, 6))randomString = &#39;2bfm47&#39;params = &#39;salt=&#123;&#125;&amp;t=&#123;&#125;&amp;r=&#123;&#125;&#39;.format(salt, timestamp, randomString)md5 = hashlib.md5()md5.update(params.encode(&#39;utf-8&#39;))hash = md5.hexdigest()DS = &#39;&#123;&#125;,&#123;&#125;,&#123;&#125;&#39;.format(timestamp, randomString, hash)print(&#39;DS&#39;, DS)</code></pre><p>è¾“å‡º</p><pre><code>é¢„è®¡è¾“å‡º1663216865,2bfm47,b6069f6088a02f2ff35b1407034b520cå®é™…è¾“å‡ºDS 1663216865,2bfm47,b6069f6088a02f2ff35b1407034b520c</code></pre><p>å¯ä»¥çœ‹åˆ°é¢„æƒ³ä¸å®é™…çš„ç»“æœå®Œå…¨ä¸€è‡´ã€‚</p><h2 id="å®é™…æµ‹è¯•"><a href="#å®é™…æµ‹è¯•" class="headerlink" title="å®é™…æµ‹è¯•"></a>å®é™…æµ‹è¯•</h2><p>æ¥å®é™…å‘ä¸ªåŒ…è¯•è¯•å§</p><p><img src="/images/1650222140.jpg" alt="æµ‹è¯•ç»“æœ"></p><p>å—¯ï¼Œå±…ç„¶ä¸è®¤ã€‚æ ¹æ®ç»“æœçŸ¥é“æˆ‘ä»¬çš„æ¨ç†åº”è¯¥æ˜¯ä¸ä¼šé”™çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å›åˆ°<code>jadx</code>çœ‹çœ‹æ˜¯ä»€ä¹ˆæƒ…å†µã€‚</p><h2 id="å›åˆ°JADX"><a href="#å›åˆ°JADX" class="headerlink" title="å›åˆ°JADX"></a>å›åˆ°JADX</h2><p>å¯¹<code>a2222</code>è¿™ä¸ªå‡½æ•°æŸ¥æ‰¾å¼•ç”¨åçœ‹åˆ°æ˜¯æœ‰ä¸¤ä¸ªåœ°æ–¹çš„</p><p><img src="/images/1650222141.jpg" alt="å¼•ç”¨æƒ…å†µ"></p><p>æ ¹æ®ä»£ç åˆ†æå®ƒä»¬æ‰€ä½¿ç”¨çš„<code>salt</code>éåŒä¸€ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸‹<code>salt</code>çš„æ¥æºã€‚</p><p>ç»è¿‡åˆ†æä¹‹åæˆ‘ä»¬æŠ å‡ºæ¥äº†è¿™æ ·ä¸€æ®µä»£ç </p><pre><code>public class Main &#123;    public static final int[] iArr = &#123;-90, 114, -70, -74, -108, 222, 60, 66, 90, 72, 84, -102, -76, 120, 84, 216, 222, -114, -68, -66, -14348907, 108, 222, 216, -68, 192, -88, -120, 150, -74, 150, -108&#125;;    public static void main(String[] args) &#123;        int i;        StringBuilder sb = new StringBuilder();        ArrayList&lt;Number&gt; arrayList = new ArrayList(iArr.length);        for (int i2 : iArr) &#123;            if (i2 &lt; 0) &#123;                i = ((double) (-i2)) &gt;= Math.pow(3.0d, 6.0d) ? (int) (((Math.log(-((double) i2)) / Math.log(3.0d)) - ((double) 6)) + ((double) 48)) : ~i2;            &#125; else &#123;                i = (i2 / 3) + 48;            &#125;            arrayList.add(Integer.valueOf(i));        &#125;        ArrayList arrayList2 = new ArrayList(arrayList.size());        for (Number number : arrayList) &#123;            sb.append((char) number.intValue());            arrayList2.add(sb);        &#125;        String sb2 = sb.toString();        System.out.println(sb2);    &#125;&#125;</code></pre><p>æ‰§è¡Œåå¾—åˆ°è¾“å‡º</p><pre><code>YVEIkzDFNHLeKXLxzqCA9TzxCpWwbIbk</code></pre><p>ç„¶åæˆ‘ä»¬å°†ä»£ç ä¸­çš„<code>salt</code>æ›¿æ¢ä¸ºè¿™ä¸ªè¾“å‡ºä¹‹åå†æ¥å‘ä¸ªåŒ…è¯•è¯•</p><p><img src="/images/1650222142.jpg" alt="æœ€ç»ˆæµ‹è¯•"></p><p>å—¯ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨å·²ç»è®¤å¯æˆ‘ä»¬çš„åŒ…äº†ï¼Œæ²¡é—®é¢˜ã€‚</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul><li><input disabled="" type="checkbox"> Taskcloudç‰ˆæœ¬çš„è‡ªåŠ¨ç­¾åˆ°è„šæœ¬</li><li><input disabled="" type="checkbox"> æŠ“ç±³æ¸¸å¸æ¯æ—¥ç­¾åˆ°çš„æ¥å£</li><li><input disabled="" type="checkbox"> æŠ“ç±³æ¸¸å¸æµè§ˆ3ä¸ªå¸–å­çš„æ¥å£</li><li><input disabled="" type="checkbox"> æŠ“ç±³æ¸¸å¸ç‚¹èµ5æ¬¡çš„æ¥å£</li><li><input disabled="" type="checkbox"> æŠ“ç±³æ¸¸å¸åˆ†äº«å¸–å­çš„æ¥å£</li></ul><p>è‡ªåŠ¨ç­¾åˆ°è„šæœ¬æ…¢æ…¢å†å†™ï¼Œå› ä¸ºTaskcloudç›®å‰å¥½åƒè¿˜æœ‰ç‚¹é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ²¡ä¿®ã€‚</p><p>ç±³æ¸¸ç¤¾çš„å…¶ä»–æ¥å£<del>å¯èƒ½ä¸æ</del>ã€‚</p><p><img src="/images/sticker_!smart.jpg" alt="!smart"></p><p>å…ˆæ”¾è„šæœ¬çš„ä»“åº“é“¾æ¥ï¼Œä¹‹åå¦‚æœæœ‰æ–°è„šæœ¬çš„è¯éƒ½ä¼šæ›´æ–°åˆ°ä»“åº“é‡Œã€‚</p><p>è„šæœ¬ä»“åº“ï¼š<a href="https://github.com/Bzi-Han/scripts">scripts</a></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åŸç¥çœŸå¥½ç©ï¼Œå˜¿å˜¿ã€‚</p><p>é‚£å°±è¿™æ ·äº†ï¼Œæœ‰ç¼˜å†è§~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ¼ç­¾çœŸçš„å¾ˆçƒ¦ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å·¥å…·&quot;&gt;&lt;a href=&quot;#å·¥</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[ç¼–ç¨‹] åFridaæ£€æµ‹ä¸ç¦æ­¢SSLPinningçš„ä¸€äº›æ€è·¯å’Œæ–¹æ³•</title>
    <link href="http://example.com/2022/09/13/%E7%BC%96%E7%A8%8B-%E5%8F%8DFrida%E6%A3%80%E6%B5%8B%E4%B8%8E%E7%A6%81%E6%AD%A2SSLPinning%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%B7%AF%E5%92%8C%E6%96%B9%E6%B3%95/"/>
    <id>http://example.com/2022/09/13/%E7%BC%96%E7%A8%8B-%E5%8F%8DFrida%E6%A3%80%E6%B5%8B%E4%B8%8E%E7%A6%81%E6%AD%A2SSLPinning%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%B7%AF%E5%92%8C%E6%96%B9%E6%B3%95/</id>
    <published>2022-09-12T23:49:23.000Z</published>
    <updated>2022-09-15T07:10:18.633Z</updated>
    
    <content type="html"><![CDATA[<p>æŠ›ç –å¼•ç‰ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ol><li><a href="https://code.visualstudio.com/" title="Visual Studio Code Official">Visual Studio Code</a></li><li><a href="https://github.com/frida/frida" title="Frida Official">Frida</a></li></ol><h2 id="ç®€è¦ä»‹ç»"><a href="#ç®€è¦ä»‹ç»" class="headerlink" title="ç®€è¦ä»‹ç»"></a>ç®€è¦ä»‹ç»</h2><h3 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h3><p><a href="https://frida.re/docs/home/">å®˜æ–¹è§£é‡Š</a>ï¼š</p><blockquote><p>Itâ€™s Greasemonkey for native apps, or, put in more technical terms, itâ€™s a dynamic code instrumentation toolkit. It lets you inject snippets of JavaScript or your own library into native apps on Windows, macOS, GNU&#x2F;Linux, iOS, Android, and QNX. Frida also provides you with some simple tools built on top of the Frida API. These can be used as-is, tweaked to your needs, or serve as examples of how to use the API.</p></blockquote><p>ç®€å•æ¥è¯´æœ€ä¸»è¦çš„ç‰¹è‰²å°±æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¯ä»¥ä½¿ç”¨<code>JavaScript</code>ä»£ç ç‰‡æ®µæ¥è¿›è¡Œ<code>ç¨‹åºå®‰å…¨æµ‹è¯•</code>çš„å·¥å…·é›†ï¼Œå¹¶æä¾›è¾ƒå¤šçš„æ˜“ç”¨APIä¸å„ç§å¼ºå¤§çš„ç‰¹æ€§ã€‚</p><h3 id="SSLPinning"><a href="#SSLPinning" class="headerlink" title="SSLPinning"></a>SSLPinning</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“é€šè¿‡å®‰è£…ä¼ªé€ çš„è¯ä¹¦ä¸ä¸­é—´äººæ”»å‡»å¯ä»¥è½»æ¾çš„æŠ“å–HTTPSçš„åŠ å¯†æµé‡ä¿¡æ¯ï¼Œå¦‚<a href="https://mitmproxy.org/">mitmproxy</a>ã€<a href="https://www.charlesproxy.com/">Charles</a>ã€<a href="https://www.telerik.com/fiddler">Fiddler</a>ç­‰å·¥å…·éƒ½æ˜¯åŸºäºè¿™ä¸ªåŸç†ã€‚</p><p>è€ŒSSLPinningå°±æ˜¯å¯¹äºHTTPSåè®®çš„åä¸­é—´äººæ”»å‡»çš„ä¸€ç§æ‰‹æ®µã€‚å°†æœåŠ¡å™¨è¿”å›çš„è¯ä¹¦ä¸æœ¬åœ°å®¢æˆ·ç«¯çš„è¯ä¹¦è¿›è¡Œæ ¡éªŒï¼Œå¦‚ä¸ä¸€è‡´åˆ™ä¸­æ–­è¿æ¥ã€‚</p><h3 id="Fridaæ£€æµ‹"><a href="#Fridaæ£€æµ‹" class="headerlink" title="Fridaæ£€æµ‹"></a>Fridaæ£€æµ‹</h3><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯APPä¸­åŒ…å«äº†æœ‰ä¸“é—¨ç”¨æ¥æ£€æµ‹Fridaæ˜¯å¦é™„åŠ äº†æˆ–æ­£åœ¨è°ƒè¯•è‡ªèº«è¿›ç¨‹çš„ä»£ç ã€‚å¦‚æœæœ‰æ£€æµ‹åˆ°çš„è¯è½»åˆ™APPé—ªé€€ï¼Œé‡åˆ™å°å·ã€‚å¦‚ä¸€äº›æ¸¸æˆçš„åä½œå¼Šå¼•æ“å°±ä¼šæ£€æµ‹Fridaï¼Œè¿æ°”ä¸å¥½å°±ä¼šè¢«å°ï¼Œä½†éæ¸¸æˆçš„å¤§éƒ¨åˆ†APPåªåšé—ªé€€å¤„ç†ã€‚</p><h3 id="ç¦ç”¨SSLPinning"><a href="#ç¦ç”¨SSLPinning" class="headerlink" title="ç¦ç”¨SSLPinning"></a>ç¦ç”¨SSLPinning</h3><p>é€šè¿‡Hookä¹‹ç±»çš„æ–¹å¼åœ¨è¯ä¹¦è·å–ç¯èŠ‚è¿”å›ä¸€ä¸ªç©ºçš„è¯ä¹¦ç®¡ç†å™¨ï¼Œä»è€Œå®ç°ä¸è®©å®¢æˆ·ç«¯æ ¡éªŒæˆ–è€…é€šè¿‡Hookå…³é”®æ ¡éªŒå‡½æ•°å¹¶è¿”å›<code>true</code>æ¥å®ç°æ ¡éªŒæˆåŠŸã€‚</p><h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>ç°å¦‚ä»Šçš„APPåªè¦æ˜¯æ­£ç»ä¸€ç‚¹çš„åŸºæœ¬ä¸Šéƒ½ä¼šä½¿ç”¨SSLPinningæ¥é˜²æ­¢ç”¨æˆ·è½»æ¾çš„æŠ“å–HTTPSæµé‡ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœè¦æŠ“åŒ…çš„è¯å°±å¿…é¡»å¾—æŠŠSSLPinningå¹²æ‰ã€‚</p><p>å¯¹äºå¦‚ä½•å¹²æ‰SSLPinningå…¶å®å·²ç»æœ‰å¾ˆå¤šçš„å¼€æºé¡¹ç›®äº†ã€‚æœ‰åŸºäº<code>Xposed</code>çš„ã€<code>LSPosed</code>çš„ï¼Œç”šè‡³<code>Magisk</code>çš„ï¼Œä½†è¿™äº›éƒ½å­˜åœ¨ä¸€å®šçš„å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰‹æœºå˜ç –é‚£çœŸçš„æ˜¯å¸¸æ€äº†ã€‚</p><p>è€ŒFridaçš„è¯åˆ™åªéœ€è¦æœ‰rootæƒé™å³å¯ï¼Œè¿™ä¹Ÿæ˜¯é€‰æ‹©Fridaçš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚ä½†Fridaåˆå±äºæ£€æµ‹çš„é‡ç‚¹ç…§é¡¾å¯¹è±¡ä¹‹ä¸€ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œ<code>Anti Anti-Frida</code>ã€‚</p><h2 id="é˜²æ­¢SSLPinning"><a href="#é˜²æ­¢SSLPinning" class="headerlink" title="é˜²æ­¢SSLPinning"></a>é˜²æ­¢SSLPinning</h2><pre><code>/** * ä¿®æ”¹é»˜è®¤ä¸´æ—¶æ–‡ä»¶åå‰ç¼€ * @see https://github.com/frida/frida-java-bridge/blob/main/lib/class-factory.js#L103*/if (&#39;frida&#39; === Java.classFactory.tempFileNaming.prefix)    Java.classFactory.tempFileNaming.prefix = &#39;gc&#39;;Java.perform(() =&gt; &#123;    const X509TrustManager = Java.use(&quot;javax.net.ssl.X509TrustManager&quot;);    const SSLContext = Java.use(&quot;javax.net.ssl.SSLContext&quot;);    // æ³¨å†Œä¸ªå‡çš„TrustManagerç±»    const TrustManager = Java.registerClass(&#123;        implements: [X509TrustManager],        methods: &#123;            checkClientTrusted(chain, authType) &#123; &#125;,            checkServerTrusted(chain, authType) &#123; &#125;,            getAcceptedIssuers() &#123;                return [];            &#125;,        &#125;,        name: &quot;com.network.TrustManager&quot;,    &#125;);    // åˆ›å»ºç”¨æ¥æ›¿æ¢çš„TrustManagerå¯¹è±¡æ•°ç»„    const trustManagers = [TrustManager.$new()];    const SSLContextInit = SSLContext.init.overload(        &quot;[Ljavax.net.ssl.KeyManager;&quot;,        &quot;[Ljavax.net.ssl.TrustManager;&quot;,        &quot;java.security.SecureRandom&quot;    );    // Hook SSLContext.init æ–¹æ³•    SSLContextInit.implementation = function (keyManager, trustManager, secureRandom) &#123;        console.log(&#39;[=] Intercepted SSLContext.init()&#39;);            // æ›¿æ¢å‡çš„TrustManagers        SSLContextInit.call(this, keyManager, trustManagers, secureRandom);    &#125;;&#125;);</code></pre><p>è¿™é‡Œåªåšäº†ä¸€ä¸ªæœ€åŸºæœ¬çš„é˜²æ­¢SSLPinningæ ¡éªŒçš„æ¼”ç¤ºï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„è¯æ¨èæŸ¥çœ‹<a href="https://github.com/sensepost/objection/blob/master/agent/src/android/pinning.ts">objection</a>çš„å®ç°ã€‚</p><h2 id="åFridaæ£€æµ‹"><a href="#åFridaæ£€æµ‹" class="headerlink" title="åFridaæ£€æµ‹"></a>åFridaæ£€æµ‹</h2><pre><code>let i = 0;Interceptor.attach(Module.findExportByName(&#39;libc.so&#39;, &#39;strstr&#39;), &#123;    onEnter(args) &#123;        this.fridaDetection = false;        const haystack = Memory.readCString(args[0]).toLowerCase();        const needle = Memory.readCString(args[1]).toLowerCase();        if (-1 !== haystack.indexOf(needle) &amp;&amp; (            -1 !== haystack.indexOf(&#39;frida&#39;) || // fridaç›¸å…³çš„å­—ç¬¦ä¸²            -1 !== haystack.indexOf(&#39;gdbus&#39;) || // dbusçº¿ç¨‹å            -1 !== haystack.indexOf(&#39;gum-js-loop&#39;) || // gumjsçº¿ç¨‹å            -1 !== haystack.indexOf(&#39;gmain&#39;) || // valaçº¿ç¨‹å            -1 !== haystack.indexOf(&#39;linjector&#39;) || // å‘½åç®¡é“ç›¸å…³            -1 !== needle.indexOf(&#39;/data/local/tmp&#39;)) // ç›®å½•æ£€æµ‹        ) &#123;            this.fridaDetection = true;            if (100 &gt; i) &#123;                console.log(                    `[=] æ£€æµ‹ä½ ğŸå‘¢\n` +                    `    haystack: $&#123;haystack&#125;\n` +                    `    needle: $&#123;needle&#125;\n` +                    `    i: $&#123;i++&#125;\n`                );            &#125; else &#123;                const detectionModule = Process.findModuleByAddress(this.returnAddress);                console.log(                    `[=] æ£€æµ‹ä½ ğŸå‘¢\n` +                    `    haystack: $&#123;haystack&#125;\n` +                    `    moduleName: $&#123;detectionModule ? detectionModule.name : &#39;null&#39;&#125;\n` +                    `    modulePath: $&#123;detectionModule ? detectionModule.path : &#39;null&#39;&#125;\n` +                    `    moduleBase: $&#123;detectionModule ? detectionModule.base : &#39;null&#39;&#125; moduleSize: $&#123;detectionModule ? detectionModule.size : &#39;null&#39;&#125;\n` +                    `    detectionPointOffset: $&#123;detectionModule ? this.returnAddress.sub(detectionModule.base) : this.returnAddress&#125;\n`                );            &#125;        &#125;    &#125;,    onLeave(retval) &#123;        if (this.fridaDetection)            retval.replace(0);    &#125;&#125;);</code></pre><p>åœ¨è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬é€šè¿‡Hook<code>libc</code>ä¸­çš„<a href="https://en.cppreference.com/w/c/string/byte/strstr">strstr</a>å‡½æ•°æ¥å®ç°ç®€æ˜“çš„è¿‡æ£€æµ‹ï¼Œç©¶å…¶åŸå› æ˜¯å› ä¸ºä¸ç®¡ä½ ç”¨å•¥æ–¹æ³•ï¼ŒåŸºäºå­—ç¬¦ä¸²æŸ¥æ‰¾çš„æ£€æµ‹æœ€ç»ˆè¿˜æ˜¯å¾—è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯è¿™ç§æ–¹æ³•ä¸æ˜¯è‚¯å®šèƒ½è¿‡ï¼Œåªæ˜¯é€‚ç”¨éƒ¨åˆ†æƒ…å†µã€‚å¾ˆå¤šç”¨å¿ƒç‚¹åšçš„æ£€æµ‹æ˜¯å¯ä»¥è½»æ¾ç»•è¿‡è¿™ä»½ä»£ç çš„ï¼Œå½“ç„¶ä¹Ÿèƒ½Anti Antiå°±æ˜¯äº†ï¼Œè¿™éƒ¨åˆ†æ”¾åœ¨åé¢å†è¯´ï¼Œå…ˆæ¥çœ‹çœ‹ä»£ç æ•ˆæœã€‚</p><p>æœªåŠ è½½è„šæœ¬æ—¶å¯¹è¿›ç¨‹é™„åŠ Frida</p><p><img src="/images/1650222130.jpg" alt="UnAntiAntiFrida"></p><p>åŠ è½½åFridaæ£€æµ‹è„šæœ¬åå¯¹è¿›ç¨‹é™„åŠ Frida</p><p><img src="/images/1650222131.jpg" alt="AntiAntiFrida"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æœªåŠ è½½è„šæœ¬ä¹‹å‰æˆ‘ä»¬é™„åŠ åˆ°è¿›ç¨‹ä¹‹åæ˜¯ä¼šç›´æ¥è¢«å¸è½½æ‰çš„ï¼Œè€ŒåŠ è½½ä¹‹ååˆ™å¯ä»¥æ­£å¸¸é™„åŠ ï¼Œå¹¶ä¸”Frida APIçš„è°ƒç”¨ä¹Ÿæ­£å¸¸ã€‚</p><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>ä¸Šé¢è¯´åˆ°ä¸¾ä¾‹çš„è¿™ç§æ–¹æ³•åªé€‚ç”¨äºåŸºäºå­—ç¬¦ä¸²åŒ¹é…çš„Fridaç‰¹å¾æ£€æµ‹çš„æƒ…å†µï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±ä¸¾å‡ºä¸€äº›ä¸é€‚ç”¨çš„æƒ…å†µä»¥åŠä¸€äº›åæ£€æµ‹çš„æ€è·¯ã€‚åˆ—ä¸¾çš„ä¸€äº›æƒ…å†µä»…ä¸ºæˆ‘æ‰€çŸ¥é“çš„ï¼Œå¦‚æœä½ çŸ¥é“æ›´å¤šçš„è¯·å‘Šè¯‰æˆ‘ã€‚</p><p><img src="/images/sticker_genius.gif" alt="nice"></p><ol><li>è‡ªå·±ç¼–å†™æ‰§è¡Œ<code>syscall</code>çš„æ±‡ç¼–ä»£ç æ¥ä»£æ›¿å¯¹äºlibcä¸­å‡½æ•°çš„è°ƒç”¨ã€‚</li><li>ä½¿ç”¨è‡ªå·±å®ç°çš„æ¨¡å¼åŒ¹é…ç®—æ³•ã€‚</li><li>æ‰«æå¯æ‰§è¡Œæ–‡ä»¶æ‰€å±å†…å­˜å—ï¼Œå¹¶æš´åŠ›åŒ¹é…fridaç›¸å…³ç‰¹å¾ã€‚</li><li>å¯¹æŒ‡å®šlibè¿›è¡Œç›‘æ§ï¼Œå¾ªç¯è®¡ç®—<code>checksum</code>å¹¶æ ¡éªŒï¼Œå¦‚æœå¯¹ä¸ä¸Šè¯´æ˜è¢«ä¿®æ”¹æˆ–è€…Hookäº†ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒæš´åŠ›æ— å·®åˆ«ã€‚</li><li>å¯¹æŒ‡å®šå‡½æ•°å¤´éƒ¨å‡ ä¸ªå­—èŠ‚è¿›è¡Œæ‰«æï¼Œæ£€æµ‹æ˜¯å¦è¢«Hookä»¥åŠç‰¹å¾æ˜¯å¦ä¸ºFridaæ‰€å±ã€‚</li></ol><p>å¯¹äºå…¶ä¸­<code>2</code>ã€<code>4</code>ã€<code>5</code>ä¸‰ç§æƒ…å†µç›®å‰æˆ‘å¹¶æ²¡æœ‰æ€è·¯ï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ³•å°±æ˜¯æ‰¾åˆ°æ£€æµ‹ç‚¹ç›´æ¥æŠŠæ£€æµ‹åšæ‰ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>1</code>ã€<code>3</code>æƒ…å†µçš„å¤„ç†æ–¹å¼ï¼Œå¯¹äºè¿™ä¸¤ç§æƒ…å†µæœ‰ä¸€ä¸ªé€šç”¨çš„åšæ³•ã€‚å³é€šè¿‡<code>ptrace(PTRACE_SYSCALL)</code>çš„æ–¹å¼æ¥ç›‘å¬APPçš„<code>syscall</code>è°ƒç”¨ï¼Œå¹¶æ‹¦æˆªå‡½æ•°åºå·<code>__NR_openat</code>(å¯¹åº”ä¸ºlibcä¸­çš„openatå‡½æ•°)ã€‚</p><p>ç›¸å…³å‡½æ•°ä¸å®åœ¨<code>linux/ptrace.h</code>ä¸<code>fcntl.h</code>ä¸­æœ‰å®šä¹‰ã€‚åœ¨æ‹¦æˆªåˆ°ç›¸å…³è°ƒç”¨çš„æ—¶å€™æ£€æŸ¥è°ƒç”¨å‚æ•°<code>pathname</code>æ˜¯å¦åŒ…å«<code>/proc/self/</code>ï¼Œå¦‚æœåŒ…å«åˆ™å–æ¶ˆè°ƒç”¨å¹¶å°†è¿”å›å€¼ä¹Ÿå³<code>fd</code>æ”¹ä¸ºæˆ‘ä»¬æå‰å‡†å¤‡å¥½çš„å»æ‰fridaç‰¹å¾çš„ç›¸å…³ä¸´æ—¶æ–‡ä»¶çš„<code>fd</code>ã€‚</p><p>è¿™æ ·å½“ç¨‹åºåœ¨å¯¹æ‰“å¼€çš„ä¿¡æ¯æµè¿›è¡Œæ‰«æçš„æ—¶å€™å°±å‘ç°ä¸äº†fridaäº†ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åˆ°è¿™é‡Œæ–‡ç« å°±ç»“æŸäº†ï¼Œè¿·è¿·ç³Šç³Šçš„ä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰è¯´æ¸…æ¥šï¼Œ<del>åˆæ°´äº†ä¸€ç¯‡æ–‡ç« </del>ã€‚</p><p>é‚£ä¹ˆæœ‰ç¼˜å†è§~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æŠ›ç –å¼•ç‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å·¥å…·&quot;&gt;&lt;a href=&quot;#å·¥å…·&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[é¡¹ç›®] TaskcloudåŸºæœ¬é‡æ„å®Œæˆä¸åç»­å¡«å‘è®°å½•è®¡åˆ’è´´</title>
    <link href="http://example.com/2022/07/02/%E9%A1%B9%E7%9B%AE-Taskcloud%E5%9F%BA%E6%9C%AC%E9%87%8D%E6%9E%84%E5%AE%8C%E6%88%90%E4%B8%8E%E5%90%8E%E7%BB%AD%E5%A1%AB%E5%9D%91%E8%AE%B0%E5%BD%95%E8%AE%A1%E5%88%92%E8%B4%B4/"/>
    <id>http://example.com/2022/07/02/%E9%A1%B9%E7%9B%AE-Taskcloud%E5%9F%BA%E6%9C%AC%E9%87%8D%E6%9E%84%E5%AE%8C%E6%88%90%E4%B8%8E%E5%90%8E%E7%BB%AD%E5%A1%AB%E5%9D%91%E8%AE%B0%E5%BD%95%E8%AE%A1%E5%88%92%E8%B4%B4/</id>
    <published>2022-07-02T07:37:51.000Z</published>
    <updated>2022-08-16T08:15:59.114Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä»¥é˜²å¿˜è®°ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p><h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><p>æœ¬æ–‡åªåšç®€è¦ä»‹ç»ï¼Œå¦‚æœæœ‰å…´è¶£è¿˜è¯·ç§»æ­¥ä¸»é¡¹ç›®é˜…è¯»<code>README.md</code>ã€‚</p><h3 id="ä¸»é¡¹ç›®"><a href="#ä¸»é¡¹ç›®" class="headerlink" title="ä¸»é¡¹ç›®"></a>ä¸»é¡¹ç›®</h3><p><a href="https://github.com/Bzi-Han/taskcloud">https://github.com/Bzi-Han/taskcloud</a></p><h3 id="å­é¡¹ç›®"><a href="#å­é¡¹ç›®" class="headerlink" title="å­é¡¹ç›®"></a>å­é¡¹ç›®</h3><p><em>å‰ç«¯</em> <code>vue3</code> <a href="https://github.com/Bzi-Han/taskcloud_web">https://github.com/Bzi-Han/taskcloud_web</a></p><p><em>åç«¯</em> <code>java</code> <a href="https://github.com/Bzi-Han/taskcloud_backend">https://github.com/Bzi-Han/taskcloud_backend</a></p><p><em>æ ¸å¿ƒ</em> <code>c++</code> <a href="https://github.com/Bzi-Han/taskcloud_core">https://github.com/Bzi-Han/taskcloud_core</a></p><h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>äº‘ä»»åŠ¡æ˜¯ä¸€å¥—å®šæ—¶ä»»åŠ¡å¤„ç†ç¨‹åºï¼Œç”¨æˆ·é€šè¿‡ä¸å‰ç«¯äº¤äº’æ·»åŠ éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ°æŒ‡å®šçš„ä»»åŠ¡åŒ…ä¸­ï¼Œå¹¶è®¾å®šä»»åŠ¡åŒ…çš„æ¿€æ´»çŠ¶æ€ä¸å®šæ—¶å¯åŠ¨æ—¶é—´(å¯è®¾å®šæ˜¯å¦åªè¿è¡Œä¸€æ¬¡æˆ–æ¯å¤©éƒ½è¿è¡Œ)ã€‚é™¤äº†ç”¨æˆ·æ‰‹åŠ¨æŠ•é€’çš„ä»»åŠ¡åŒ…å¤–ï¼Œç³»ç»Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä¸æ¯å¤©<code>00:00</code>æ—¶è‡ªåŠ¨åˆ†å‘å½“å¤©éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><p>ä»»åŠ¡æ‰§è¡Œæ‰€ç”¨çš„è„šæœ¬å¯ä»¥æ˜¯<code>Lua</code> <code>Python</code> <code>Javascript</code>è¿™ä¸‰ç§è¯­è¨€ç¼–å†™çš„ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨è¯­è¨€è‡ªå¸¦çš„å„ç§å·¥å…·å‡½æ•°å’Œæ­¤ç¨‹åºå¯¼å‡ºçš„<a href="https://github.com/Bzi-Han/taskcloud/blob/main/docs/APIDocumentaion.md">API</a>æ¥å£æ¥è¿›è¡Œç¼–ç¨‹ï¼Œä»»åŠ¡æ‰§è¡Œçš„ç»“æœä¸æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ—¥å¿—ä¸æŠ¥é”™æ—¥å¿—å‡å¯åœ¨å‰ç«¯æ§åˆ¶å°ä¸­çœ‹åˆ°ï¼Œå¯ä½œä¸ºè„šæœ¬æ‰§è¡Œé—®é¢˜çš„å‚è€ƒæ•°æ®ã€‚</p><p>è‹¥æ˜¯ä»»åŠ¡çš„å¼€å‘è€…è¿˜å¯ä»¥åœ¨å¸®åŠ©ä¸­å¿ƒå‘å¸ƒå¸®åŠ©æ–‡æ¡£ï¼Œä»¥æ›´å¥½åœ°å¸®åŠ©ç”¨æˆ·ä½¿ç”¨ã€‚</p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p>æ•´ä¸ªé¡¹ç›®çš„æ¶æ„å›¾</p><p><img src="/images/1650222128.jpg" alt="é¡¹ç›®æ¶æ„å›¾"></p><p>æ•°æ®åº“çš„ç»“æ„å›¾</p><p><img src="/images/1650222129.png" alt="æ•°æ®åº“ç»“æ„å›¾"></p><h2 id="åŸºäºDockeræ„å»ºæ ¸å¿ƒé¡¹ç›®çš„ç¼–è¯‘ç¯å¢ƒ"><a href="#åŸºäºDockeræ„å»ºæ ¸å¿ƒé¡¹ç›®çš„ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="åŸºäºDockeræ„å»ºæ ¸å¿ƒé¡¹ç›®çš„ç¼–è¯‘ç¯å¢ƒ"></a>åŸºäºDockeræ„å»ºæ ¸å¿ƒé¡¹ç›®çš„ç¼–è¯‘ç¯å¢ƒ</h2><p>å› ä¸º<a href="https://github.com/Bzi-Han/taskcloud_core">æ ¸å¿ƒé¡¹ç›®</a>ä½¿ç”¨äº†<code>CMake</code>æ¥å¸®åŠ©æ„å»ºï¼Œæ‰€ä»¥ç†è®ºä¸Šå¯ä»¥è·¨<code>Windows</code>ä¸<code>Linux</code>è¿›è¡Œç¼–è¯‘(æ²¡æœ‰è¯•è¿‡<code>Mac</code>)ï¼Œä½†ä¸èƒ½ä¿è¯ä¸€å®šä¸ä¼šé‡åˆ°é—®é¢˜ï¼Œå› æ­¤è¿™é‡Œä»…ä½œä¸ºä¸€ä¸ªå¤‡é€‰è§£å†³æ‰‹æ®µã€‚</p><p>ä¹Ÿå¯ä»¥ä½œä¸ºæ„å»ºåŸºäº<code>docker-debian</code> <code>clang-14</code>ç¼–è¯‘ç¯å¢ƒçš„å‚è€ƒå§ã€‚</p><ol><li>ç¡®ä¿<code>docker</code>æœåŠ¡è¿è¡Œä¸­ã€‚</li><li>æ‰§è¡Œ<code>docker run -d --name taskcloud_builder -it debian /bin/bash</code>åˆ›å»ºåŸºæœ¬å®¹å™¨ã€‚å¦‚æœéœ€è¦ <strong>ssh</strong> æœåŠ¡çš„è¯å¯å†æ·»åŠ <code>-p å¤–éƒ¨ç«¯å£:å†…éƒ¨ç«¯å£</code>è¿›è¡Œç«¯å£æ˜ å°„ï¼Œåç»­å†å®‰è£… <strong>ssh</strong> æœåŠ¡å³å¯ï¼Œä½†æˆ‘è¿™é‡Œå°±ä¸éœ€è¦äº†ã€‚</li><li>æ‰§è¡Œ<code>docker exec -it taskcloud_builder /bin/bash</code>è¿›å…¥å®¹å™¨å‘½ä»¤è¡Œã€‚</li><li>æ‰§è¡Œ<code>cp /etc/apt/sources.list /etc/apt/sources.list.bak</code>å¤‡ä»½ <strong>apt</strong> æºã€‚</li><li>æ‰§è¡Œ<code>sed -i &#39;s/deb.debian.org/mirrors.ustc.edu.cn/g&#39; /etc/apt/sources.list</code>æ›¿æ¢ <strong>apt</strong> æºä¸ºä¸­ç§‘å¤§æºï¼Œå¯è‡ªè¡Œè®¾ç½®å…¶ä»–æºã€‚</li><li>æ‰§è¡Œ<code>sed -i &#39;s|security.debian.org/debian-security|mirrors.ustc.edu.cn/debian-security|g&#39; /etc/apt/sources.list</code>æ›¿æ¢ <strong>apt-security</strong> æºä¸ºä¸­ç§‘å¤§æºï¼Œå¯è‡ªè¡Œè®¾ç½®å…¶ä»–æºã€‚</li><li>æ‰§è¡Œ<code>apt-get update</code>æ›´æ–°æºã€‚</li><li>æ‰§è¡Œ<code>apt-get install wget -y</code>å®‰è£… <strong>wget</strong> å·¥å…·ã€‚</li><li>æ‰§è¡Œ<code>apt install lsb-release wget software-properties-common -y</code>å®‰è£… <strong>lsb-release</strong> ä¸ºåç»­å®‰è£…æä¾›æ”¯æŒã€‚</li><li>æ‰§è¡Œ<code>apt install gnupg -y</code>å®‰è£… <strong>gnupg</strong> ä¸ºåç»­å®‰è£…æä¾›æ”¯æŒï¼Œå¦åˆ™ä¼šå‡ºç°<code>Cannot write to &#39;-&#39; (Broken pipe).</code>çš„æƒ…å†µã€‚</li><li>æ‰§è¡Œ<code>cd /tmp &amp;&amp; wget https://apt.llvm.org/llvm.sh</code>åˆ‡æ¢åˆ° <strong>tmp</strong> ç›®å½•åŒæ—¶ä¸‹è½½ <strong>clang</strong> å®‰è£…è„šæœ¬ã€‚</li><li>æ‰§è¡Œ<code>chmod +x llvm.sh &amp;&amp; ./llvm.sh 14 all</code>æ·»åŠ æ‰§è¡Œæƒé™ä»¥åŠç›´æ¥è¿è¡Œè„šæœ¬å®‰è£… <strong>clang-14</strong> æ‰€æœ‰å·¥å…·é“¾ã€‚</li><li>å®‰è£…å®Œæˆåæ‰§è¡Œ<code>update-alternatives --install /usr/bin/clang clang /usr/bin/clang-14 1 --slave /usr/bin/clang++ clang++ /usr/bin/clang++-14</code>æ¥è®¾ç½®é»˜è®¤çš„ <strong>clang</strong> ä¸ <strong>clang++</strong> ã€‚</li><li>æ‰§è¡Œ<code>apt-get install python3-dev -y</code>å®‰è£… <strong>python3-dev</strong> æä¾›æ‰€éœ€çš„ç¼–è¯‘ç¯å¢ƒä¹‹ä¸€ã€‚</li><li>æ‰§è¡Œ<code>apt-get install libssl-dev -y</code>å®‰è£… <strong>libssl-dev</strong> æä¾›æ‰€éœ€çš„ç¼–è¯‘ç¯å¢ƒä¹‹ä¸€ã€‚</li><li>ç¯å¢ƒæ­å»ºå®Œæ¯•ï¼Œå¯ä»¥å¼€å§‹ç¼–è¯‘é¡¹ç›®äº†ã€‚</li></ol><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>crypto.gbkToUTF8</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>crypto.utf8ToGBK</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>crypto.urlEncode</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>crypto.urlDecode</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>crypto.rsaGenerateKeyPair</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>crypto.rsaEncrypt</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>crypto.rsaDecrypt</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜è´¦å·å¯†ç </li><li><input checked="" disabled="" type="checkbox"> æé†’ä½¿ç”¨<code>java -jar</code>è¿è¡Œåç«¯æ—¶æ·»åŠ <code>-Dfile.encoding=UTF-8</code>é˜²æ­¢é»˜è®¤ç¼–ç å¯¼è‡´çš„ä¹±ç é—®é¢˜</li><li><input checked="" disabled="" type="checkbox"> ä¿®å¤åç«¯<code>python</code>ä¸<code>javascript</code>å®¡æ ¸é”™è¯¯é—®é¢˜</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>system</code>æ¨¡å—ä¸<code>system.delay</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>requests.put</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ <code>requests.delete</code>å‡½æ•°</li><li><input checked="" disabled="" type="checkbox"> æ·»åŠ è„šæœ¬å…±äº«æœºåˆ¶ï¼Œä»ä¸­å¤®ä»“åº“æˆ–è€…æŒ‡å®šgithubä»“åº“ä¸­æ‹‰å–è„šæœ¬ï¼Œç„¶åè‡ªåŠ¨å¯¼å…¥æ•°æ®åº“ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä»¥ä¸Šä¼ zipåŒ…çš„æ–¹å¼ã€‚å¯è®¾å®šæ­¤æ¬¡æ‹‰å–æ˜¯å¦éœ€è¦å®¡æ ¸ï¼Œä¸éœ€è¦åˆ™ç›´æ¥å¯¼å…¥ä¸ºå¯ç”¨çŠ¶æ€ï¼Œä¸”æ­¤åŠŸèƒ½å±äºç®¡ç†å‘˜åŠŸèƒ½ã€‚</li><li><input checked="" disabled="" type="checkbox"> å‰ç«¯åœ¨ç™»é™†é¡µé¢æ·»åŠ åç«¯æœåŠ¡åœ°å€è®¾ç½®ï¼Œé…ç½®ä¿å­˜åˆ°<code>localStorage</code>ä¸­ã€‚</li></ul><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æš‚æ—¶å‘Šä¸€æ®µè½äº†ï¼Œå¡«å‘çš„è¯è¿˜æ˜¯æ…¢æ…¢æ¥å§ã€‚<br><img src="/images/sticker_darksee.jpg" alt="æš—ä¸­è§‚å¯Ÿ"></p><p>é‚£å°±è¿™æ ·äº†ï¼Œæœ‰ç¼˜å†è§~ </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è®°å½•ä»¥é˜²å¿˜è®°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¡¹ç›®åœ°å€&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[ç¼–ç¨‹] åœ¨Android Studioä¸­ä½¿ç”¨Kotlinç¼–å†™ä¸€ä¸ªæ§åˆ¶ç”µè„‘è¿œç¨‹å¼€æœºçš„APP(WOLæŠ€æœ¯)</title>
    <link href="http://example.com/2022/06/12/%E7%BC%96%E7%A8%8B-%E5%9C%A8Android-Studio%E4%B8%AD%E4%BD%BF%E7%94%A8Kotlin%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%8E%A7%E5%88%B6%E7%94%B5%E8%84%91%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA%E7%9A%84APP-WOL%E6%8A%80%E6%9C%AF/"/>
    <id>http://example.com/2022/06/12/%E7%BC%96%E7%A8%8B-%E5%9C%A8Android-Studio%E4%B8%AD%E4%BD%BF%E7%94%A8Kotlin%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%8E%A7%E5%88%B6%E7%94%B5%E8%84%91%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA%E7%9A%84APP-WOL%E6%8A%80%E6%9C%AF/</id>
    <published>2022-06-12T06:49:11.000Z</published>
    <updated>2022-07-02T08:14:42.532Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç« å°†åªå›´ç»•å‘ä¸å‡ ä¸ªæŠ€æœ¯éš¾ç‚¹ä¸WOLçš„ä¸€äº›ç›¸å…³çŸ¥è¯†å±•å¼€ï¼Œä¸ä¼šè¿‡å¤šçš„æè¿°å…·ä½“ç»†èŠ‚ï¼Œå¦‚è‹¥æƒ³çŸ¥é“è¿˜è¯·è‡ªè¡ŒæŸ¥é˜…é¡¹ç›®æºç ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ol><li><a href="https://docs.microsoft.com/en-us/windows/wsl/install" title="WSL Install Documentation">Ubuntu(WSL)</a></li><li><a href="http://manpages.ubuntu.com/manpages/bionic/man1/nslookup.1.html" title="nslookup Documentation">nslookup(Ubuntu)</a></li><li><a href="https://www.wireshark.org/" title="Wireshark Official">Wireshark</a></li><li><a href="https://developer.android.com/studio" title="Official Download">Android Studio</a></li></ol><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><p>æ ¸å¿ƒä¾èµ–çš„ä¸œè¥¿åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯WOL(Wake-on-LAN)æŠ€æœ¯ï¼Œå³å…è®¸é€šè¿‡ç½‘ç»œæ¶ˆæ¯è¿œç¨‹æ‰“å¼€æˆ–å”¤é†’ç½‘ç»œä¸­çš„æŸå°è®¡ç®—æœºã€‚</p><p>WOLæŠ€æœ¯ä¾èµ–äºä¸»æ¿ä¸ç½‘å¡ï¼Œæƒ³è¦ä½¿ç”¨æ­¤åŠŸèƒ½å¿…é¡»ç¡®ä¿ä½ çš„è®¾å¤‡æ”¯æŒæ­¤æŠ€æœ¯ã€‚å°±ç°ä»£è®¡ç®—æœºæ¥è¯´ï¼Œåº”è¯¥å·²ç»æ²¡æœ‰ä¸æ”¯æŒçš„æœºå™¨äº†å§ï¼Ÿ(å¿ƒè™š)</p><p>WOLå”¤é†’çš„å…³é”®ç‚¹æ˜¯ä¸€ä¸ªå«åš<code>MagicPacket(é­”æœ¯åŒ…)</code>çš„ä¸œè¥¿ï¼Œå½“ç½‘å¡æ¥æ”¶åˆ°å‘é€å¾€æ­¤ç½‘å¡çš„é­”æœ¯åŒ…å¹¶ä¸”ç»è¿‡æ ¡éªŒåç¡®è®¤æ— è¯¯åå°±ä¼šé€šçŸ¥ä¸»æ¿è¿›è¡Œç³»ç»Ÿçš„å”¤é†’ã€‚</p><p><code>MagicPacket</code>çš„æ„é€ ååˆ†çš„ç®€å•ï¼Œç”±å‰ç¼€<code>6</code>ä¸ª<code>0xFF</code>è·Ÿåé¢çš„é‡å¤<code>16</code>æ¬¡çš„<code>6</code>ä¸ªå­—èŠ‚çš„ç›®æ ‡æœºå™¨çš„ç½‘å¡MACåœ°å€æ„æˆã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä¼ è¾“å±‚çš„åè®®è¿›è¡Œå‘é€é­”æœ¯åŒ…åˆ°ç›®æ ‡ä¸»æœºï¼Œä½†é€šå¸¸ä¼šä½¿ç”¨<code>UDP</code>åè®®ã€‚</p><pre><code>// MACåœ°å€ä¸º 11:22:33:44:55:66 çš„ç¤ºä¾‹é­”æœ¯åŒ…00000000        FF FF FF FF FF FF 11 22 33 44 55 66 11 22 33 44        .......&quot;3DUf.&quot;3D00000010        55 66 11 22 33 44 55 66 11 22 33 44 55 66 11 22        Uf.&quot;3DUf.&quot;3DUf.&quot;00000020        33 44 55 66 11 22 33 44 55 66 11 22 33 44 55 66        3DUf.&quot;3DUf.&quot;3DUf00000030        11 22 33 44 55 66 11 22 33 44 55 66 11 22 33 44        .&quot;3DUf.&quot;3DUf.&quot;3D00000040        55 66 11 22 33 44 55 66 11 22 33 44 55 66 11 22        Uf.&quot;3DUf.&quot;3DUf.&quot;00000050        33 44 55 66 11 22 33 44 55 66 11 22 33 44 55 66        3DUf.&quot;3DUf.&quot;3DUf00000060        11 22 33 44 55 66                                      .&quot;3DUf</code></pre><p>æˆ‘ä»¬åªéœ€è¦å°†æ­¤é­”æœ¯åŒ…å‘å¾€ç›®æ ‡æœºå™¨å³å¯å®ç°è¿œç¨‹å”¤é†’æœºå™¨ã€‚</p><p>å‚è€ƒèµ„æ–™:</p><ol><li><a href="https://en.wikipedia.org/wiki/Wake-on-LAN" title="Wiki">Wake-on-LAN</a></li><li><a href="https://baike.baidu.com/item/%E8%BF%9C%E7%A8%8B%E5%94%A4%E9%86%92" title="ç™¾åº¦ç™¾ç§‘">è¿œç¨‹å”¤é†’</a></li></ol><h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>å…¶å®åªå®ç°è¿œç¨‹å”¤é†’å¾ˆç®€å•ï¼Œä¸Šé¢çš„å†…å®¹æˆ‘è§‰å¾—ä¹Ÿå·²ç»è¯´çš„æ¯”è¾ƒæ¸…æ™°äº†ï¼Œå°±æ˜¯ç»„åŒ…ä¸å‘åŒ…çš„è¿‡ç¨‹ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦å†™æˆAPPçš„è¯å°±åªæœ‰ä¸ªå”¤é†’åŠŸèƒ½è‚¯å®šæ˜¯ä¸å¤Ÿçš„ã€‚æ¯•ç«Ÿä¸å¯èƒ½æ¯æ¬¡è¿›å…¥APPè¿˜è¦æ‰‹åŠ¨è¾“å…¥ä¸€æ¬¡MACåœ°å€IPåœ°å€å§ï¼Œè€Œä¸”é…ç½®ä¹Ÿå¾ˆéº»çƒ¦ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰«æå±€åŸŸç½‘åœ¨çº¿è®¾å¤‡çš„åŠŸèƒ½ï¼Œå¹¶å¯ä»¥ä¿å­˜é…ç½®åˆ°æœ¬åœ°ï¼Œå…å»æ‰‹åŠ¨é…ç½®çš„éº»çƒ¦ã€‚ä½†åŒæ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦ä¿ç•™æ‰‹åŠ¨é…ç½®çš„é€‰é¡¹ä½œä¸ºæœ€ç»ˆè§£å†³æ‰‹æ®µã€‚</p><p>æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœæˆ‘ä»¬çš„ç”µè„‘çš„IPæ˜¯åŠ¨æ€è·å–çš„(DHCP)ï¼Œåˆ™æˆ‘ä»¬çš„é…ç½®å¯èƒ½ä¼šå¤±æ•ˆï¼Œä¾‹å¦‚æˆ‘ç°åœ¨çš„ä¸€ä¸ªé…ç½®ä»–çš„ç›®æ ‡IPåœ°å€ä¸º<code>192.168.1.233</code>ï¼Œè€ŒçœŸå®è®°å½•çš„IPåœ°å€ä¸º<code>192.168.1.234</code>ã€‚å½“æˆ‘ä»¬å¾€é…ç½®ä¸­çš„IPåœ°å€å‘é€é­”æœ¯åŒ…æ—¶ç”±äºçœŸå®æœºå™¨å¹¶æ²¡æœ‰æ¥æ”¶åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä»¥æ§åˆ¶æ˜¯å¦ç²¾å‡†å”¤é†’ç›®æ ‡æœºå™¨çš„å¼€å…³é€‰é¡¹ï¼Œå¦‚æœæ˜¯éç²¾å‡†å”¤é†’åˆ™æˆ‘ä»¬ä¼šå‘å±€åŸŸç½‘å¹¿æ’­åœ°å€<code>192.168.1.255</code>å‘é€é­”æœ¯åŒ…ï¼Œä½¿å¾—ç›®æ ‡æœºå™¨å³ä½¿ä¸é…ç½®IPä¸åŒä¹Ÿå¯ä»¥æ¥æ”¶åˆ°æˆ‘ä»¬å‘é€çš„å”¤é†’é­”æœ¯åŒ…ã€‚</p><p>åœ¨å±€åŸŸç½‘æ‰«æä¸­æˆ‘ä»¬éœ€è¦è·å–çš„ä¿¡æ¯æœ‰IPåœ°å€ã€MACåœ°å€ã€ä¸»æœºåã€‚å…¶ä¸­ä¸»æœºåå°†ä½œä¸ºé»˜è®¤çš„é…ç½®åç§°ï¼ŒIPåœ°å€ä¸MACåœ°å€ä¸ºå”¤é†’ç›®æ ‡æœºå™¨çš„ä¸»è¦å‚æ•°ã€‚</p><h2 id="æŠ€æœ¯éš¾ç‚¹"><a href="#æŠ€æœ¯éš¾ç‚¹" class="headerlink" title="æŠ€æœ¯éš¾ç‚¹"></a>æŠ€æœ¯éš¾ç‚¹</h2><ol><li>å¦‚ä½•æ‰«æå±€åŸŸç½‘ä¸­çš„åœ¨çº¿æœºå™¨ï¼Œå¹¶è·å–åœ¨çº¿æœºå™¨çš„IPåœ°å€ä¸MACåœ°å€ã€‚</li><li>å¦‚ä½•é€šè¿‡ç›®æ ‡æœºå™¨çš„IPåœ°å€è·å–åˆ°ç›®æ ‡æœºå™¨çš„ä¸»æœºåã€‚</li></ol><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><ol><li>ä½¿ç”¨<code>UDP</code>åè®®å¾€æ­¤ç½‘æ®µä¸­çš„<code>1-254</code>å°æœºå™¨å‘é€æ•°æ®åŒ…ä½¿å…¶äº§ç”ŸARPç¼“å­˜ï¼Œç„¶åé€šè¿‡<code>cat /proc/net/arp</code>æŒ‡ä»¤è·å–ARPè¡¨ï¼Œè§£æARPè¡¨å³å¯è·å¾—IPåœ°å€ä¸MACåœ°å€ã€‚</li><li>ä½¿ç”¨<code>LLMNR</code>åè®®åè®®é€šè¿‡IPåœ°å€åå‘æŸ¥è¯¢ç›®æ ‡æœºå™¨çš„ä¸»æœºåã€‚</li></ol><h2 id="é€šè¿‡IPåœ°å€è·å–ä¸»æœºååŠŸèƒ½çš„å®ç°"><a href="#é€šè¿‡IPåœ°å€è·å–ä¸»æœºååŠŸèƒ½çš„å®ç°" class="headerlink" title="é€šè¿‡IPåœ°å€è·å–ä¸»æœºååŠŸèƒ½çš„å®ç°"></a>é€šè¿‡IPåœ°å€è·å–ä¸»æœºååŠŸèƒ½çš„å®ç°</h2><p>åœ¨Linuxä¸­æœ‰ä¸€æ¬¾å«<code>nslookup</code>çš„å·¥å…·ï¼Œå…¶åŠŸèƒ½ä¸ºé€šè¿‡IPåœ°å€å¯åå‘æŸ¥è¯¢å‡ºç›®æ ‡æœºå™¨çš„ä¸»æœºåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡å¯¹è¿™æ¬¾å·¥å…·çš„åˆ†ææ¥ææ¸…æ¥šå¦‚ä½•å®ç°æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½ã€‚</p><p>æ‰“å¼€æˆ‘ä»¬çš„Ubuntu(Linuxå­ç³»ç»Ÿ WSL)ï¼Œè¾“å…¥<code>nslookup ip</code>å³å¯æŸ¥çœ‹åˆ°ç›®æ ‡æœºå™¨çš„ä¸»æœºå</p><p><img src="/images/1650222118.jpeg" alt="nslookupç»“æœ"></p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸæŸ¥è¯¢å‡ºäº†ä¸»æœºåã€‚</p><h2 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h2><p>æ‰“å¼€Wiresharkï¼Œé€‰æ‹©ä»¥å¤ªç½‘å¼€å§‹ç›‘å¬ï¼Œåœ¨filterä¸€æ ä¸­æˆ‘ä»¬è¾“å…¥<code>dns || llmnr</code>è¿‡æ»¤æˆ‘ä»¬åªéœ€è¦çœ‹çš„åè®®ã€‚</p><p><img src="/images/1650222119.jpeg" alt="Wireshark"></p><p><img src="/images/1650222120.jpeg" alt="Wireshark"></p><p>å›åˆ°æ§åˆ¶å°å†ä¸€æ¬¡æ‰§è¡Œæˆ‘ä»¬åˆšæ‰çš„å‘½ä»¤</p><p><img src="/images/1650222121.jpeg" alt="æ‰§è¡Œå‘½ä»¤Wiresharkç»“æœ"></p><p>æ•°æ®å‡ºæ¥äº†ä¹‹åæˆ‘ä»¬åœæ­¢æŠ“åŒ…ï¼Œæ¥åˆ†æä¸€ä¸‹å®ƒè·å–ä¸»æœºåçš„æµç¨‹ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨<code>IPV4</code>çš„ä¸œè¥¿ï¼Œ<code>IPV6</code>å¯ä»¥å¿½ç•¥ä¸çœ‹ã€‚</p><p><img src="/images/1650222122.jpeg" alt="DNSåå‘æŸ¥è¯¢è¯·æ±‚ç»“æœ"></p><p>å¯ä»¥çœ‹åˆ°ä»–å…ˆæ˜¯å‘é»˜è®¤çš„DNSæœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªåå‘æŸ¥è¯¢ä¸»æœºåçš„è¯·æ±‚ï¼ˆæ¯•ç«Ÿå¦‚æœèƒ½ç›´æ¥åœ¨DNSæœåŠ¡å™¨ä¸Šæ‰¾åˆ°å°±ä¸éœ€è¦è¿›è¡Œå¤šæ’­äº†ï¼‰ï¼Œä½†æ˜¯DNSæœåŠ¡å™¨ä¸Šå¹¶æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å®ƒè¿”å›çš„æ•°æ®åŒ…ä¸­å¹¶æ²¡æœ‰åŒ…å«<code>Answer</code>ã€‚</p><p><code>.in-addr.arpa</code>æ˜¯åå‘æŸ¥è¯¢çš„ä¸“å±å‘½åç©ºé—´ï¼Œä¾‹å¦‚å›¾ä¸­æŸ¥è¯¢<code>192.168.3.102</code>åˆ™å®ƒçš„Nameä¸º<code>102.3.168.192.in-addr.arpa</code>ã€‚</p><p>åœ¨æŸ¥è¯¢DNSæœåŠ¡å™¨æ— æœåå®ƒåˆä½¿ç”¨LLMNRåè®®å‘å±€åŸŸç½‘ä¸­å¹¿æ’­äº†ä¸€åˆ™â€å¯»æœºå¯ç¤ºâ€ï¼Œå…¶ä¸­<code>224.0.0.252</code>è¿™ä¸ªåœ°å€æ˜¯LLMNRåè®®çš„å›ºå®šåœ°å€ï¼Œè€ŒæŸ¥è¯¢çš„æ•°æ®åŒ…å†…å®¹æ˜¯ä¸å˜çš„ï¼Œå› ä¸ºLLMNRæ˜¯åŸºäºDNSåè®®çš„ä¸€ä¸ªå°åˆ†æ”¯ã€‚</p><p>åœ¨å¹¿æ’­äº†â€å¯»æœºå¯ç¤ºâ€ä¹‹åï¼Œè§†ç½‘ç»œçŠ¶å†µè€Œå®šç›®æ ‡ä¸»æœºå¦‚æœæ¥æ”¶åˆ°äº†ä¿¡æ¯ï¼Œä»–å°±ä¼šä¸»åŠ¨å‘æœ¬æœºå‘é€ä¸»æœºåç­‰ä¿¡æ¯ã€‚</p><p>å¦‚å›¾æ‰€ç¤º</p><p><img src="/images/1650222123.jpeg" alt="LLMNRå¹¿æ’­è¯·æ±‚ç»“æœ"></p><p>å…¶ä¸­çº¢è‰²æ¡†èµ·æ¥çš„æ˜¯å‘é€åœ°å€ä¸ç›®æ ‡åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœæ˜¯ç”±æˆ‘ä»¬è¦æŸ¥è¯¢çš„ç›®æ ‡æœºå™¨ä¸»åŠ¨å‘å¾€æˆ‘ä»¬æœ¬æœºçš„ã€‚æ©™è‰²æ¡†åœˆèµ·æ¥çš„<code>Domain Name</code>å°±æ˜¯æˆ‘ä»¬è¦æŸ¥è¯¢çš„ç›®æ ‡æœºå™¨çš„ä¸»æœºåã€‚</p><p>è‡³æ­¤é—®é¢˜è§£å†³ã€‚</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>å¯¹äº<code>DeviceDiscovery.getComputerName</code>çš„å®ç°</p><pre><code>fun getComputerName(targetIp: String): String &#123;    var domainNameOffset: Int    // ç»„åŒ…    val packet = targetIp.let &#123;        val ips = it.split(&quot;.&quot;)        val hard01 = byteArrayOf(0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00)        val hard02 = byteArrayOf(0x00, 0x0c, 0x00, 0x01)        val packetBuilder = ByteBuffer.allocate(256)        packetBuilder.putShort(888) //æ ‡è¯†ç¬¦        packetBuilder.put(hard01) //ç¡¬ç¼–ç 01        // ç¼–ç æŸ¥è¯¢åœ°å€        domainNameOffset = packetBuilder.position()        for (i in 3 downTo 0) &#123;            packetBuilder.put(ips[i].length.toByte())            packetBuilder.put(ips[i].toByteArray())        &#125;        packetBuilder.put(7)        packetBuilder.put(&quot;in-addr&quot;.toByteArray())        packetBuilder.put(4)        packetBuilder.put(&quot;arpa&quot;.toByteArray())        packetBuilder.put(0)        packetBuilder.put(hard02) //ç¡¬ç¼–ç 02        domainNameOffset = packetBuilder.position() - domainNameOffset + 6 + packetBuilder.position()        DatagramPacket(packetBuilder.array(), 0, packetBuilder.position(), InetAddress.getByName(&quot;224.0.0.252&quot;), 5355)    &#125;    // å‘é€è¯·æ±‚    kotlin.runCatching &#123; sender.send(packet) &#125;.onFailure &#123; return &quot;UnReachableDevice&quot; &#125;    // æ¥æ”¶è¿”å›    val recvBuffer = ByteBuffer.allocate(1024)    val recvPacket = DatagramPacket(recvBuffer.array(), recvBuffer.capacity())    sender.soTimeout = 1000    kotlin.runCatching &#123;        sender.receive(recvPacket)    &#125;.onFailure &#123; return &quot;UnKnowDevice&quot; &#125;    // è¯»å–åŸŸå    recvBuffer.position(domainNameOffset)    val domainNameByteArray = ByteBuffer.allocate(recvBuffer.get().toInt())    recvBuffer.get(domainNameByteArray.array())    return String(domainNameByteArray.array())&#125;</code></pre><p>å¯¹äº<code>DeviceDiscovery.scan</code>çš„å®ç°</p><pre><code>fun scan(networkSegmentPrefix: String, progress: (Float) -&gt; Unit = &#123;&#125;): ArrayList&lt;LanDeviceInfo&gt; &#123;    val result = ArrayList&lt;LanDeviceInfo&gt;()    val data = ByteArray(1)    progress(0f)    for (i in 1..254) &#123;        kotlin.runCatching &#123; sender.send(DatagramPacket(data, 0, 1, InetAddress.getByName(networkSegmentPrefix + i), 888)) &#125;        progress(i / 254f)    &#125;    progress(1f)    progress(0f)    val table = runCommand(&quot;cat&quot;, &quot;/proc/net/arp&quot;)!!            .replace(&quot;\r&quot;, &quot;&quot;)            .split(&quot;\n&quot;)    for ((i, row) in table.withIndex()) &#123;        val col = row.let &#123;            val results = ArrayList&lt;String&gt;()            var flag = true            val sb = StringBuilder()            for (c in it.trim()) &#123;                when (c) &#123;                    &#39; &#39; -&gt; &#123;                        if (flag) &#123;                            results.add(sb.toString())                            sb.clear()                            flag = false                        &#125;                    &#125;                    else -&gt; &#123;                        sb.append(c)                        flag = true                    &#125;                &#125;            &#125;            if (flag)                results.add(sb.toString())            results        &#125;        when (col.size) &#123;            6 -&gt; &#123;                if (&quot;00:00:00:00:00:00&quot; != col[3] &amp;&amp; col[0].contains(networkSegmentPrefix)) &#123;                    result.add(LanDeviceInfo(                            getComputerName(col[0]),                            col[0],                            col[3],                            col[5],                            &quot;888&quot;                    ))                &#125;            &#125;        &#125;        progress(i / table.size.toFloat())    &#125;    progress(1f)    return result&#125;</code></pre><h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><p><img src="/images/1650222124.jpeg" alt="APPæœ€ç»ˆç»“æœ01"></p><p><img src="/images/1650222125.jpeg" alt="APPæœ€ç»ˆç»“æœ02"></p><p><img src="/images/1650222126.jpeg" alt="APPæœ€ç»ˆç»“æœ03"></p><p><img src="/images/1650222127.jpeg" alt="APPæœ€ç»ˆç»“æœ04"></p><h2 id="å®Œæ•´ä»£ç ä»“åº“åœ°å€"><a href="#å®Œæ•´ä»£ç ä»“åº“åœ°å€" class="headerlink" title="å®Œæ•´ä»£ç ä»“åº“åœ°å€"></a>å®Œæ•´ä»£ç ä»“åº“åœ°å€</h2><p><a href="https://github.com/Bzi-Han/WOLDeviceManager">GitHub</a></p><h2 id="é¿å‘æŒ‡å—"><a href="#é¿å‘æŒ‡å—" class="headerlink" title="é¿å‘æŒ‡å—"></a>é¿å‘æŒ‡å—</h2><ol><li>æ‰«ææ˜¯æ‰«æå±€åŸŸç½‘ä¸­ç›®å‰åœ¨çº¿çš„æœºå™¨ã€‚</li><li>å¯¹äº<code>çœŸÂ·å…³æœº</code>çš„æœºå™¨æ˜¯æ²¡æ³•å”¤é†’çš„ï¼Œä¾‹å¦‚ä½¿ç”¨<code>shutdown -s -t 0</code>è¿›è¡Œå…³æœºæˆ–è€…é•¿æŒ‰ç”µæºé”®å¼ºåˆ¶å…³æœºä¸æ–­ç”µå¯¼è‡´å…³æœºçš„ï¼Œè¿™ä¸‰ç§æƒ…å†µæ— æ³•å”¤é†’ã€‚</li><li>Android10+çš„ç³»ç»Ÿ<a href="https://developer.android.com/about/versions/10/privacy/changes#proc-net-filesystem">æ— æ³•ä½¿ç”¨</a>æ‰«æåŠŸèƒ½ï¼Œå› ä¸ºä»Android10å¼€å§‹åº”ç”¨æ— æ³•è®¿é—®<code>/proc/net</code>ï¼Œæ‰€ä»¥å¯¼è‡´æ— æ³•è¯»å–ARPè¡¨æ¥è¿›è¡Œè·å–IPåœ°å€ä¸MACåœ°å€ã€‚</li></ol><h2 id="ä¸€äº›æ€è€ƒ"><a href="#ä¸€äº›æ€è€ƒ" class="headerlink" title="ä¸€äº›æ€è€ƒ"></a>ä¸€äº›æ€è€ƒ</h2><ol><li>åœ¨é…ç½®ä¸­æ·»åŠ ä¿®æ”¹é…ç½®åŠŸèƒ½ã€‚</li><li>åœ¨é…ç½®ä¸­æ·»åŠ é…ç½®åˆ†ç»„åŠŸèƒ½ã€‚</li><li>åœ¨é…ç½®ä¸­æ·»åŠ æ‰¹é‡å”¤é†’æŸä¸ªåˆ†ç»„æœºå™¨çš„åŠŸèƒ½ã€‚</li><li>å¯»æ‰¾Android10+æ— æ³•æ‰«æçš„è§£å†³æ–¹æ¡ˆã€‚</li></ol><p><del>ç®—æ˜¯é—ç•™é—®é¢˜äº†ï¼Œæ‡’ç‹—ä¸æƒ³å®ç°</del></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p><img src="/images/sticker_newfolder.jpg" alt="æ–°å»ºæ–‡ä»¶å¤¹"></p><p>é‚£å°±è¿™æ ·äº†ï¼Œæœ‰ç¼˜å†è§~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬æ–‡ç« å°†åªå›´ç»•å‘ä¸å‡ ä¸ªæŠ€æœ¯éš¾ç‚¹ä¸WOLçš„ä¸€äº›ç›¸å…³çŸ¥è¯†å±•å¼€ï¼Œä¸ä¼šè¿‡å¤šçš„æè¿°å…·ä½“ç»†èŠ‚ï¼Œå¦‚è‹¥æƒ³çŸ¥é“è¿˜è¯·è‡ªè¡ŒæŸ¥é˜…é¡¹ç›®æºç ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»…ä¾›å­¦</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[ç¼–ç¨‹] åœ¨C++ä¸­å®ç°ä¸€ä¸ªå†…å­˜æ± ä¸å‡ ç§åƒåœ¾å›æ”¶æœºåˆ¶(GCç­–ç•¥)</title>
    <link href="http://example.com/2022/04/28/%E7%BC%96%E7%A8%8B-%E5%9C%A8C++%E4%B8%AD%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%86%85%E5%AD%98%E6%B1%A0%E4%B8%8E%E5%87%A0%E7%A7%8D%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6(GC%E7%AD%96%E7%95%A5)/"/>
    <id>http://example.com/2022/04/28/%E7%BC%96%E7%A8%8B-%E5%9C%A8C++%E4%B8%AD%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%86%85%E5%AD%98%E6%B1%A0%E4%B8%8E%E5%87%A0%E7%A7%8D%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6(GC%E7%AD%96%E7%95%A5)/</id>
    <published>2022-04-28T04:04:16.000Z</published>
    <updated>2022-07-02T08:14:51.734Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç‰¹å®šæƒ…å†µä¸‹ä½¿ç”¨å†…å­˜æ± å¯æ˜¾è‘—æé«˜æ€§èƒ½ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ol><li><a href="https://code.visualstudio.com/" title="Visual Studio Code Official">Visual Studio Code</a></li><li><a href="http://graphviz.org/" title="Graphviz Official">Graphviz</a></li></ol><h2 id="éœ€æ±‚ä¸æ€è€ƒ"><a href="#éœ€æ±‚ä¸æ€è€ƒ" class="headerlink" title="éœ€æ±‚ä¸æ€è€ƒ"></a>éœ€æ±‚ä¸æ€è€ƒ</h2><ol><li>å¯é™å®šå†…å­˜æ± æœ€å¤§å¯å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜å¤§å°</li><li>å°½é‡ä¿è¯æ± ä¸­çš„å†…å­˜å•å…ƒéƒ½åœ¨è¿ç»­çš„å†…å­˜ä¸Š</li><li>å†…å­˜æ± æ¯æ¬¡å¯ç”³è¯·ä»»æ„å¤§å°çš„å†…å­˜</li><li>è¿›è¡Œå†…å­˜çš„ç”³è¯·æ—¶è‹¥å†…å­˜æ± çš„ç©ºé—²ç©ºé—´ä¸è¶³ä¸”æ‰€éœ€å†…å­˜æœªè¶…è¿‡å†…å­˜æ± æœ€å¤§é™å®šå¯ç”³è¯·çš„å†…å­˜æ—¶å°†è¿›è¡ŒåŠ¨æ€æ‰©å®¹</li><li>å†…å­˜å•å…ƒé‡Šæ”¾çš„åŒæ—¶è¿›è¡Œä¸´è¿‘å†…å­˜ç¢ç‰‡çš„åˆå¹¶</li><li>å½“å‰éœ€è¦ç”³è¯·çš„å†…å­˜åŠ ä¸Šå·²ç”³è¯·çš„å†…å­˜è‹¥è¶…è¿‡é™å®šæœ€å¤§å¯å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜å¤§å°æ—¶æŠ›å‡ºå¼‚å¸¸</li></ol><ul><li>Garbage Collection<ul><li>å†…å­˜æ ‡è®°ç®—æ³•</li><li>å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•</li><li>å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•</li></ul></li><li>å½“å‰éœ€è¦ç”³è¯·çš„å†…å­˜åŠ ä¸Šå·²ç”³è¯·çš„å†…å­˜è‹¥è¶…è¿‡é™å®šæœ€å¤§å¯å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜å¤§å°æ—¶å¯åŠ¨GCè¿›è¡Œåƒåœ¾å›æ”¶</li><li>è‹¥å¯åŠ¨GCåä»æ— æ³•åˆ†é…å†…å­˜åˆ™æŠ›å‡ºå¼‚å¸¸</li></ul><h2 id="å†…å­˜æ± æ•°æ®ç»“æ„"><a href="#å†…å­˜æ± æ•°æ®ç»“æ„" class="headerlink" title="å†…å­˜æ± æ•°æ®ç»“æ„"></a>å†…å­˜æ± æ•°æ®ç»“æ„</h2><pre><code>// å†…å­˜å•å…ƒstruct MemoryUnit&#123;    uint8_t *data;        // å†…å­˜å•å…ƒçš„æ•°æ®åœ°å€    size_t size;          // å†…å­˜çš„æ•°æ®å¤§å°    MemoryBlock *block;   // å†…å­˜å•å…ƒæ‰€å±çš„å†…å­˜å—    MemoryUnit *nextUnit; // ä¸‹ä¸€ä¸ªå†…å­˜å•å…ƒ    MemoryUnit *prevUnit; // ä¸Šä¸€ä¸ªå†…å­˜å•å…ƒ&#125;;// å†…å­˜å—struct MemoryBlock&#123;    uint8_t *data;          // å†…å­˜å—çš„æ•°æ®åœ°å€    size_t size;            // å†…å­˜å—çš„æ•°æ®å¤§å°    size_t freeTotal;       // å†…å­˜å—ä¸­å‰©ä½™çš„ç©ºé—²å†…å­˜å¤§å°    MemoryUnit *freeList;   // å†…å­˜å—ä¸­çš„ç©ºé—²å†…å­˜å•å…ƒ    MemoryUnit *usedList;   // å†…å­˜å—ä¸­çš„å·²ä½¿ç”¨å†…å­˜å•å…ƒ    MemoryBlock *nextBlock; // ä¸‹ä¸€ä¸ªå†…å­˜å—    MemoryBlock *prevBlock; // ä¸Šä¸€ä¸ªå†…å­˜å—&#125;;// å†…å­˜æ± struct MemoryPool&#123;    size_t systemPageSize; // å½“å‰æ“ä½œç³»ç»Ÿçš„å†…å­˜é¡µå®šä¹‰å¤§å°    size_t blockMinSize;   // ç”³è¯·å†…å­˜å—æ—¶è‡³å°‘ç”³è¯·ä¸èƒ½å°äºå—æœ€å°å¤§å°    size_t poolMaxSize;    // å†…å­˜æ± çš„æœ€å¤§å¯å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜å¤§å°    size_t poolSize;       // å†…å­˜æ± çš„å½“å‰å¤§å°    MemoryBlock *blocks;   // å†…å­˜å—å•å‘å¾ªç¯é“¾è¡¨&#125;;</code></pre><h2 id="éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ"><a href="#éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ"></a>éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ</h2><ol><li>ç»“æ„ä½“<code>MemoryPool</code>çš„æˆå‘˜<code>poolMaxSize</code>ä¸<code>poolSize</code>ç”¨äºå¯¹æ¯”å¹¶é™å®šæœ€å¤§å¯ç”³è¯·çš„å†…å­˜å¤§å°</li><li>ç»“æ„ä½“<code>MemoryPool</code>çš„æˆå‘˜<code>blockMinSize</code>ç”¨äºç¡®ä¿å•æ¬¡ç”³è¯·è¿‡å°çš„å†…å­˜å•å…ƒå¯¼è‡´è¿‡å¤šçš„ä¸è¿ç»­å†…å­˜å—</li><li>ç»“æ„ä½“<code>MemoryUnit</code>çš„æˆå‘˜<code>size</code>ç”¨äºå­˜æ”¾å½“å‰å†…å­˜å•å…ƒæ‰€ä½¿ç”¨çš„å†…å­˜å¤§å°</li><li>è‹¥å½“å‰æ¡ä»¶æ»¡è¶³åŠ¨æ€æ‰©å®¹çš„æ¡ä»¶æ—¶ï¼Œå‘ç³»ç»Ÿç”³è¯·æ–°çš„å†…å­˜å—å¹¶ä½¿ç”¨å¤´æ’æ³•æ’å…¥ç»“æ„ä½“<code>MemoryPool</code>çš„æˆå‘˜<code>blocks</code>é“¾è¡¨ä¸­ï¼Œè¿™ä¹Ÿæ˜¯å°†å…¶è®¾è®¡ä¸ºå•é¡¹å¾ªç¯é“¾è¡¨çš„åŸå› ã€‚ä¸æ­¤åŒæ­¤è¿˜è¦æ›´æ–°æˆå‘˜<code>poolSize</code>çš„æ•°å€¼ã€‚</li><li>å†…å­˜ç¢ç‰‡çš„åˆå¹¶å°†ä¼šåœ¨å†…å­˜å•å…ƒé‡Šæ”¾æ—¶è‡ªåŠ¨è¿›è¡Œ<strong>ä¸´è¿‘</strong>å•å…ƒåˆå¹¶ï¼Œè¿™ä¹Ÿæ˜¯ç»“æ„ä½“<code>MemoryUnit</code>è®¾è®¡ä¸ºåŒå‘é“¾è¡¨çš„åŸå› ä¹‹ä¸€</li><li>ä½¿ç”¨å½“å‰æƒ³è¦ç”³è¯·çš„å†…å­˜å¤§å°åŠ ä¸Šç»“æ„ä½“<code>MemoryPool</code>çš„æˆå‘˜<code>poolSize</code>çš„æ•°å€¼è¿›è¡Œåˆ¤æ–­å³å¯</li></ol><h2 id="å†…å­˜æ± ä»£ç å®šä¹‰ä¸å®ç°"><a href="#å†…å­˜æ± ä»£ç å®šä¹‰ä¸å®ç°" class="headerlink" title="å†…å­˜æ± ä»£ç å®šä¹‰ä¸å®ç°"></a>å†…å­˜æ± ä»£ç å®šä¹‰ä¸å®ç°</h2><p>ç±»<code>MemoryPool</code>çš„å®šä¹‰</p><pre><code>class MemoryPool&#123;public:    struct MemoryBlock;    struct MemoryUnit    &#123;        uint8_t *data;        size_t size;        MemoryBlock *block;        MemoryUnit *nextUnit;        MemoryUnit *prevUnit;    &#125;;    struct MemoryBlock    &#123;        uint8_t *data;        size_t size;        size_t freeTotal;        MemoryUnit *freeList;        MemoryUnit *usedList;        MemoryBlock *nextBlock;        MemoryBlock *prevBlock;    &#125;;    using unit_t = MemoryUnit;    using block_t = MemoryBlock;public:    MemoryPool(size_t poolMaxSize = 128 * 1024 * 1024, size_t blockMinSize = 4 * 1024 * 1024);    ~MemoryPool();    void *alloc(size_t size);    void free(void *data);private:    block_t *allocBlock(size_t size);    void freeBlock(block_t *block);    unit_t *allocUnit(size_t size);    void freeUnit(unit_t *unit);private:    size_t m_systemPageSize = 0;    size_t m_poolMaxSize = 0;    size_t m_blockMinSize = 0;    size_t m_poolSize = 0;    block_t *m_blocks = nullptr;&#125;;</code></pre><p>å¯¹äº<code>MemoryPool::allocBlock</code>æ–¹æ³•çš„å®ç°</p><pre><code>MemoryPool::block_t *MemoryPool::allocBlock(size_t size)&#123;    // allocate memory block    auto alignedSize = size + sizeof(block_t) + sizeof(unit_t);    alignedSize = (alignedSize + (m_systemPageSize - 1)) &amp; ~(m_systemPageSize - 1); // align to system page size    if (m_blockMinSize &gt; alignedSize)        alignedSize = m_blockMinSize;    auto block = reinterpret_cast&lt;block_t *&gt;(::VirtualAlloc(nullptr, alignedSize, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE));    if (nullptr == block)        return nullptr;    // initialize memory block    block-&gt;data = reinterpret_cast&lt;uint8_t *&gt;(block) + sizeof(block_t);    block-&gt;size = alignedSize - sizeof(block_t);    auto dataPosition = block-&gt;data;    // initialize memory used unit    block-&gt;usedList = nullptr;    // initialize memory free unit    block-&gt;freeList = reinterpret_cast&lt;unit_t *&gt;(dataPosition);    dataPosition += sizeof(unit_t);    block-&gt;freeList-&gt;data = dataPosition;    block-&gt;freeList-&gt;size = block-&gt;size - (dataPosition - block-&gt;data);    block-&gt;freeList-&gt;nextUnit = block-&gt;freeList;    block-&gt;freeList-&gt;prevUnit = block-&gt;freeList;    block-&gt;freeList-&gt;block = block;    block-&gt;freeTotal = block-&gt;freeList-&gt;size;    // add to block list    if (nullptr != m_blocks)    &#123;        block-&gt;prevBlock = m_blocks-&gt;prevBlock;        block-&gt;nextBlock = m_blocks;        m_blocks-&gt;prevBlock-&gt;nextBlock = block;        m_blocks-&gt;prevBlock = block;    &#125;    else    &#123;        block-&gt;prevBlock = block;        block-&gt;nextBlock = block;        m_blocks = block;    &#125;    // update pool size    m_poolSize += block-&gt;size + sizeof(block_t);    return block;&#125;</code></pre><p>è¿™é‡Œåœ¨ç”³è¯·å†…å­˜æ—¶ç¡®ä¿ä¸å½“å‰æ“ä½œç³»ç»Ÿå†…å­˜é¡µå®šä¹‰å¤§å°å¯¹é½ã€‚</p><p>å¯¹äº<code>MemoryPool::freeBlock</code>æ–¹æ³•çš„å®ç°</p><pre><code>void MemoryPool::freeBlock(block_t *block)&#123;    // remove from block list    if (m_blocks-&gt;prevBlock == block &amp;&amp; m_blocks-&gt;nextBlock == block)        m_blocks = nullptr;    else    &#123;        block-&gt;prevBlock-&gt;nextBlock = block-&gt;nextBlock;        block-&gt;nextBlock-&gt;prevBlock = block-&gt;prevBlock;        if (m_blocks == block)            m_blocks = block-&gt;nextBlock;    &#125;    // update pool size    m_poolSize -= block-&gt;size + sizeof(block_t);    // free memory block    ::VirtualFree(block, 0, MEM_RELEASE);&#125;</code></pre><p>å¯¹äº<code>MemoryPool::allocUnit</code>æ–¹æ³•çš„å®ç°</p><pre><code>MemoryPool::unit_t *MemoryPool::allocUnit(size_t size)&#123;    // check if no block is available    if (nullptr == m_blocks)        return nullptr;    // allocate memory unit    auto block = m_blocks; // first block    do    &#123;        // check if is there no enough memory in the block        if (size &gt; block-&gt;freeTotal)        &#123;            block = block-&gt;nextBlock;            continue;        &#125;        auto unit = block-&gt;freeList; // first free unit        do        &#123;            // check if is there no enough memory in the unit            if (size &gt; unit-&gt;size)            &#123;                unit = unit-&gt;nextUnit;                continue;            &#125;            // check if unit size is more than wanted size, split unit            if (unit-&gt;size &gt; size + sizeof(unit_t))            &#123;                auto newUnit = reinterpret_cast&lt;unit_t *&gt;(unit-&gt;data + size);                newUnit-&gt;data = unit-&gt;data + size + sizeof(unit_t);                newUnit-&gt;size = unit-&gt;size - size - sizeof(unit_t);                newUnit-&gt;nextUnit = unit-&gt;nextUnit;                newUnit-&gt;prevUnit = unit;                newUnit-&gt;block = unit-&gt;block;                unit-&gt;nextUnit-&gt;prevUnit = newUnit;                unit-&gt;nextUnit = newUnit;                unit-&gt;size = size;            &#125;            // remove unit from free list            unit-&gt;prevUnit-&gt;nextUnit = unit-&gt;nextUnit;            unit-&gt;nextUnit-&gt;prevUnit = unit-&gt;prevUnit;            if (block-&gt;freeList == unit)                block-&gt;freeList = unit-&gt;nextUnit;            // add unit to used list            if (nullptr == block-&gt;usedList)            &#123;                block-&gt;usedList = unit;                unit-&gt;nextUnit = unit;                unit-&gt;prevUnit = unit;            &#125;            else            &#123;                unit-&gt;nextUnit = block-&gt;usedList;                unit-&gt;prevUnit = block-&gt;usedList-&gt;prevUnit;                block-&gt;usedList-&gt;prevUnit-&gt;nextUnit = unit;                block-&gt;usedList-&gt;prevUnit = unit;            &#125;            // update free total            block-&gt;freeTotal -= unit-&gt;size;            return unit;        &#125; while (unit != block-&gt;freeList);    &#125; while (block != m_blocks);    return nullptr;&#125;</code></pre><p>å¯¹äº<code>MemoryPool::freeUnit</code>æ–¹æ³•çš„å®ç°</p><pre><code>void MemoryPool::freeUnit(unit_t *unit)&#123;    auto freeSize = unit-&gt;size;    // remove unit from used list    if (unit-&gt;prevUnit == unit &amp;&amp; unit-&gt;nextUnit == unit)        unit-&gt;block-&gt;usedList = nullptr;    else    &#123;        unit-&gt;prevUnit-&gt;nextUnit = unit-&gt;nextUnit;        unit-&gt;nextUnit-&gt;prevUnit = unit-&gt;prevUnit;        if (unit-&gt;block-&gt;usedList == unit)            unit-&gt;block-&gt;usedList = unit-&gt;nextUnit;    &#125;    // add the unit to the free list, order by address    if (nullptr == unit-&gt;block-&gt;freeList)    &#123;        unit-&gt;nextUnit = unit;        unit-&gt;prevUnit = unit;        unit-&gt;block-&gt;freeList = unit;    &#125;    else    &#123;        auto prevUnit = unit-&gt;block-&gt;freeList;        auto nextUnit = unit-&gt;block-&gt;freeList-&gt;nextUnit;        if (prevUnit == prevUnit-&gt;prevUnit &amp;&amp; prevUnit == prevUnit-&gt;nextUnit)        &#123;            // combine units if is there near units            if (unit-&gt;data + unit-&gt;size == reinterpret_cast&lt;uint8_t *&gt;(nextUnit)) // combine next unit            &#123;                unit-&gt;size += nextUnit-&gt;size + sizeof(unit_t);                unit-&gt;nextUnit = unit;                unit-&gt;prevUnit = unit;                unit-&gt;block-&gt;freeList = unit;            &#125;            else if (prevUnit-&gt;data + prevUnit-&gt;size == reinterpret_cast&lt;uint8_t *&gt;(unit)) // combine prev unit                prevUnit-&gt;size += unit-&gt;size + sizeof(unit_t);            else // add unit to free list            &#123;                unit-&gt;nextUnit = nextUnit;                unit-&gt;prevUnit = nextUnit;                nextUnit-&gt;prevUnit = unit;                nextUnit-&gt;nextUnit = unit;                unit-&gt;block-&gt;freeList = nextUnit &lt; unit ? nextUnit : unit;            &#125;        &#125;        else        &#123;            // find insert position            while (nextUnit != unit-&gt;block-&gt;freeList &amp;&amp; nextUnit &lt; unit)            &#123;                prevUnit = nextUnit;                nextUnit = nextUnit-&gt;nextUnit;            &#125;            // combine the units if is there are near units            if (unit-&gt;data + unit-&gt;size == reinterpret_cast&lt;uint8_t *&gt;(nextUnit)) // combine next unit            &#123;                unit-&gt;size += nextUnit-&gt;size + sizeof(unit_t);                unit-&gt;nextUnit = nextUnit-&gt;nextUnit;                unit-&gt;prevUnit = nextUnit-&gt;prevUnit;                nextUnit-&gt;prevUnit-&gt;nextUnit = unit;                nextUnit-&gt;nextUnit-&gt;prevUnit = unit;                nextUnit = nextUnit-&gt;nextUnit;            &#125;            if (prevUnit-&gt;data + prevUnit-&gt;size == reinterpret_cast&lt;uint8_t *&gt;(unit)) // combine prev unit            &#123;                prevUnit-&gt;size += unit-&gt;size + sizeof(unit_t);                prevUnit-&gt;nextUnit = nextUnit;                nextUnit-&gt;prevUnit = prevUnit;            &#125;        &#125;    &#125;    // update free total    m_blocks-&gt;freeTotal += freeSize;&#125;</code></pre><p>è¿™4ä¸ªä¸»è¦çš„æ–¹æ³•å®ç°å¥½ä¹‹åå°±æ˜¯<code>MemoryPool::alloc</code>ä¸<code>MemoryPool::free</code>ä¸¤ä¸ªæ–¹æ³•çš„å®ç°äº†ï¼Œæˆ‘ä»¬è¦åšçš„åªéœ€è¦å¯¹ä¸Šé¢4ä¸ªæ–¹æ³•è¿›è¡Œé€»è¾‘çš„å°è£…å°±å¥½äº†ã€‚</p><p>å¯¹äº<code>MemoryPool::alloc</code>æ–¹æ³•çš„å®ç°</p><pre><code>void *MemoryPool::alloc(size_t size)&#123;    if (0 == size)        return nullptr;    if (nullptr == m_blocks)        m_blocks = allocBlock(size);    auto unit = allocUnit(size);    if (nullptr == unit)    &#123;        if (size + m_poolSize &gt; m_poolMaxSize)            throw std::bad_alloc();        auto block = allocBlock(size);        if (nullptr == block)            return nullptr;        unit = allocUnit(size);        if (nullptr == unit)            return nullptr;    &#125;    return unit-&gt;data;&#125;</code></pre><p>å¯¹äº<code>MemoryPool::free</code>æ–¹æ³•çš„å®ç°</p><pre><code>void MemoryPool::free(void *data)&#123;    if (nullptr == data)        return;    auto unit = reinterpret_cast&lt;unit_t *&gt;(reinterpret_cast&lt;uint8_t *&gt;(data) - sizeof(unit_t));    if (nullptr == unit)        return;    if (nullptr == unit-&gt;block)        return;    freeUnit(unit);&#125;</code></pre><p>åˆ°è¿™é‡Œï¼Œå†…å­˜æ± çš„ä¸»ä½“å·²ç»æ­å»ºå¥½äº†ï¼Œé‚£æ¥ä¸‹æ¥å°±å¯¹æ¯”ä¸€ä¸‹æ€§èƒ½ã€‚</p><h2 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h2><p>æµ‹è¯•ç”¨çš„ä»£ç å¦‚ä¸‹</p><pre><code>MemoryPool g_memoryPool(1 * 1024 * 1024 * 1024);template &lt;typename runable_t&gt;struct RunTickCount&#123;    runable_t &amp;&amp;runable;    uint64_t operator()() const noexcept    &#123;        auto result = __rdtsc();        runable();        return __rdtsc() - result;    &#125;&#125;;void test01()&#123;    for (size_t i = 0; i &lt; 100; i++)    &#123;        auto data = new char[8 * 1024 * 1024];        delete[] data;    &#125;&#125;void test02()&#123;    for (size_t i = 0; i &lt; 100; i++)    &#123;        auto data = ::VirtualAlloc(nullptr, 8 * 1024 * 1024, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);        ::VirtualFree(data, 0, MEM_RELEASE);    &#125;&#125;void test03()&#123;    for (size_t i = 0; i &lt; 100; i++)    &#123;        auto data = g_memoryPool.alloc(8 * 1024 * 1024);        g_memoryPool.free(data);    &#125;&#125;void test04()&#123;    for (size_t i = 0; i &lt; 100; i++)        auto data = new char[8 * 1024 * 1024];&#125;void test05()&#123;    for (size_t i = 0; i &lt; 100; i++)        auto data = ::VirtualAlloc(nullptr, 8 * 1024 * 1024, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);&#125;void test06()&#123;    for (size_t i = 0; i &lt; 100; i++)        auto data = g_memoryPool.alloc(8 * 1024 * 1024);&#125;int main()&#123;    try    &#123;        std::cout &lt;&lt; &quot;[*] test 100 loop with allocating and freeing the memory of 8MB&quot; &lt;&lt; std::endl;        std::cout &lt;&lt; &quot;[=] std new-delete time: &quot; &lt;&lt; RunTickCount&lt;decltype(test01)&gt;&#123;test01&#125;() &lt;&lt; &quot; ticks&quot; &lt;&lt; std::endl;        std::cout &lt;&lt; &quot;[=] windows virtualAlloc-Free time: &quot; &lt;&lt; RunTickCount&lt;decltype(test02)&gt;&#123;test02&#125;() &lt;&lt; &quot; ticks&quot; &lt;&lt; std::endl;        std::cout &lt;&lt; &quot;[=] memory pool alloc-free time: &quot; &lt;&lt; RunTickCount&lt;decltype(test03)&gt;&#123;test03&#125;() &lt;&lt; &quot; ticks&quot; &lt;&lt; std::endl;        std::cout &lt;&lt; &quot;[=] std just new time: &quot; &lt;&lt; RunTickCount&lt;decltype(test04)&gt;&#123;test04&#125;() &lt;&lt; &quot; ticks&quot; &lt;&lt; std::endl;        std::cout &lt;&lt; &quot;[=] windows just virtualAlloc time: &quot; &lt;&lt; RunTickCount&lt;decltype(test05)&gt;&#123;test05&#125;() &lt;&lt; &quot; ticks&quot; &lt;&lt; std::endl;        std::cout &lt;&lt; &quot;[=] memory pool just alloc time: &quot; &lt;&lt; RunTickCount&lt;decltype(test06)&gt;&#123;test06&#125;() &lt;&lt; &quot; ticks&quot; &lt;&lt; std::endl;        std::cout &lt;&lt; &quot;[+] test passed&quot; &lt;&lt; std::endl;    &#125;    catch (const std::exception &amp;e)    &#123;        std::cerr &lt;&lt; &quot;[-] &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;    return 0;&#125;</code></pre><p>ç¼–è¯‘ä½¿ç”¨çš„å‚æ•°<code>cl .\test_memorypool.cc /O2 /EHsc /std:c++20</code></p><p><img src="/images/1650222097.jpg" alt="æ€§èƒ½æµ‹è¯•ç»“æœ"></p><p>è¿™é‡Œä»…ç”¨WindowsAPIä¸å†…å­˜æ± çš„æ€§èƒ½åšæ¯”è¾ƒï¼Œå¯¹äº<code>new</code>ä¸<code>delete</code>å°±å½“çœ‹ä¸ªä¹å‘µã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜æ± åœ¨å¾ªç¯ç”³è¯·ä¸é‡Šæ”¾çš„æµ‹è¯•ä¸­ä¸€éª‘ç»å°˜ã€‚<br>è¿™æ˜¯å› ä¸ºåœ¨<code>freeUnit</code>æ—¶æˆ‘ä»¬å¹¶æ²¡æœ‰çœŸçš„æŠŠå†…å­˜è¿˜ç»™ç³»ç»Ÿï¼Œè€Œæ˜¯äº¤ç»™å†…å­˜æ± æ¥ä¿ç®¡ã€‚<br>è€Œç¬¬äºŒæ¬¡è¿›å…¥<code>allocUnit</code>æ—¶å› ä¸ºè¿˜æœ‰å¯ç”¨çš„å†…å­˜ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åˆ†é…ï¼Œä¸éœ€è¦å‘ç³»ç»Ÿç”³è¯·æ–°çš„å†…å­˜ï¼</p><p>ä½†æ˜¯å†…å­˜æ± åœ¨ä»…ç”³è¯·å†…å­˜ä¸é‡Šæ”¾çš„æµ‹è¯•ä¸­è¢«WindowsAPIæ‰€å‡»è´¥ï¼Œè¿™æ˜¯å› ä¸ºä»…ç”³è¯·å†…å­˜çš„è¯è°ƒç”¨WindowsAPIä»…éœ€ä¸€æ¬¡<code>VirtualAlloc</code>çš„è´¹ç”¨ã€‚<br>è€Œå†…å­˜æ± æ¯æ¬¡è¿›è¡ŒåŠ¨æ€æ‰©å®¹æ—¶ï¼Œä¸ä»…éœ€è¦ä¸€æ¬¡<code>VirtualAlloc</code>çš„è´¹ç”¨ï¼Œè¿˜éœ€è¦å¯¹å†…å­˜æ± ä¸­çš„å„é¡¹å‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œæ‰€ä»¥å¯¼è‡´è´¹ç”¨å‡é«˜ã€‚</p><p>é‚£ä¹ˆæ˜¯å› ä¸ºè¿™ä¸ªå†…å­˜æ± å¤ªåƒåœ¾äº†ï¼Ÿå…¶å®ä¸ç„¶ï¼Œæˆ‘ä»¬é»˜è®¤è®¾å®šäº†å†…å­˜æ± çš„æœ€å°å—å¤§å°æ—¶4MBï¼Œè€Œæ¯æ¬¡ç”³è¯·çš„å†…å­˜å¤§å°ä¸º8MBï¼Œè¿™å°±å¯¼è‡´äº†å†…å­˜æ± éœ€è¦ä¸æ–­åœ°è¿›è¡ŒåŠ¨æ€æ‰©å®¹ã€‚<br>å¦‚æœæˆ‘ä»¬è¿™é‡ŒæŠŠå†…å­˜æ± çš„å—å†…å­˜å¤§å°è®¾ç½®çš„æ›´å¤§ï¼Œæˆ–è€…è¯´æˆ‘ä»¬æ¯æ¬¡ç”³è¯·çš„å†…å­˜å¤§å°å¹¶ä¸è¶…è¿‡é»˜è®¤å—å¤§å°ï¼Œé‚£ä¹ˆæƒ…å†µåˆä¼šæœ‰æ‰€ä¸åŒã€‚</p><p>æˆ‘ä»¬æŠŠæ¯æ¬¡ç”³è¯·çš„å†…å­˜å¤§å°ä¿®æ”¹ä¸º4KB</p><pre><code>void test05()&#123;    for (size_t i = 0; i &lt; 100; i++)        auto data = ::VirtualAlloc(nullptr, 4 * 1024, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);&#125;void test06()&#123;    for (size_t i = 0; i &lt; 100; i++)        auto data = g_memoryPool.alloc(4 * 1024);&#125;</code></pre><p>å†æ¥çœ‹ç»“æœ</p><p><img src="/images/1650222098.jpg" alt="æ€§èƒ½æµ‹è¯•ç»“æœ"></p><p>è¿™æ¬¡è½®åˆ°WindowsAPIè¢«å†…å­˜æ± å‡»è´¥äº†ã€‚ç”±æ­¤å¯è§ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹å†…å­˜æ± éƒ½æ˜¯é€‚ç”¨çš„ï¼Œä»…åœ¨ç‰¹å®šæƒ…å†µä¸‹å†…å­˜æ± èƒ½è¾ƒå¥½çš„å‘æŒ¥å…¶ä½œç”¨ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€æ®µç¨‹åºæ¥dumpå†…å­˜æ± çš„å†…å­˜ç»“æ„ï¼Œäº†è§£ä¸€ä¸‹åœ¨<code>freeUnit</code>æ—¶ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><h2 id="å†…å­˜æ± é‡Šæ”¾å•å…ƒæ—¶çš„Graphvizå›¾"><a href="#å†…å­˜æ± é‡Šæ”¾å•å…ƒæ—¶çš„Graphvizå›¾" class="headerlink" title="å†…å­˜æ± é‡Šæ”¾å•å…ƒæ—¶çš„Graphvizå›¾"></a>å†…å­˜æ± é‡Šæ”¾å•å…ƒæ—¶çš„Graphvizå›¾</h2><p>å…ˆä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»<code>MemoryPoolX</code>å¹¶ç»§æ‰¿<code>MemoryPool</code>ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ªç±»é‡Œé¢è¿›è¡Œdumpæ“ä½œ</p><pre><code>class MemoryPoolX final : public MemoryPool&#123;public:    MemoryPoolX(size_t poolMaxSize = 128 * 1024 * 1024, size_t blockMinSize = 4 * 1024 * 1024)        : MemoryPool(poolMaxSize, blockMinSize)    &#123;    &#125;    ~MemoryPoolX()    &#123;    &#125;    void dumpGraphviz()    &#123;        std::ofstream out(&quot;test_memorypool.dot&quot;);        out &lt;&lt; &quot;digraph DataStructure &#123;\n&quot;;        out &lt;&lt; &quot;node [shape=record];\n&quot;;        out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; this &lt;&lt; &quot;\&quot; [label=\&quot;&#123;&lt;f0&gt;MemoryPool|&quot;            &lt;&lt; this &lt;&lt; &quot;|&quot;            &lt;&lt; &quot;&#123;systemPageSize|&quot; &lt;&lt; m_systemPageSize &lt;&lt; &quot;&#125;|&quot;            &lt;&lt; &quot;&#123;poolMaxSize|&quot; &lt;&lt; m_poolMaxSize &lt;&lt; &quot;&#125;|&quot;            &lt;&lt; &quot;&#123;blockMinSize|&quot; &lt;&lt; m_blockMinSize &lt;&lt; &quot;&#125;|&quot;            &lt;&lt; &quot;&#123;poolSize|&quot; &lt;&lt; m_poolSize &lt;&lt; &quot;&#125;|&quot;            &lt;&lt; &quot;&#123;&lt;f1&gt;blocks|&quot; &lt;&lt; m_blocks &lt;&lt; &quot;&#125;&quot;            &lt;&lt; &quot;&#125;\&quot; color=\&quot;#409eff\&quot;];\n&quot;;        block_t *block = m_blocks;        do        &#123;            out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; block &lt;&lt; &quot;\&quot; [label=\&quot;&#123;&lt;f0&gt;MemoryBlock|&quot;                &lt;&lt; block &lt;&lt; &quot;|&quot;                &lt;&lt; &quot;&#123;data|&quot; &lt;&lt; block-&gt;data &lt;&lt; &quot;&#125;|&quot;                &lt;&lt; &quot;&#123;size|&quot; &lt;&lt; block-&gt;size &lt;&lt; &quot;&#125;|&quot;                &lt;&lt; &quot;&#123;freeTotal|&quot; &lt;&lt; block-&gt;freeTotal &lt;&lt; &quot;&#125;|&quot;                &lt;&lt; &quot;&#123;&lt;f1&gt;freeList|&quot; &lt;&lt; block-&gt;freeList &lt;&lt; &quot;&#125;|&quot;                &lt;&lt; &quot;&#123;&lt;f2&gt;usedList|&quot; &lt;&lt; block-&gt;usedList &lt;&lt; &quot;&#125;|&quot;                &lt;&lt; &quot;&#123;&lt;f3&gt;nextBlock|&quot; &lt;&lt; block-&gt;nextBlock &lt;&lt; &quot;&#125;|&quot;                &lt;&lt; &quot;&#123;&lt;f4&gt;prevBlock|&quot; &lt;&lt; block-&gt;prevBlock &lt;&lt; &quot;&#125;&quot;                &lt;&lt; &quot;&#125;\&quot; color=\&quot;#909399\&quot;];\n&quot;;            unit_t *unit = block-&gt;usedList;            do            &#123;                out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; unit &lt;&lt; &quot;\&quot; [label=\&quot;&#123;&lt;f0&gt;MemoryUnit|&quot;                    &lt;&lt; unit &lt;&lt; &quot;|&quot;                    &lt;&lt; &quot;&#123;data|&quot; &lt;&lt; unit-&gt;data &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;size|&quot; &lt;&lt; unit-&gt;size &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;block|&quot; &lt;&lt; unit-&gt;block &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;&lt;f1&gt;nextUnit|&quot; &lt;&lt; unit-&gt;nextUnit &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;&lt;f2&gt;prevUnit|&quot; &lt;&lt; unit-&gt;prevUnit &lt;&lt; &quot;&#125;&quot;                    &lt;&lt; &quot;&#125;\&quot; color=\&quot;#f56c6c\&quot;];\n&quot;;                if (unit == block-&gt;usedList)                &#123;                    out &lt;&lt; &quot;subgraph cluster_&quot; &lt;&lt; unit &lt;&lt; &quot; &#123;\n&quot;                        &lt;&lt; &quot;label=\&quot;usedList\&quot;;\n&quot;;                    out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; block &lt;&lt; &quot;\&quot;:f2 -&gt; \&quot;&quot; &lt;&lt; unit &lt;&lt; &quot;\&quot;:f0 [style=\&quot;dotted\&quot; color=\&quot;#0000ff\&quot;];\n&quot;;                &#125;                else                    out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; unit-&gt;nextUnit &lt;&lt; &quot;\&quot;:f2 -&gt; \&quot;&quot; &lt;&lt; unit &lt;&lt; &quot;\&quot;:f0 [style=\&quot;dotted\&quot; color=\&quot;#0000ff\&quot;];\n&quot;;                unit = unit-&gt;nextUnit;            &#125; while (unit != block-&gt;usedList);            out &lt;&lt; &quot;&#125;\n&quot;;            unit = block-&gt;freeList;            do            &#123;                out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; unit &lt;&lt; &quot;\&quot; [label=\&quot;&#123;&lt;f0&gt;MemoryUnit|&quot;                    &lt;&lt; unit &lt;&lt; &quot;|&quot;                    &lt;&lt; &quot;&#123;data|&quot; &lt;&lt; unit-&gt;data &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;size|&quot; &lt;&lt; unit-&gt;size &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;block|&quot; &lt;&lt; unit-&gt;block &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;&lt;f1&gt;nextUnit|&quot; &lt;&lt; unit-&gt;nextUnit &lt;&lt; &quot;&#125;|&quot;                    &lt;&lt; &quot;&#123;&lt;f2&gt;prevUnit|&quot; &lt;&lt; unit-&gt;prevUnit &lt;&lt; &quot;&#125;&quot;                    &lt;&lt; &quot;&#125;\&quot; color=\&quot;#67c23a\&quot;];\n&quot;;                if (unit == block-&gt;freeList)                &#123;                    out &lt;&lt; &quot;subgraph cluster_&quot; &lt;&lt; unit &lt;&lt; &quot; &#123;\n&quot;                        &lt;&lt; &quot;label=\&quot;freeList\&quot;;\n&quot;;                    out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; block &lt;&lt; &quot;\&quot;:f1 -&gt; \&quot;&quot; &lt;&lt; unit &lt;&lt; &quot;\&quot;:f0 [style=\&quot;dashed\&quot; color=\&quot;#0000ff\&quot;];\n&quot;;                &#125;                else                    out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; unit-&gt;nextUnit &lt;&lt; &quot;\&quot;:f1 -&gt; \&quot;&quot; &lt;&lt; unit &lt;&lt; &quot;\&quot;:f0 [style=\&quot;dashed\&quot; color=\&quot;#0000ff\&quot;];\n&quot;;                unit = unit-&gt;nextUnit;            &#125; while (unit != block-&gt;freeList);            out &lt;&lt; &quot;&#125;\n&quot;;            if (block == m_blocks)                out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; this &lt;&lt; &quot;\&quot;:f1 -&gt; \&quot;&quot; &lt;&lt; block &lt;&lt; &quot;\&quot;:f0 [color=\&quot;#0000ff\&quot;];\n&quot;;            else                out &lt;&lt; &quot;\&quot;&quot; &lt;&lt; block-&gt;nextBlock &lt;&lt; &quot;\&quot;:f3 -&gt; \&quot;&quot; &lt;&lt; block &lt;&lt; &quot;\&quot;:f0 [color=\&quot;#0000ff\&quot;];\n&quot;;            block = block-&gt;nextBlock;        &#125; while (block != m_blocks);        out &lt;&lt; &quot;&#125;&quot;;        out.close();    &#125;&#125;;MemoryPoolX g_memoryPool(1 * 1024 * 1024 * 1024);void dumpGraphviz()&#123;    std::vector&lt;void *&gt; datas;    for (size_t i = 0; i &lt; 6; i++)        datas.push_back(g_memoryPool.alloc(i * 1024));    datas.push_back(g_memoryPool.alloc(8 * 1024 * 1024));    datas.push_back(g_memoryPool.alloc(8 * 1024 * 1024));    g_memoryPool.dumpGraphviz();    std::cout &lt;&lt; &quot;dump01&quot; &lt;&lt; std::endl;    getchar();    g_memoryPool.free(datas[2]);    g_memoryPool.dumpGraphviz();    std::cout &lt;&lt; &quot;dump02&quot; &lt;&lt; std::endl;    getchar();    g_memoryPool.free(datas[3]);    g_memoryPool.dumpGraphviz();    std::cout &lt;&lt; &quot;dump03&quot; &lt;&lt; std::endl;    getchar();&#125;</code></pre><p>ç„¶ååœ¨<code>main</code>å‡½æ•°ä¸­è°ƒç”¨<code>dumpGraphviz</code>å°±å¥½äº†ï¼Œç›´æ¥çœ‹ç»“æœ(è‹¥çœ‹ä¸æ¸…å¯å¯¹ç€å›¾ç‰‡å³é”®ï¼Œç„¶åé€‰æ‹©<code>åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€å›¾ç‰‡</code>)</p><p>ç”³è¯·å®Œå†…å­˜åçš„å†…å­˜å¸ƒå±€æƒ…å†µï¼Œå…¶ä¸­çº¢è‰²ä¸ºå·²ä½¿ç”¨çš„ï¼Œç»¿è‰²ä¸ºç©ºé—²çš„</p><p><img src="/images/1650222099.jpeg" alt="graphvizDump01"></p><p>é‡Šæ”¾å¤§å°ä¸º<code>2048</code>çš„è¿™ä¸ªå†…å­˜å•å…ƒåçš„å†…å­˜å¸ƒå±€æƒ…å†µ</p><p><img src="/images/1650222100.jpeg" alt="graphvizDump02"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå†…å­˜å—çš„ç©ºé—²å†…å­˜å•å…ƒé“¾è¡¨ä¸­å¤šå‡ºäº†ä¸€ä¸ªå¤§å°ä¸º<code>2048</code>çš„ç©ºé—²å†…å­˜å•å…ƒï¼Œå› ä¸ºå…¶ä¸å¤§å°ä¸º<code>4178648</code>çš„ç©ºé—²å†…å­˜å•å…ƒå¹¶ä¸ä¸´è¿‘ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰è¿›è¡Œå†…å­˜å•å…ƒ(ç¢ç‰‡)çš„åˆå¹¶ã€‚</p><p>é‡Šæ”¾å¤§å°ä¸º<code>3072</code>çš„è¿™ä¸ªå†…å­˜å•å…ƒåçš„å†…å­˜å¸ƒå±€æƒ…å†µ</p><p><img src="/images/1650222101.jpeg" alt="graphvizDump03"></p><p>åœ¨é‡Šæ”¾å¤§å°ä¸º<code>3072</code>çš„å†…å­˜å•å…ƒçš„åŒæ—¶æ£€æµ‹åˆ°å…¶ä¸å¤§å°ä¸º<code>2048</code>çš„ç©ºé—²å†…å­˜å•å…ƒä¸ºä¸´è¿‘å†…å­˜å•å…ƒï¼Œæ‰€ä»¥ä¼šè¿›è¡Œç¢ç‰‡çš„åˆå¹¶ã€‚<br>ä¸ºä»€ä¹ˆä¼šç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º<code>5160</code>çš„ç©ºé—²å†…å­˜å•å…ƒè€Œä¸æ˜¯å¤§å°ä¸º<code>5120</code>çš„å•å…ƒæ˜¯å› ä¸ºåˆå¹¶æˆä¸€ä¸ªæ—¶éœ€è¦ä¸¢å¼ƒè¢«åˆå¹¶çš„å†…å­˜å•å…ƒçš„å¤´éƒ¨ä¿¡æ¯ï¼Œè€Œå¤´éƒ¨ä¿¡æ¯å ç”¨çš„å†…å­˜å¤§å°ä¸º<code>40</code>å­—èŠ‚ï¼Œå› æ­¤åˆå¹¶åå°±æ˜¯<code>5160</code>å­—èŠ‚ã€‚å…¶ä»–å•å…ƒä¾æ­¤ç±»æ¨ã€‚</p><p>åˆ°è¿™é‡Œï¼Œå†…å­˜æ± çš„å†…å®¹åŸºæœ¬å°±è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p><h2 id="Garbage-Collection"><a href="#Garbage-Collection" class="headerlink" title="Garbage Collection"></a>Garbage Collection</h2><p><strong>æ³¨æ„ï¼š</strong><code>è¿™é‡Œæ‰€è¯´çš„æ ‡è®°ä½¿ç”¨çš„æ˜¯å¼•ç”¨è®¡æ•°çš„æ–¹å¼æ¥æ¨¡æ‹Ÿï¼ŒçœŸæ­£çš„GCä¸­ä¸åº”å‡ºç°å¼•ç”¨è®¡æ•°è¿™ç§ä¸œè¥¿ã€‚</code></p><p>å…¶å®ä¸ªäººè§‰å¾—åœ¨C++ä¸­ä½¿ç”¨GCçš„æ„ä¹‰ä¸å¤§ï¼Œè™½ç„¶ä¼šæ›´æ–¹ä¾¿ä¸€ç‚¹ï¼Œä½†æ˜¯ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆä¸ä½œç”¨åŸŸé™å®šè¿›è¡Œè‡ªåŠ¨å†…å­˜ç®¡ç†å…¶å®ä¹Ÿå·®ä¸å¤šï¼Œæ‰€ä»¥GCè¿™é‡Œçš„å†…å®¹å°±ç®—æ˜¯å†™ç€ç©çš„äº†ã€‚</p><p>æƒ³è¦åœ¨C++ä¸­å®ç°GCï¼Œæˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯è¦å¯¹<code>raw pointer</code>è¿›è¡Œå°è£…ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨çš„æ˜¯<code>raw pointer</code>çš„è¯ï¼Œæˆ‘ä»¬æ— æ³•å¯¹æ•°æ®çš„å¼•ç”¨è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿæ— æ³•è·Ÿè¸ªæŒ‡é’ˆçš„ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šGCè¿è¡Œåä»æœ‰æœªçŸ¥ä»£ç å¯¹è¢«GCçš„æŒ‡é’ˆ(<code>raw pointer</code>)è¿›è¡Œè®¿é—®ï¼Œé€ æˆç¨‹åºçš„å´©æºƒã€‚</p><h3 id="åŸå§‹æŒ‡é’ˆçš„å°è£…"><a href="#åŸå§‹æŒ‡é’ˆçš„å°è£…" class="headerlink" title="åŸå§‹æŒ‡é’ˆçš„å°è£…"></a>åŸå§‹æŒ‡é’ˆçš„å°è£…</h3><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨å¼•ç”¨è®¡æ•°çš„æ–¹å¼æ¥è·Ÿè¸ªæŒ‡é’ˆï¼Œä¸Šä»£ç ã€‚</p><p>å…ˆç»™å†…å­˜å•å…ƒæ·»åŠ ä¸‰ä¸ªå±æ€§</p><pre><code>// å†…å­˜å•å…ƒstruct MemoryUnit&#123;    uint8_t *data;        // å†…å­˜å•å…ƒçš„æ•°æ®åœ°å€    size_t size;          // å†…å­˜çš„æ•°æ®å¤§å°    size_t refIndex;      // å†…å­˜å•å…ƒå¼•ç”¨è¡¨çš„å¯¹åº”çš„ç´¢å¼•(ç”¨äºå†…å­˜æ•´ç†ç®—æ³•æ›´æ–°å¼•ç”¨)    size_t refCount;      // å†…å­˜å•å…ƒå¼•ç”¨è®¡æ•°(ç”¨äºå†…å­˜æ ‡è®°ç®—æ³•)    size_t aliveCount;    // å†…å­˜å•å…ƒçš„GCå­˜æ´»è®¡æ•°(ç”¨äºåˆ†ä»£ç†è®º)    MemoryBlock *block;   // å†…å­˜å•å…ƒæ‰€å±çš„å†…å­˜å—    MemoryUnit *nextUnit; // ä¸‹ä¸€ä¸ªå†…å­˜å•å…ƒ    MemoryUnit *prevUnit; // ä¸Šä¸€ä¸ªå†…å­˜å•å…ƒ&#125;;</code></pre><p>ç„¶åç»™<code>MemoryPool</code>æ·»åŠ ä¸€ä¸ªæˆå‘˜<code>std::unordered_map&lt;size_t, unit_t *&gt; m_refUnits</code>ï¼Œç”¨æ¥è®°å½•ç”¨äºæ•´ç†ç®—æ³•çš„æŒ‡é’ˆå¼•ç”¨ã€‚å¹¶æ·»åŠ ä¸€ä¸ª<code>[]</code>è¿ç®—ç¬¦çš„é‡è½½</p><pre><code>unit_t *operator[](size_t index)&#123;    return m_refUnits[index];&#125;</code></pre><p>æ–¹ä¾¿å¯¹äºå†…å­˜å•å…ƒçš„è®¿é—®ã€‚</p><p>åŸå§‹æŒ‡é’ˆçš„å°è£…ç±»</p><pre><code>class GCMemory&#123;public:    friend MemoryPool;public:    GCMemory(MemoryPool *pool, size_t unitIndex)        : m_pool(pool),          m_unitIndex(unitIndex)    &#123;        (*m_pool)[m_unitIndex]-&gt;refCount++;    &#125;    GCMemory()        : m_pool(nullptr),          m_unitIndex(0)    &#123;    &#125;    ~GCMemory()    &#123;        if (nullptr == m_pool)            return;        auto unit = (*m_pool)[m_unitIndex];        if (nullptr != unit)            unit-&gt;refCount--;    &#125;    GCMemory(GCMemory &amp;other)        : m_pool(other.m_pool)    &#123;        (*m_pool)[m_unitIndex]-&gt;refCount++;    &#125;    GCMemory(GCMemory &amp;&amp;other)        : m_pool(other.m_pool)    &#123;        other.m_pool = nullptr;    &#125;    GCMemory &amp;operator=(GCMemory &amp;other)    &#123;        m_pool = other.m_pool;        (*m_pool)[m_unitIndex]-&gt;refCount++;        return *this;    &#125;    GCMemory &amp;operator=(GCMemory &amp;&amp;other)    &#123;        m_pool = other.m_pool;        other.m_pool = nullptr;        return *this;    &#125;    GCMemory &amp;operator++()    &#123;        (*m_pool)[m_unitIndex]-&gt;refCount++;        return *this;    &#125;    GCMemory &amp;operator--()    &#123;        auto unit = (*m_pool)[m_unitIndex];        if (unit-&gt;refCount &gt; 0)            unit-&gt;refCount--;        return *this;    &#125;    operator bool() const    &#123;        auto unit = (*m_pool)[m_unitIndex];        return nullptr != m_pool &amp;&amp; nullptr != unit &amp;&amp; unit-&gt;refCount &gt; 0;    &#125;    operator void *() const noexcept    &#123;        auto unit = (*m_pool)[m_unitIndex];        return nullptr == unit ? nullptr : unit-&gt;data;    &#125;    operator uint8_t *() const noexcept    &#123;        auto unit = (*m_pool)[m_unitIndex];        return nullptr == unit ? nullptr : unit-&gt;data;    &#125;private:    MemoryPool *m_pool;    size_t m_unitIndex;&#125;;using gc_t = GCMemory;</code></pre><p>å¯¹äº<code>MemoryPool::allocGC</code>æ–¹æ³•çš„å®ç°</p><pre><code>MemoryPool::gc_t MemoryPool::allocGC(size_t size)&#123;    if (0 == size)        return &#123;&#125;;    if (nullptr == m_blocks)        m_blocks = allocBlock(size);    auto unit = allocUnit(size);    if (nullptr == unit)    &#123;        if (size + m_poolSize &gt; m_poolMaxSize)            throw std::bad_alloc();        auto block = allocBlock(size);        if (nullptr == block)            return &#123;&#125;;        unit = allocUnit(size);        if (nullptr == unit)            return &#123;&#125;;    &#125;    static size_t unitIndex = 0;    m_refUnits[unitIndex] = unit;    unit-&gt;refIndex = unitIndex++;    unit-&gt;refCount = 0;    unit-&gt;aliveCount = 0;    return gc_t(this, unit-&gt;refIndex);&#125;</code></pre><p>é‚£ä¹ˆæ¥ç¨å¾®æµ‹è¯•ä¸€ä¸‹</p><p><img src="/images/1650222102.jpeg" alt="ä½œç”¨åŸŸæµ‹è¯•01"></p><p><img src="/images/1650222103.jpeg" alt="ä½œç”¨åŸŸæµ‹è¯•01"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆšç”³è¯·å®Œçš„æ—¶å€™å¼•ç”¨è®¡æ•°ä¸º<code>1</code>ï¼Œå¹¶åœ¨èµ°å‡ºä½œç”¨åŸŸåå˜ä¸ºäº†<code>0</code>ã€‚</p><h3 id="å†…å­˜æ ‡è®°ç®—æ³•"><a href="#å†…å­˜æ ‡è®°ç®—æ³•" class="headerlink" title="å†…å­˜æ ‡è®°ç®—æ³•"></a>å†…å­˜æ ‡è®°ç®—æ³•</h3><pre><code>void MemoryPool::markedGC()&#123;    for (auto &amp;unit : m_refUnits)    &#123;        if (0 != unit.second-&gt;refCount)            continue;        freeUnit(unit.second);        unit.second = nullptr;    &#125;&#125;</code></pre><p>è¿™ä¸ªå…¶å®æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå½“å‘ç”ŸGCçš„æ—¶å€™æ£€æŸ¥å†…å­˜å•å…ƒçš„å¼•ç”¨è®¡æ•°ï¼Œè‹¥ä¸º<code>0</code>åˆ™è¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨ï¼Œè¿›è¡Œå†…å­˜çš„å›æ”¶ã€‚</p><p>çœ‹ä¸€ä¸‹æ•ˆæœ</p><p><img src="/images/1650222104.jpeg" alt="å†…å­˜æ ‡è®°ç®—æ³•ç»“æœ"></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬æ‰‹åŠ¨å°†<code>data02</code>çš„å¼•ç”¨è®¡æ•°<code>-1</code>æ¥æ¨¡æ‹Ÿæ— å¼•ç”¨çš„æƒ…å†µã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ‰§è¡ŒGCä¹‹åå¼•ç”¨è®¡æ•°ä¸º<code>0</code>çš„<code>data02</code>çš„å¼•ç”¨æŒ‡é’ˆå˜æˆäº†<code>nullptr</code>ï¼Œè¯´æ˜GCè¿è¡ŒæˆåŠŸã€‚æ­£å¸¸æƒ…å†µä¸‹åªè®ºæ ‡è®°å›æ”¶ç®—æ³•çš„è¯å†…å­˜æ± ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œä½†æˆ‘ä»¬è¿™é‡Œåœ¨é‡Šæ”¾çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›è¡Œä¸´è¿‘ç¢ç‰‡çš„åˆå¹¶ï¼Œæ‰€ä»¥æƒ…å†µå…¶å®è¿˜å¥½ã€‚</p><p>çœ‹ä¸€ä¸‹å†…å­˜ç»“æ„å˜åŒ–çš„<code>Graphviz</code>å›¾ï¼Œå¯¹åº”ä»£ç ä¸­ä¸¤å¤„<code>g_memoryPool.dumpGraphviz()</code>çš„è°ƒç”¨ã€‚</p><table><thead><tr><th><img src="/images/1650222105.jpeg" alt="å†…å­˜æ ‡è®°ç®—æ³•å†…å­˜ç»“æ„å˜åŒ–01"></th><th><img src="/images/1650222106.jpeg" alt="å†…å­˜æ ‡è®°ç®—æ³•å†…å­˜ç»“æ„å˜åŒ–02"></th></tr></thead></table><p><strong>æ³¨æ„ï¼š</strong><code>å¯¹äºåé¢å°†è¦è¯´çš„ä¸¤ç§ç®—æ³•æ¥è¯´ï¼Œå½“å‰çš„å†…å­˜æ± æ¨¡å‹å±äºå†—ä½™è®¾è®¡ã€‚å®é™…è®¾è®¡æ—¶å› ä¸ºå­˜åœ¨æ•´ç†ç®—æ³•ï¼Œæ‰€ä»¥freeListã€usedListè¿™äº›éƒ½å¯ä»¥ä¸è¦ï¼Œç›´æ¥ä½¿ç”¨ä¸€ä¸ªæˆå‘˜æ ‡è®°æœ€åç”³è¯·çš„ä½ç½®å³å¯ã€‚åœ¨ä¸‹æ¬¡è¿›å…¥ç”³è¯·å†…å­˜æ—¶ä»…éœ€åˆ¤æ–­å½“å‰å—æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—²å†…å­˜ï¼Œå¦‚æœæ²¡æœ‰åˆ™åŠ¨æ€æ‰©å®¹ï¼Œå¦åˆ™å¯ç›´æ¥è¿”å›æœ€åç”³è¯·çš„ä½ç½®ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä»…ä¸ºO(1)</code></p><h3 id="å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•"><a href="#å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•"></a>å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•</h3><p>åœ¨å®ç°æ•´ç†ç®—æ³•ä¹‹å‰è¿˜éœ€è¦ä¸¤ä¸ªç‰¹åˆ«é‡è¦çš„æ–¹æ³•éœ€è¦å®ç°ï¼Œåˆ†åˆ«æ˜¯<code>suspendTheWorld</code>ä¸<code>resumeTheWorld</code>ã€‚</p><p>åœ¨æˆ‘ä»¬è¿›è¡Œå†…å­˜æ•´ç†ä¹‹å‰éœ€è¦å…ˆå¯¹å½“å‰è¿›ç¨‹çš„é™¤å½“å‰çº¿ç¨‹å¤–çš„æ‰€æœ‰çº¿ç¨‹è¿›è¡Œæš‚åœï¼Œå› ä¸ºåœ¨æˆ‘ä»¬è¿›è¡Œæ•´ç†çš„è¿‡ç¨‹ä¸­ä¸å…è®¸å‡ºç°è¢«æ•´ç†å†…å­˜è¢«å…¶ä»–çº¿ç¨‹è®¿é—®çš„æƒ…å†µï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å‡ºç°æ•°æ®é”™è¯¯ç”šè‡³å´©æºƒç­‰é—®é¢˜ã€‚</p><p>ä¸Šä»£ç </p><pre><code>std::vector&lt;HANDLE&gt; MemoryPool::suspendTheWorld()&#123;    std::vector&lt;HANDLE&gt; threadHandles;    auto currentProcessId = ::GetCurrentProcessId();    auto currentThreadId = ::GetCurrentThreadId();    auto snapshotHandle = ::CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, 0);    if (nullptr != snapshotHandle)    &#123;        THREADENTRY32 threadEntry&#123;&#125;;        threadEntry.dwSize = sizeof(threadEntry);        if (!::Thread32First(snapshotHandle, &amp;threadEntry))            return threadHandles;        do        &#123;            if (currentProcessId != threadEntry.th32OwnerProcessID || currentThreadId == threadEntry.th32ThreadID)                continue;            auto handle = ::OpenThread(THREAD_ALL_ACCESS, false, threadEntry.th32ThreadID);            if (nullptr == handle)                throw std::exception(&quot;OpenThread failed&quot;);            if (-1 == ::SuspendThread(handle))                throw std::exception(&quot;SuspendThread failed&quot;);            threadHandles.push_back(handle);        &#125; while (::Thread32Next(snapshotHandle, &amp;threadEntry));        ::CloseHandle(snapshotHandle);    &#125;    return threadHandles;&#125;void MemoryPool::resumeTheWorld(std::vector&lt;HANDLE&gt; &amp;handles)&#123;    for (auto &amp;handle : handles)    &#123;        if (-1 == ::ResumeThread(handle))            throw std::exception(&quot;ResumeThread failed&quot;);        ::CloseHandle(handle);    &#125;&#125;</code></pre><p>è¿™ä¸¤ä¸ªæ–¹æ³•å®ç°ä¹‹åå†æ¥å®ç°å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•</p><pre><code>void MemoryPool::markedTidyingGC()&#123;    std::set&lt;unit_t *&gt; aliveUnits;    std::vector&lt;unit_t *&gt; deadUnits;    auto threadHandles = suspendTheWorld(); // ç ¸ç“¦é²å¤š    auto block = m_blocks;    do    &#123;        aliveUnits.clear();        deadUnits.clear();        auto unit = block-&gt;usedList;        do        &#123;            if (0 != unit-&gt;refCount)                aliveUnits.insert(unit);            else                deadUnits.push_back(unit);            unit = unit-&gt;nextUnit;        &#125; while (unit != block-&gt;usedList);        // check if alive units is empty        if (aliveUnits.empty())        &#123;            // free all dead units            for (auto &amp;unit : deadUnits)            &#123;                m_refUnits[unit-&gt;refIndex] = nullptr;                freeUnit(unit);            &#125;        &#125;        else        &#123;            // update dead unit reference            for (const auto &amp;unit : deadUnits)                m_refUnits[unit-&gt;refIndex] = nullptr;            // move alive units to the front of the block            auto unitMoveToPosition = reinterpret_cast&lt;unit_t *&gt;(block-&gt;data);            size_t usedTotalSize = 0;            for (auto &amp;unit : aliveUnits)            &#123;                memcpy(unitMoveToPosition, unit, sizeof(unit_t) + unit-&gt;size);                unitMoveToPosition-&gt;data = reinterpret_cast&lt;uint8_t *&gt;(unitMoveToPosition) + sizeof(unit_t);                if (0 == usedTotalSize)                &#123;                    block-&gt;usedList = unitMoveToPosition;                    unitMoveToPosition-&gt;nextUnit = unitMoveToPosition;                    unitMoveToPosition-&gt;prevUnit = unitMoveToPosition;                &#125;                else                &#123;                    block-&gt;usedList-&gt;prevUnit-&gt;nextUnit = unitMoveToPosition;                    unitMoveToPosition-&gt;prevUnit = block-&gt;usedList-&gt;prevUnit;                    unitMoveToPosition-&gt;nextUnit = block-&gt;usedList;                    block-&gt;usedList-&gt;prevUnit = unitMoveToPosition;                &#125;                usedTotalSize += unitMoveToPosition-&gt;size + sizeof(unit_t);                unitMoveToPosition = reinterpret_cast&lt;unit_t *&gt;(unitMoveToPosition-&gt;data + unitMoveToPosition-&gt;size);            &#125;            // reset free unit list            block-&gt;freeTotal = block-&gt;size - usedTotalSize - sizeof(unit_t);            block-&gt;freeList = reinterpret_cast&lt;unit_t *&gt;(block-&gt;data + usedTotalSize);            block-&gt;freeList-&gt;data = reinterpret_cast&lt;uint8_t *&gt;(block-&gt;freeList) + sizeof(unit_t);            block-&gt;freeList-&gt;block = block;            block-&gt;freeList-&gt;size = block-&gt;freeTotal;            block-&gt;freeList-&gt;nextUnit = block-&gt;freeList;            block-&gt;freeList-&gt;prevUnit = block-&gt;freeList;            // update used unit reference            unit = block-&gt;usedList;            do            &#123;                m_refUnits[unit-&gt;refIndex] = unit;                unit = unit-&gt;nextUnit;            &#125; while (unit != block-&gt;usedList);        &#125;        block = block-&gt;nextBlock;    &#125; while (block != m_blocks);    resumeTheWorld(threadHandles); // ä½¿ç”¨ç›¸åŒç±»å‹çš„æ›¿èº«&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ•´ç†çš„è¿‡ç¨‹å°±æ˜¯å…ˆæš‚åœä¸–ç•Œï¼Œç„¶åè®°å½•åœ¨æ­¤æ¬¡GCä¸­ä»™å»ä¸å­˜æ´»çš„å†…å­˜å•å…ƒã€‚</p><p>å¦‚æœæ­¤æ¬¡GCæ²¡æœ‰å­˜æ´»çš„å†…å­˜å•å…ƒåˆ™ç›´æ¥ç›´æ¥è¿›è¡Œå†…å­˜å•å…ƒçš„é‡Šæ”¾ï¼Œå¦åˆ™å…ˆè¿›è¡Œä»™å»å†…å­˜å•å…ƒçš„æŒ‡é’ˆå¼•ç”¨æ›´æ–°ï¼Œä½¿å…¶å˜ä¸º<code>nullptr</code>ï¼Œæ¥ä¸‹æ¥å¯¹å­˜æ´»å†…å­˜å•å…ƒè¿›è¡Œæ•°æ®ç§»åŠ¨ï¼Œå°†æ•´ä¸ªå†…å­˜å•å…ƒç§»åŠ¨è‡³å‰ä¸€ä¸ªå†…å­˜å•å…ƒçš„åé¢ï¼Œä½¿å…¶ç´§å¯†è´´åˆï¼Œå¦‚æœæ˜¯ç¬¬ä¸€ä¸ªç§»åŠ¨çš„è¯åˆ™ç§»åŠ¨çš„ç›®æ ‡åœ°å€æ˜¯å½“å‰å†…å­˜å—çš„æ•°æ®åœ°å€ã€‚</p><p>ä½ é—®æˆ‘ä¼šä¸ä¼šåé¢çš„æ•°æ®æŠŠå‰é¢çš„å•å…ƒç»™è¦†ç›–äº†ï¼Ÿè‡ªç„¶æ˜¯ä¸ä¼šï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨<code>std::set</code>è€Œä¸æ˜¯<code>std::vectorã€std::unordered_set</code>ç­‰å®¹å™¨æ¥å­˜æ”¾å­˜æ´»å†…å­˜å•å…ƒåœ°å€çš„åŸå› ï¼Œå› ä¸º<code>std::set</code>ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬è¿›è¡Œæ’åºï¼Œè€Œåªè¦æˆ‘ä»¬ä¿è¯å­˜æ´»å†…å­˜å•å…ƒçš„ç§»åŠ¨æ˜¯é¡ºåºçš„ï¼Œå°±ä¸ä¼šå‘ç”Ÿæ•°æ®è¦†ç›–çš„æƒ…å†µã€‚<br><strong>å°æç¤ºï¼š</strong><code>std::setåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œå¦‚æœä¸éœ€è¦æ’åºçš„åŠŸèƒ½å¯ä½¿ç”¨std::unordered_setï¼Œstd::unordered_setçš„å®ç°åŸºäºå“ˆå¸Œè¡¨ï¼Œåœ¨æ€§èƒ½ä¸Šå¯ç›´æ¥åŠæ‰“</code></p><p>åœ¨ç§»åŠ¨å®Œæ‰€æœ‰å­˜æ´»çš„å†…å­˜å•å…ƒä¹‹åæˆ‘ä»¬éœ€è¦æ›´æ–°ç©ºé—²å†…å­˜ç©ºé—´çš„ä¿¡æ¯ï¼Œå› ä¸ºæˆ‘ä»¬å·²å°†ä½¿ç”¨çš„å†…å­˜å•å…ƒç§»åŠ¨åˆ°å†…å­˜å—é¦–éƒ¨ï¼Œæ‰€ä»¥å‰©ä¸‹çš„éƒ½æ˜¯å¯ä½¿ç”¨çš„ç©ºé—²å†…å­˜ï¼Œç›´æ¥åˆ†é…ä¸€ä¸ªå¤§å—ç©ºé—²å†…å­˜å•å…ƒå°±å¥½äº†ã€‚</p><p>æœ€åæˆ‘ä»¬éœ€è¦æ›´æ–°å·²ä½¿ç”¨çš„å†…å­˜å•å…ƒçš„æŒ‡é’ˆå¼•ç”¨ä¿¡æ¯å¹¶å–æ¶ˆæ•´ä¸ªä¸–ç•Œçš„æš‚åœå³å¯ã€‚</p><p>çœ‹æ•ˆæœ</p><p><img src="/images/1650222107.jpeg" alt="å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•ç»“æœ"></p><p>è¿è¡Œè¿‡ç¨‹å†…å­˜ç»“æ„å˜åŒ–çš„<code>Graphviz</code>å›¾</p><table><thead><tr><th><img src="/images/1650222108.jpeg" alt="å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•å†…å­˜ç»“æ„å˜åŒ–01"></th><th><img src="/images/1650222109.jpeg" alt="å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•å†…å­˜ç»“æ„å˜åŒ–02"></th></tr></thead></table><p>å¯ä»¥çœ‹åˆ°<code>data02</code>è¢«é‡Šæ”¾ååŸæœ¬ä½¿ç”¨çš„åœ°å€è¢«<code>data03</code>æ‹¿å»ç”¨äº†ï¼Œè¯´æ˜ç§»åŠ¨æ•´ç†æˆåŠŸã€‚</p><h3 id="å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•"><a href="#å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•"></a>å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•</h3><p><strong>æç¤ºï¼š</strong><code>å› å½“å‰å†…å­˜æ± ç»“æ„ä¸å¤ªå¥½å®ç°åˆ†ä»£ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä¼šå¦å¤–ç”³è¯·ä¸€å—å†…å­˜æ¥å½“ä½œè€å¹´ä»£</code></p><p>ä»£ç </p><pre><code>void MemoryPool::generationalMarkedTidyingGC()&#123;    static unit_t *elderUnitList = reinterpret_cast&lt;unit_t *&gt;(::VirtualAlloc(nullptr, 32 * 1024 * 1024, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE));    static size_t elderUnitListIndex = 0;    if (nullptr == elderUnitList)        throw std::exception(&quot;Emulate elder block failed&quot;);    std::set&lt;unit_t *&gt; elderUnits;    std::set&lt;unit_t *&gt; aliveUnits;    std::vector&lt;unit_t *&gt; deadUnits;    auto threadHandles = suspendTheWorld(); // ç ¸ç“¦é²å¤š    auto block = m_blocks;    do    &#123;        if (nullptr == block-&gt;usedList)        &#123;            block = block-&gt;nextBlock;            continue;        &#125;        elderUnits.clear();        aliveUnits.clear();        deadUnits.clear();        auto unit = block-&gt;usedList;        do        &#123;            if (0 != unit-&gt;refCount)            &#123;                if (4 &lt;= ++unit-&gt;aliveCount)                    elderUnits.insert(unit);                else                    aliveUnits.insert(unit);            &#125;            else                deadUnits.push_back(unit);            unit = unit-&gt;nextUnit;        &#125; while (unit != block-&gt;usedList);        // check if alive units and elder units is empty        if (aliveUnits.empty() &amp;&amp; elderUnits.empty())        &#123;            // free all dead units            for (auto &amp;unit : deadUnits)            &#123;                m_refUnits[unit-&gt;refIndex] = nullptr;                freeUnit(unit);            &#125;        &#125;        else        &#123;            // update dead unit reference            for (const auto &amp;unit : deadUnits)                m_refUnits[unit-&gt;refIndex] = nullptr;            // move elder units to the front of the elder block            for (auto &amp;unit : elderUnits)            &#123;                memcpy(elderUnitList + elderUnitListIndex, unit, sizeof(unit_t) + unit-&gt;size);                auto elderUnit = reinterpret_cast&lt;unit_t *&gt;(elderUnitList + elderUnitListIndex);                elderUnit-&gt;data = reinterpret_cast&lt;uint8_t *&gt;(elderUnit) + sizeof(unit_t);                elderUnit-&gt;block = nullptr;                if (0 == elderUnitListIndex)                &#123;                    elderUnit-&gt;nextUnit = elderUnit;                    elderUnit-&gt;prevUnit = elderUnit;                &#125;                else                &#123;                    elderUnitList-&gt;prevUnit-&gt;nextUnit = elderUnit;                    elderUnit-&gt;prevUnit = elderUnitList-&gt;prevUnit;                    elderUnit-&gt;nextUnit = elderUnitList;                    elderUnitList-&gt;prevUnit = elderUnit;                &#125;                // update elder unit reference                m_refUnits[elderUnit-&gt;refIndex] = elderUnit;                elderUnitListIndex += sizeof(unit_t) + elderUnit-&gt;size;            &#125;            // move alive units to the front of the block            auto unitMoveToPosition = reinterpret_cast&lt;unit_t *&gt;(block-&gt;data);            size_t usedTotalSize = 0;            if (0 == aliveUnits.size())                block-&gt;usedList = nullptr;            for (auto &amp;unit : aliveUnits)            &#123;                memcpy(unitMoveToPosition, unit, sizeof(unit_t) + unit-&gt;size);                unitMoveToPosition-&gt;data = reinterpret_cast&lt;uint8_t *&gt;(unitMoveToPosition) + sizeof(unit_t);                if (0 == usedTotalSize)                &#123;                    block-&gt;usedList = unitMoveToPosition;                    unitMoveToPosition-&gt;nextUnit = unitMoveToPosition;                    unitMoveToPosition-&gt;prevUnit = unitMoveToPosition;                &#125;                else                &#123;                    block-&gt;usedList-&gt;prevUnit-&gt;nextUnit = unitMoveToPosition;                    unitMoveToPosition-&gt;prevUnit = block-&gt;usedList-&gt;prevUnit;                    unitMoveToPosition-&gt;nextUnit = block-&gt;usedList;                    block-&gt;usedList-&gt;prevUnit = unitMoveToPosition;                &#125;                usedTotalSize += unitMoveToPosition-&gt;size + sizeof(unit_t);                unitMoveToPosition = reinterpret_cast&lt;unit_t *&gt;(unitMoveToPosition-&gt;data + unitMoveToPosition-&gt;size);            &#125;            // reset free unit list            block-&gt;freeTotal = block-&gt;size - usedTotalSize - sizeof(unit_t);            block-&gt;freeList = reinterpret_cast&lt;unit_t *&gt;(block-&gt;data + usedTotalSize);            block-&gt;freeList-&gt;data = reinterpret_cast&lt;uint8_t *&gt;(block-&gt;freeList) + sizeof(unit_t);            block-&gt;freeList-&gt;block = block;            block-&gt;freeList-&gt;size = block-&gt;freeTotal;            block-&gt;freeList-&gt;nextUnit = block-&gt;freeList;            block-&gt;freeList-&gt;prevUnit = block-&gt;freeList;            // update used unit reference            if (nullptr != block-&gt;usedList)            &#123;                unit = block-&gt;usedList;                do                &#123;                    m_refUnits[unit-&gt;refIndex] = unit;                    unit = unit-&gt;nextUnit;                &#125; while (unit != block-&gt;usedList);            &#125;        &#125;        block = block-&gt;nextBlock;    &#125; while (block != m_blocks);    resumeTheWorld(threadHandles); // ä½¿ç”¨ç›¸åŒç±»å‹çš„æ›¿èº«&#125;</code></pre><p>å…¶ä¸­<code>elderUnitList</code>å°±æ˜¯æˆ‘ä»¬ç”¨æ¥æ¨¡æ‹Ÿè€å¹´ä»£çš„å¦å¤–ç”³è¯·çš„å†…å­˜å—ã€‚</p><p>å¦å¤–åœ¨å†…å­˜æ ‡è®°æ•´ç†ç®—æ³•çš„åŸºç¡€ä¸ŠåŠ äº†ä¸ªåˆ¤æ–­ï¼Œå½“å†…å­˜å•å…ƒçš„GCå­˜æ´»æ¬¡æ•°<code>&gt;= 4</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒç§»åŠ¨åˆ°è€å¹´ä»£çš„å†…å­˜å—ä¸Šï¼Œå¹¶æ›´æ–°å†…å­˜å•å…ƒçš„æŒ‡é’ˆå¼•ç”¨ã€‚</p><p>å½“åœ¨æ‰€æœ‰çš„å·²ä½¿ç”¨å†…å­˜å•å…ƒéƒ½æˆä¸ºè€å¹´ä»£çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å½“å‰å†…å­˜å—çš„å·²ä½¿ç”¨å†…å­˜å•å…ƒé“¾è¡¨è®¾ç½®ä¸º<code>nullptr</code>ã€‚</p><p>è¿™é‡Œåˆ†ä»£çš„åŸºæœ¬æ€è·¯å°±æ˜¯å°†å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£ä¸è€å¹´ä»£ï¼Œå…¶ä¸­æ–°ç”Ÿä»£å°±æ˜¯æˆ‘ä»¬å½“å‰çš„å†…å­˜æ± ï¼Œè€å¹´ä»£å°±æ˜¯å¦å¤–ç”³è¯·çš„é‚£ä¸€å—å¤§å°<code>32MB</code>çš„å†…å­˜ã€‚å‘ç”ŸGCæ—¶æˆ‘ä»¬åªå¯¹æ–°ç”Ÿä»£åšæ“ä½œï¼Œè€Œè¿›å…¥è€å¹´ä»£çš„å†…å­˜å•å…ƒåŸºæœ¬ç§»åŠ¨åˆ°è€å¹´ä»£çš„å†…å­˜å—ä¸Šä¹‹åå°±æ”¾æ‰‹ä¸ç®¡äº†ï¼Œå¹¶ä¸”è®¾å®šè¿›å…¥è€å¹´ä»£çš„æ¡ä»¶æ˜¯å†…å­˜å•å…ƒèƒ½æ´»è¿‡<code>4</code>æ¬¡GCçš„è°ƒç”¨ï¼ˆGCçš„è°ƒç”¨åŸºæœ¬åªä¼šå‘ç”Ÿåœ¨å†…å­˜æ± æ— æ³•å†ç”³è¯·å†…å­˜çš„æƒ…å†µä¸‹ï¼Œé™¤éæ‰‹åŠ¨è°ƒç”¨ï¼‰ã€‚</p><p>å†™æ®µä»£ç æ¥çœ‹çœ‹æ•ˆæœ</p><p><img src="/images/1650222110.jpeg" alt="å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•ç»“æœ"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡GCä¹‹åè¿›è¡Œäº†ä¸€æ¬¡å†…å­˜æ•´ç†ï¼Œå¹¶å›æ”¶äº†å¼•ç”¨è®¡æ•°ä¸º<code>0</code>çš„<code>data02</code>ã€‚æ¥ä¸‹æ¥å†è¿›è¡Œ4æ¬¡GCï¼Œä½†çœŸæ­£æ‰§è¡Œçš„å…¶å®åªæœ‰3æ¬¡ï¼Œç¬¬4æ¬¡è¿›å»åå› ä¸ºåˆ¤æ–­åˆ°å†…å­˜å—çš„<code>usedList</code>ä¸º<code>nullptr</code>ï¼Œæ‰€ä»¥å°±ç›´æ¥è¿›è¡Œäº†è¿”å›ã€‚è¿™è¡¨æ˜å‰3æ¬¡å·²ç»å°†å­˜æ´»æ¬¡æ•°<code>&gt;= 4</code>çš„<code>test01</code>ä¸<code>test03</code>ä¸¤ä¸ªå¯¹åº”çš„å†…å­˜å•å…ƒç§»åŠ¨åˆ°äº†è€å¹´ä»£å†…å­˜å—ä¸Šäº†ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹å†…å­˜ç»“æ„å˜åŒ–çš„<code>Graphviz</code>å›¾</p><table><thead><tr><th><img src="/images/1650222111.jpeg" alt="å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•å†…å­˜ç»“æ„å˜åŒ–01"></th><th><img src="/images/1650222112.jpeg" alt="å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•å†…å­˜ç»“æ„å˜åŒ–02"></th><th><img src="/images/1650222113.jpeg" alt="å†…å­˜åˆ†ä»£æ ‡è®°æ•´ç†ç®—æ³•å†…å­˜ç»“æ„å˜åŒ–03"></th></tr></thead></table><p>å¯ä»¥çœ‹åˆ°è¿è¡Œåˆ°æœ€åå†…å­˜æ± å·²ä¸å­˜åœ¨ä½¿ç”¨ä¸­çš„å†…å­˜å•å…ƒï¼Œæ‰€æœ‰çš„å†…å­˜å‡å·²å½’è¿˜ï¼Œè€Œè¢«ä½¿ç”¨äº†çš„å†…å­˜å•å…ƒåˆ™è¢«è½¬ç§»åˆ°äº†è€å¹´ä»£å†…å­˜å—ä¹‹ä¸Šï¼Œé‚£ä¹ˆæ¥çœ‹ä¸€ä¸‹è€å¹´ä»£å†…å­˜å—çš„<code>Graphviz</code>å›¾</p><p><img src="/images/1650222114.jpeg" alt="è€å¹´ä»£å†…å­˜å—ç»“æ„"></p><p>è¿™ä¸¤ä¸ªå†…å­˜å•å…ƒå°±æ˜¯æˆ‘ä»¬çš„<code>test01</code>ä¸<code>test03</code>ï¼Œç§»åŠ¨æ­£ç¡®ã€‚</p><h2 id="GCå‰åçš„æ“ä½œ"><a href="#GCå‰åçš„æ“ä½œ" class="headerlink" title="GCå‰åçš„æ“ä½œ"></a>GCå‰åçš„æ“ä½œ</h2><p>åœ¨æ²¡æœ‰å¿…è¦çš„æ—¶å€™æˆ‘ä»¬è¦å°½é‡é¿å…GCçš„è°ƒç”¨ï¼Œå¯åœ¨ä»…å½“å†…å­˜æ± è¶…è¿‡é™å®šæœ€å¤§å¯å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜å¤§å°æ—¶æ‰å¯åŠ¨GCè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¹¶ä¸”é¿å…æ‰‹åŠ¨çš„å»è°ƒç”¨GCã€‚</p><p>åœ¨GCåè‹¥ä»æ— æ³•åˆ†é…å†…å­˜åˆ™æŠ›å‡ºå¼‚å¸¸<code>std::bad_alloc</code>ã€‚</p><p>ä»¥ä¸Šè¯´çš„ä¸¤ä¸ªæ“ä½œåªéœ€è¦åœ¨è¿è¡Œæ—¶åšä¸€äº›åˆ¤æ–­å³å¯ï¼Œåœ¨è¿™é‡Œå°±ä¸å®ç°äº†ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œæˆ‘ä»¬æ‰€è¦æ¢è®¨çš„å‡ ç§åƒåœ¾å›æ”¶æœºåˆ¶å°±æ•´å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å›åˆ°GCä¹‹å‰ã€‚</p><h2 id="C-ä½¿ç”¨ç‰¹åŒ–"><a href="#C-ä½¿ç”¨ç‰¹åŒ–" class="headerlink" title="C++ä½¿ç”¨ç‰¹åŒ–"></a>C++ä½¿ç”¨ç‰¹åŒ–</h2><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæ¥å®ç°ä¸¤ä¸ªç®€å•çš„åŒ…è£…å‡½æ•°ã€‚</p><pre><code>template &lt;typename class_t&gt;class_t &amp;object() requires std::is_pod_v&lt;class_t&gt;&#123;    return *reinterpret_cast&lt;class_t *&gt;(alloc(sizeof(class_t)));&#125;template &lt;typename class_t, typename... params_t&gt;class_t &amp;object(params_t &amp;&amp;...params)&#123;    class_t *placement = (class_t *)alloc(sizeof(class_t));    if (nullptr == placement)        throw std::bad_alloc();    new (placement) class_t(std::forward&lt;params_t&gt;(params)...);    return *placement;&#125;</code></pre><p>ç„¶åæµ‹è¯•ä¸€ä¸‹</p><table><thead><tr><th><img src="/images/1650222115.jpeg" alt="ç»“æ„"></th><th><img src="/images/1650222116.jpeg" alt="æµ‹è¯•"></th></tr></thead></table><p>ç„¶åæˆ‘è¿™é‡Œä¸éœ€è¦å®¹å™¨çš„æ”¯æŒï¼ˆä¸»è¦æ˜¯æ‡’å¾—å®ç°<code>std::allocator</code>ï¼‰ï¼Œç›´æ¥å¯¹å…¶ç¦ç”¨ã€‚</p><p>å…ˆåœ¨å¤–éƒ¨å£°æ˜ä¸€ä¸ª<code>concept</code></p><pre><code>template &lt;typename any_t&gt;concept is_container = requires(any_t any)&#123;    &#123;any.size()&#125;;    &#123;any.begin()&#125;;    &#123;any.end()&#125;;&#125;;</code></pre><p>ç„¶åå†å®ç°å‡½æ•°</p><pre><code>template &lt;typename class_t, typename... params_t&gt;class_t &amp;object(params_t &amp;&amp;...params) requires is_container&lt;class_t&gt;&#123;    static_assert(false, &quot;Unsupported type of container.&quot;);    return &#123;&#125;;&#125;</code></pre><p>æµ‹è¯•</p><p><img src="/images/1650222117.jpeg" alt="æµ‹è¯•"></p><p>å·®ä¸å¤šå°±è¿™æ ·äº†ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æƒ³èµ·è¿˜æœ‰ä¸€ä»¶äº‹æ²¡åšï¼Œå°±æ˜¯åœ¨<code>allocUnit</code>çš„æ—¶å€™éœ€è¦å¯¹é½<code>sizeof(void*)</code>ï¼Œä¸è¿‡åœ¨è¿™é‡Œå°±ä¸å†å®ç°äº†ï¼Œé¸­è›‹è«é¸­è›‹ã€‚</p><p>é‚£å°±è¿™æ ·äº†ï¼Œæœ‰ç¼˜å†è§~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨ç‰¹å®šæƒ…å†µä¸‹ä½¿ç”¨å†…å­˜æ± å¯æ˜¾è‘—æé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å·¥å…·&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[é€†å‘] è®°å½•å°é»‘ç›’ç­¾åç®—æ³•çš„é€†å‘è¿‡ç¨‹</title>
    <link href="http://example.com/2022/04/18/%E9%80%86%E5%90%91-%E8%AE%B0%E5%BD%95%E5%B0%8F%E9%BB%91%E7%9B%92%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E7%9A%84%E9%80%86%E5%90%91%E8%BF%87%E7%A8%8B/"/>
    <id>http://example.com/2022/04/18/%E9%80%86%E5%90%91-%E8%AE%B0%E5%BD%95%E5%B0%8F%E9%BB%91%E7%9B%92%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E7%9A%84%E9%80%86%E5%90%91%E8%BF%87%E7%A8%8B/</id>
    <published>2022-04-17T18:45:42.000Z</published>
    <updated>2022-07-02T08:14:57.136Z</updated>
    
    <content type="html"><![CDATA[<p>ç™½å«–çš„åŠ¨åŠ›æ˜¯æ— é™çš„ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ol><li><a href="https://www.telerik.com/fiddler" title="Fiddler Official">Fiddler</a></li><li><a href="https://github.com/skylot/jadx" title="JADX Official">JADX</a></li><li><a href="https://hex-rays.com/" title="IDA Official">IDA</a></li><li><a href="https://github.com/frida/frida" title="Frida Official">Frida</a></li></ol><h2 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h2><p><img src="/images/1650222076.jpg" alt="ç­¾åˆ°åŒ…å†…å®¹"></p><h2 id="é‡æ”¾æµ‹è¯•"><a href="#é‡æ”¾æµ‹è¯•" class="headerlink" title="é‡æ”¾æµ‹è¯•"></a>é‡æ”¾æµ‹è¯•</h2><p>ä½¿ç”¨<code>Shift + R</code>è¿›è¡Œä¸€ä¸ªåŒ…çš„é‡æ”¾ã€‚</p><p><img src="/images/1650222077.jpg" alt="é‡æ”¾æµ‹è¯•ç»“æœ"></p><p>å¥½å®¶ä¼™ï¼Œé‚£ä¹ˆæ”¹ä¸€ä¸‹<code>_time</code>å‚æ•°è¯•è¯•ã€‚</p><p><img src="/images/1650222078.jpg" alt="é‡æ”¾æµ‹è¯•ç»“æœ"></p><p>å—¯ï¼Œçœ‹æ¥æœ‰ç­¾åæ ¡éªŒï¼Œç»è¿‡æµ‹è¯•åç¡®å®šæ˜¯<code>hkey</code>è¿™ä¸ªå‚æ•°ã€‚</p><h2 id="JADX"><a href="#JADX" class="headerlink" title="JADX"></a>JADX</h2><p>æ‰“å¼€<code>jadx</code>å¹¶æŠŠä¸‹è½½å¥½çš„<code>.apk</code>æ–‡ä»¶æ‹–å…¥è½¯ä»¶ä¸­ï¼Œç­‰å¾…åˆ†æå®Œæˆã€‚åˆ†æå®Œæˆä¹‹åç›´æ¥æ‰“å¼€æœç´¢çª—å£ï¼Œè¾“å…¥å…³é”®å­—<code>hkey</code>è¿›è¡Œæœç´¢ã€‚</p><p><img src="/images/1650222079.jpg" alt="æœç´¢ç»“æœ"></p><p>å‘ç°æ²¡æœ‰å¯ç–‘çš„ç±»ï¼Œé‚£å°±ç”¨è¯·æ±‚è·¯å¾„æœç´¢è¯•è¯•ã€‚</p><p><img src="/images/1650222080.jpg" alt="æœç´¢ç»“æœ"></p><p>å—¯ï¼Œæ‰¾åˆ°ç›®æ ‡äº†ï¼Œä½†å‘ç°è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ²¡æœ‰ç›´æ¥è¿›è¡Œå®šä¹‰ã€‚é‚£ä¹ˆå°±æŒ‰ä¸‹<code>x</code>é”®è·Ÿè¸ªåˆ°å¼•ç”¨é‚£è¾¹ã€‚  </p><p><img src="/images/1650222081.jpg" alt="è·Ÿè¸ªç»“æœ"></p><p>åˆ°äº†è¿™é‡Œä¹‹ååŸºæœ¬å°±æ²¡äº‹ï¼Œç»§ç»­å¾€ä¸‹è·Ÿå°±è¡Œï¼Œè¿‡ç¨‹çœç•¥â€¦</p><p><img src="/images/1650222082.jpg" alt="æœ€ç»ˆç»“æœ"></p><p>æœ€ç»ˆåˆ°äº†è¿™ä¹ˆä¸€ä¸ªåœ°æ–¹ï¼Œå…¶ä¸­<code>NDKTools.encode</code>å°±æ˜¯ç”Ÿæˆ<code>hkey</code>çš„å‡½æ•°ã€‚ä½†æ˜¯åœ¨è¿™é‡Œå¹¶æ²¡æœ‰çœ‹åˆ°<code>hkey</code>è¿™ä¸ªå­—æ®µï¼Œç»è¿‡äº†ä¸€ç•ªæ£€æŸ¥ä¹‹åå‘ç°æ˜¯è¿™ä¹ˆç”Ÿæˆçš„ã€‚  </p><pre><code>name = &quot;hey&quot;.replace(&quot;e&quot;, &quot;ke&quot;)</code></pre><p>å¥½ï¼Œé‚£å°±æ²¡é—®é¢˜äº†ï¼Œå†æ¥çœ‹<code>NDKTools.encode</code>å‡½æ•°ï¼Œå‘ç°å…¶è¿›å…¥äº†<code>so</code>ä¸­ã€‚å¥½å®¶ä¼™ï¼Œé‚£è¿™å±‚å°±ç®—å®Œäº†ã€‚</p><h2 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h2><p>æ‰¾å‡½æ•°çš„é‚£äº›è¿‡ç¨‹å°±çœç•¥äº†ï¼Œè¿™é‡Œç›´æ¥ä¸Šä¼ªä»£ç åˆ†æç»“æœã€‚</p><pre><code>v11 = (unsigned __int8 *)((__int64 (__fastcall *)(JNIEnv *, __int64, _QWORD))(*v10)-&gt;GetStringUTFChars)(v10, v9, 0LL);// è¯·æ±‚çš„APIè·¯å¾„v12 = ((__int64 (__fastcall *)(JNIEnv *, __int64, _QWORD))(*v10)-&gt;GetStringUTFChars)(v10, v8, 0LL);// å½“å‰æ—¶é—´(1649327297)v13 = (unsigned __int8 *)((__int64 (__fastcall *)(JNIEnv *, __int64, _QWORD))(*v10)-&gt;GetStringUTFChars)(v10, v7, 0LL);// éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²([\da-zA-Z]&#123;32,32&#125;)result = 0LL;// åˆ¤æ–­3ä¸ªå‚æ•°æ˜¯å¦ä¸ºç©ºif ( v11 &amp;&amp; v12 &amp;&amp; v13 )&#123;    // å‚æ•°ä¸ä¸ºç©º    v93 = 22872;    v91 = xmmword_3E60;    v92 = 6293310241825115725LL;    v95 = 0;    v15 = strlen(v13);    if ( v15 &lt; 1 )                              // åˆ¤æ–­éšæœºå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦å°äº1    &#123;    v16 = 0;    &#125;    else    &#123;    // éšæœºå­—ç¬¦ä¸²å¤§äº1    v16 = 0;                                  // è®¡æ•°éšæœºå­—ç¬¦ä¸²ä¸­å‡ºç°0-9çš„æ¬¡æ•°    v17 = (unsigned int)v15;                  // éšæœºå­—ç¬¦ä¸²çš„é•¿åº¦    v18 = v94;    do    &#123;        v20 = *v13++;        v19 = v20;        v21 = v20 - 97;        v22 = v20 - 32;        if ( (unsigned int)(v20 - 48) &lt; 0xA )        ++v16;        if ( v21 &lt; 0x1A )        v19 = v22;        --v17;        *v18++ = v19;    &#125;    while ( v17 );    &#125;    v36 = atoi(v12);                            // å½“å‰æ—¶é—´(æ•´å‹)    dword_6110 = ((unsigned int)(v36 + v16) &gt;&gt; 16) &amp; 0xFF;    dword_6114 = (unsigned __int16)(v36 + v16) &gt;&gt; 8;    v90 = v36 + v16;    v86 = 0;                                    // å­˜å‚¨åŒ…å«å½“å‰æ—¶é—´çš„å‘é‡    v84 = 0u;    v85 = 0u;    v82 = 0u;    v83 = 0u;    v80 = 0u;    v81 = 0u;    v78 = 0u;    v79 = 0u;    v76 = 0u;    v77 = 0u;    v74 = 0u;    v75 = 0u;    v72 = 0u;    v73 = 0u;    dword_6118 = (unsigned int)(v36 + v16) &gt;&gt; 24;    dword_611C = (v36 + v16) &amp; 0xFF;    v87 = (unsigned int)(v36 + v16) &gt;&gt; 24;      // å¾€å‘é‡ä¸­å­˜å‚¨å½“å‰æ—¶é—´ä»¥ä¾›ç¨åsub_2BF0å‡½æ•°è¿›è¡Œè®¡ç®—ï¼Œæ—¶é—´æ˜¯è½¬æ¢æˆå¤§ç«¯å­˜å‚¨çš„æ—¶é—´    v88 = (unsigned int)(v36 + v16) &gt;&gt; 16;    v89 = (unsigned __int16)(v36 + v16) &gt;&gt; 8;    v70 = 0u;    v71 = 0u;    v37 = strlen(v11);    v38 = (unsigned __int8 *)malloc(2                                * (unsigned int)((unsigned __int64)(v37 + 2) * (unsigned __int128)0xAAAAAAAAAAAAAAABLL &gt;&gt; 64) &amp; 0xFFFFFFFC | 1LL);    v39 = strlen(v11);    sub_29F8(v11, v39, v38);                // å°†è¯·æ±‚çš„APIè·¯å¾„è¿›è¡ŒBase64ç¼–ç     v40 = strlen(v38);    sub_2BF0((unsigned __int8 *)&amp;v70, v38, (__int64)&amp;v86, v40, 8LL);// è®¡ç®—Base64ç¼–ç åçš„è¯·æ±‚çš„APIè·¯å¾„ä¸æ—¶é—´çš„å“ˆå¸Œå€¼ï¼Œ20å­—èŠ‚    v41 = *(_DWORD *)((unsigned __int64)&amp;v70 &amp; 0xFFFFFFFFFFFFFFF0LL | BYTE3(v71) &amp; 0xF);    dword_6124 = BYTE3(v71);    dword_6108 = BYTE3(v71) &amp; 0xF;    dword_610C = v41;    v42 = bswap32(v41);    v43 = v42 &amp; 0x7FFFFFFF;    dword_6104 = (v42 &amp; 0x7FFFFFFF) / 0x271F35A0;    v67 = 15540725856023089LL;    dword_6120 = v42;    v44 = 1307386003LL * ((v42 &gt;&gt; 2) &amp; 0x1FFFFFFF);    v45 = (v42 &amp; 0x7FFFFFFF) / 0x3AuLL;    v46 = *((_BYTE *)&amp;v91 + v43 - 58 * (_DWORD)v45);    v47 = *((unsigned __int8 *)&amp;v91 + (unsigned int)v45 - 58 * (2369637129u * v45 &gt;&gt; 37));    LODWORD(v44) = *((unsigned __int8 *)&amp;v91 + (v44 &gt;&gt; 40) - 58 * (unsigned int)(2369637129u * (v44 &gt;&gt; 40) &gt;&gt; 37));    v48 = *((unsigned __int8 *)&amp;v91 + v43 / 0x2FA28 - 58 * (2369637129u * (v43 / 0x2FA28uLL) &gt;&gt; 37));    v49 = *((unsigned __int8 *)&amp;v91 + v43 / 0xACAD10 - 58 * (2369637129u * (v43 / 0xACAD10uLL) &gt;&gt; 37));    v69 = 0;    LOBYTE(v67) = v46;                          // HKeyç¬¬ä¸€ä½å­—èŠ‚    BYTE1(v67) = v47;                           // HKeyç¬¬ä¸‰ä½å­—èŠ‚    BYTE2(v67) = v44;                           // HKeyç¬¬äºŒä½å­—èŠ‚    BYTE3(v67) = v48;                           // HKeyç¬¬äº”ä½å­—èŠ‚    BYTE4(v67) = v49;                           // HKeyç¬¬å››ä½å­—èŠ‚    v66.n128_u64[0] = __PAIR__(v44, v47);    v66.n128_u64[1] = __PAIR__(v49, v48);    v68 = 0;    sub_23FC((int *)&amp;v66);                      // è®¡ç®—æœ€åä¸¤ä½æ ¡éªŒç æ•°æ®    v50 = vaddvq_s32(v66);    v51 = v50        - 100        * (((unsigned __int64)(1374389535LL * v50) &gt;&gt; 63)        + ((signed int)((unsigned __int64)(1374389535LL * v50) &gt;&gt; 32) &gt;&gt; 5));    sub_25F4((__int64)&amp;v68, v52, v53, (unsigned int)v51, v54, v55, v56, v57, v66.n128_i64[0]);    v58 = v68;    if ( v51 &gt;= 10 )    v59 = v68;    else    v59 = 48;    if ( v51 &gt;= 10 )    v58 = HIBYTE(v68);    BYTE5(v67) = v59;                           // HKeyç¬¬å…­ä½å­—èŠ‚    BYTE6(v67) = v58;                           // HKeyç¬¬ä¸ƒä½å­—èŠ‚</code></pre><p>æˆ‘ä»¬éœ€è¦å…³æ³¨çš„å‡ ä¸ªé‡ç‚¹æ˜¯</p><ol><li><code>v11 v12 v13</code>è¿™ä¸‰ä¸ªå˜é‡åˆ†åˆ«ä»£è¡¨çš„æ˜¯ä»€ä¹ˆ</li><li><code>sub_29F8</code>è¿™ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆçš„</li><li><code>sub_2BF0</code>è¿™ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆçš„</li><li>å…¶ä¸­<code>sub_2BF0</code>å‡½æ•°ä¸­åˆåŒ…å«äº†ä¸€ä¸ª<code>sub_2D50</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°åˆæ˜¯åšä»€ä¹ˆçš„</li><li><code>sub_23FC</code>è¿™ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆçš„</li></ol><p>é€šè¿‡å¯¹ä¸Šä¸‹æ–‡è¿›è¡Œæ¯”å¯¹ï¼Œå¯ä»¥å‘ç°å…¶å®<code>v11 v12 v13</code>è¿™ä¸‰ä¸ªå˜é‡å…¶å®å°±æ˜¯åœ¨<code>Java</code>å±‚ä¼ è¿›æ¥çš„<code>JString</code>è½¬æ¢æˆ<code>CString</code>åçš„ç»“æœã€‚æ‰“ä¸Šæ³¨é‡Šã€‚</p><p>å†æ¥çœ‹<code>sub_29F8</code>è¿™ä¸ªå‡½æ•°ï¼Œè¿›å…¥ä¹‹åå‘ç°å…¶å¯¹ç€ä¸€ä¸ªå˜é‡ç–¯ç‹‚è¯»å–ã€‚</p><p><img src="/images/1650222085.jpg" alt="sub_29F8"></p><p>æœ‰å•¥è¿™ä¹ˆå¥½çœ‹çš„ï¼Ÿæ¥ï¼Œè®©æˆ‘åº·åº·ï¼</p><p><img src="/images/1650222086.jpg" alt="byte_41D4"></p><p>è¿‡æ¥ä¹‹åå¯ä»¥çœ‹åˆ°æ˜¯ä¸ªå­—èŠ‚æ•°ç»„ï¼Œé‚£å°±çœ‹çœ‹åå…­è¿›åˆ¶è§†å›¾ã€‚</p><p><img src="/images/1650222087.jpg" alt="byte_41D4"></p><p>å¥½ï¼Œ<code>base64Encode</code>æ²¡è·‘äº†ï¼Œæ‰“ä¸Šæ³¨é‡Šã€‚</p><p>æ¥ä¸‹æ¥æ˜¯<code>sub_2BF0</code>ï¼Œè¿›å…¥ä¹‹åçœ‹åˆ°åšäº†ä¸€äº›æ²¡çœ‹æ‡‚çš„æ“ä½œ</p><p><img src="/images/1650222088.jpg" alt="sub_2BF0"></p><p><a href="https://developer.arm.com/architectures/instruction-sets/intrinsics/#q=veorq_s8"><img src="/images/1650222089.jpg" alt="veorq_s8"></a></p><p>æŸ¥äº†ä¸€ä¸‹æŒ‡ä»¤çš„<a href="https://developer.arm.com/architectures/instruction-sets/intrinsics/#q=veorq_s8" title="ARM SIMDæŒ‡ä»¤é›†æ–‡æ¡£">æ–‡æ¡£</a>ï¼ŒåŸæ¥æ˜¯å¯¹ä¸€ä¸ªå‘é‡è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œé‚£å°±æ²¡äº‹äº†ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚<br>å†å¾€ä¸‹ä¹‹ååˆè¿›è¡Œäº†ä¸¤æ¬¡å‡½æ•°çš„è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯<code>sub_2D50</code>ã€‚æ²¡åŠæ³•ï¼Œç‚¹è¿›å»çœ‹çœ‹ã€‚<br>å¥½åƒæ²¡çœ‹åˆ°æœ‰ä»€ä¹ˆâ€¦<br>å¾€ä¸‹æ»‘åˆ°åº•çœ‹ä¸€ä¸‹ï¼Œè¿™æ—¶å¯ä»¥çœ‹åˆ°è¿”å›å€¼æ˜¯ä¸ª20å­—èŠ‚çš„æ•°ç»„</p><p><img src="/images/1650222090.jpg" alt="result"></p><p>è¯´åˆ°20å­—èŠ‚çš„è¿”å›å€¼èƒ½æœ‰ä»€ä¹ˆå‘¢ï¼Œç¬¬ä¸€ååº”å°±æ˜¯<code>sha1</code>å•Šã€‚ä¸è¿‡è¿™é‡Œå¥½åƒä¹Ÿæ²¡æœ‰çœ‹åˆ°æœ‰<code>initialize values</code>â€¦<br>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ç¿»çœ‹äº†ã€ŠåŠ å¯†ä¸è·³æ¥¼ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹ç¬¬6ç«  æ‰¾<code>sha1</code>çš„åˆå§‹å‚æ•°ã€‚</p><p><img src="/images/1650222091.jpg" alt="book"><br><img src="/images/1650222096.jpg" alt="book"></p><p>å—¯â€¦ç¡®å®æ²¡æœ‰ï¼Œç›´åˆ°æˆ‘æŠŠå®ƒçš„å‚æ•°æ”¾å…¥è®¡ç®—å™¨</p><p><img src="/images/1650222092.jpg" alt="calc"></p><p>å¥½å®¶ä¼™ï¼ŒåŸæ¥æ˜¯è¿™æ ·ï¼æ‰“ä¸Šæ³¨é‡Šã€‚</p><p>çªç„¶æƒ³å‘ä¸ªå›¾ï¼š<code>TNNDï¼Œç»™æˆ‘ç©é˜´æ»´æ˜¯å§.jpg</code></p><p>æ¥ä¸‹æ¥æ˜¯<code>sub_23FC</code>ï¼Œè¿›å…¥ä¹‹åå‘ç°å°±æ˜¯å¯¹æˆ‘ä»¬ä¼ è¿›å»çš„å‚æ•°è¿›è¡Œä¸€å †çš„è¿ç®—ï¼Œç„¶ååŸè·¯è¿”å›ï¼Œé‚£å°±æ²¡äº‹äº†ï¼Œæ‰“ä¸Šæ³¨é‡Šã€‚</p><h2 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h2><p>ç°åœ¨æ¥<code>Hook</code>ä¸€ä¸‹æˆ‘ä»¬ä¸Šé¢åˆ†æçš„å‡ ä¸ªå‡½æ•°</p><p><img src="/images/1650222093.jpg" alt="frida"></p><p><img src="/images/1650222094.jpg" alt="hookresult"></p><p><img src="/images/1650222095.jpg" alt="hookresult"></p><p>æ²¡å¾—æ¯›ç—…ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥</p><p><img src="/images/sticker_nice.jpg" alt="nice"></p><h2 id="è®¡ç®—è¿‡ç¨‹"><a href="#è®¡ç®—è¿‡ç¨‹" class="headerlink" title="è®¡ç®—è¿‡ç¨‹"></a>è®¡ç®—è¿‡ç¨‹</h2><p>æ€»ç»“ä¸€ä¸‹<code>hkey</code>çš„è®¡ç®—è¿‡ç¨‹å¤§æ¦‚å°±æ˜¯è¿™æ ·</p><pre><code>input requestPathinput timestampinput randomStringoutput encodedRequestPath = base64Encode(requestPath)process bias = getNumberCount(randomString)output encodedTimestamp = byteSwap(timestamp + bias)alloc timestampBuffer[72]alloc requestPathBuffer[84]process memcpy(timestampBuffer, encodedRequestPath, encodedRequestPath.length)process vectorXor(timestampBuffer, &quot;6666666666666666&quot;)process memcpy(timestampBuffer + 68, encodedTimestamp, 4)output timestampSha1Result = sha1(timestampBuffer, 72)process memcpy(requestPathBuffer, encodedRequestPath, encodedRequestPath.length)process vectorXor(requestPathBuffer, &quot;\\\\\\\\\\\\\\\\&quot;)process memcpy(requestPathBuffer + 64, timestampSha1Result, 20)output requestPathSha1Result = sha1(requestPathBuffer, 84)alloc characterMapping[58] = &quot;23456789BCDFGHJKMNPQRTVWXY&quot; + randomString.toUpperCase()alloc checkSumBuffer[16]alloc hkeyBuffer[7]output indexFactor = byteSwap(requestPathSha1Result[19] &amp; 0xF) &amp; 0x7FFFFFFFprocess hkeyBuffer[0] = characterMapping[indexFactor % 0x3A]process hkeyBuffer[1] = characterMapping[indexFactor / 0x3A % 0x3A]process hkeyBuffer[2] = characterMapping[indexFactor / 0xD24 % 0x3A]process hkeyBuffer[3] = characterMapping[indexFactor / 0x2FA28 % 0x3A]process hkeyBuffer[4] = characterMapping[indexFactor / 0xACAD10 % 0x3A]process memcpy(checkSumBuffer, hkeyBuffer + 1, 4)process checkSumBuffer = calcCheckSum(checkSumBuffer) // çº¯æ•°å€¼è®¡ç®—process checkSum = (vectorAdd(checkSumBuffer) % 100).toFixedWidthHexString(2)process hkeyBuffer[5] = checkSum[0]process hkeyBuffer[6] = checkSum[1]output hkey = hkeyBuffer</code></pre><p>å…¶ä¸­<code>calcCheckSum</code>å‡½æ•°å°±æ˜¯ä¼ªä»£ç ä¸­çš„<code>sub_23FC</code>å‡½æ•°ã€‚ç”±äºå‡½æ•°æ˜¯çº¯æ•°å€¼è®¡ç®—ï¼Œæ‰€ä»¥ç›´æ¥å¥—ç”¨å°±å¥½äº†ã€‚</p><h2 id="ä»£ç éªŒè¯"><a href="#ä»£ç éªŒè¯" class="headerlink" title="ä»£ç éªŒè¯"></a>ä»£ç éªŒè¯</h2><p>å†™ä¸€ä»½ä»£ç éªŒè¯ä¸€ä¸‹ã€‚</p><p><img src="/images/1650222083.jpg" alt="éªŒè¯ä»£ç "></p><p><img src="/images/1650222084.jpg" alt="éªŒè¯ç»“æœ"></p><p>å¯ä»¥çœ‹åˆ°ç»“æœç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å…¶å®è¿‡ç¨‹ä¸­åœ¨å¾ˆå¤šåœ°æ–¹è¸©äº†å‘ï¼Œè°ƒè¯•äº†å¥½å‡ æ¬¡æ‰æ‡‚äº†233ã€‚<br>é‚£å°±è¿™æ ·äº†ï¼Œæœ‰ç¼˜å†è§~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ç™½å«–çš„åŠ¨åŠ›æ˜¯æ— é™çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å·¥å…·&quot;&gt;&lt;a href=</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[å­¦ä¹ ] æ•´ç†å¹¶è®°å½•ä¸€ä¸‹Markdownçš„åŸºæœ¬è¯­æ³•</title>
    <link href="http://example.com/2022/04/17/%E5%AD%A6%E4%B9%A0-%E6%95%B4%E7%90%86%E5%B9%B6%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8BMarkdown%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"/>
    <id>http://example.com/2022/04/17/%E5%AD%A6%E4%B9%A0-%E6%95%B4%E7%90%86%E5%B9%B6%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8BMarkdown%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/</id>
    <published>2022-04-17T11:00:04.000Z</published>
    <updated>2022-07-02T08:14:38.011Z</updated>
    
    <content type="html"><![CDATA[<p>Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼ŒMarkdownæ–‡ä»¶çš„åç¼€åä¾¿æ˜¯â€œ.mdâ€ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ æ¢è®¨ä¹‹ç”¨ï¼Œå¦‚æœä¾µçŠ¯äº†æ‚¨çš„æƒç›Šè¯·è”ç³»æˆ‘åˆ é™¤ã€‚</p><h2 id="æ™®é€šæ–‡å­—"><a href="#æ™®é€šæ–‡å­—" class="headerlink" title="æ™®é€šæ–‡å­—"></a>æ™®é€šæ–‡å­—</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>æ— </code></p><p>æ™®é€šæ–‡å­—</p><hr><h2 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a>æ ‡é¢˜</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code># == --</code></p><!-- > # ä¸€çº§æ ‡é¢˜> ## äºŒçº§æ ‡é¢˜> ### ä¸‰çº§æ ‡é¢˜> #### å››çº§æ ‡é¢˜> ##### äº”çº§æ ‡é¢˜> ###### å…­çº§æ ‡é¢˜>> å¯é€‰è¯­æ³•ä¸€çº§æ ‡é¢˜> ==> å¯é€‰è¯­æ³•äºŒçº§æ ‡é¢˜> -- --><p><strong>æ•ˆæœ</strong></p><p><img src="/images/1650196000.jpg" alt="æ ‡é¢˜" title="æ ‡é¢˜"></p><p><strong>ä»£ç </strong></p><pre><code># ä¸€çº§æ ‡é¢˜## äºŒçº§æ ‡é¢˜### ä¸‰çº§æ ‡é¢˜#### å››çº§æ ‡é¢˜##### äº”çº§æ ‡é¢˜###### å…­çº§æ ‡é¢˜å¯é€‰è¯­æ³•ä¸€çº§æ ‡é¢˜==å¯é€‰è¯­æ³•äºŒçº§æ ‡é¢˜--</code></pre><hr><h2 id="æ®µè½"><a href="#æ®µè½" class="headerlink" title="æ®µè½"></a>æ®µè½</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>\n\n</code></p><p><strong>æ•ˆæœ</strong></p><p>æ®µè½æ–‡æœ¬ï¼Œæ¯æ®µä¹‹é—´ç”¨ç©ºè¡Œè¿›è¡Œåˆ†éš”ã€‚</p><p>I think maybe I should use it to format all of my documents.</p><p><strong>ä»£ç </strong></p><pre><code>æ®µè½æ–‡æœ¬ï¼Œæ¯æ®µä¹‹é—´ç”¨ç©ºè¡Œè¿›è¡Œåˆ†éš”ã€‚I think maybe I should use it to format all of my documents.</code></pre><hr><h2 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>ä¸¤ä¸ªç©ºæ ¼</code></p><p><strong>æ•ˆæœ</strong></p><p>ä½¿ç”¨ç©ºæ ¼è¿›è¡Œæ¢è¡Œ<br>è¿™æ˜¯ç¬¬äºŒè¡Œ</p><p>ä½¿ç”¨<code>&lt;br&gt;</code>è¿›è¡Œæ¢è¡Œ<br /><br>è¿™æ˜¯ç¬¬äºŒè¡Œ</p><p><strong>ä»£ç </strong></p><pre><code>ä½¿ç”¨ç©ºæ ¼è¿›è¡Œæ¢è¡Œ  è¿™æ˜¯ç¬¬äºŒè¡Œä½¿ç”¨`&lt;br&gt;`è¿›è¡Œæ¢è¡Œ&lt;br /&gt;è¿™æ˜¯ç¬¬äºŒè¡Œ</code></pre><hr><h2 id="å¼ºè°ƒä¸æ–œä½“"><a href="#å¼ºè°ƒä¸æ–œä½“" class="headerlink" title="å¼ºè°ƒä¸æ–œä½“"></a>å¼ºè°ƒä¸æ–œä½“</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>*</code></p><p><strong>æ•ˆæœ</strong></p><p><em>æ–œä½“</em><br><strong>å¼ºè°ƒ</strong><br><em><strong>å¼ºè°ƒä¸”æ–œä½“</strong></em></p><p><strong>ä»£ç </strong></p><pre><code>*æ–œä½“***å¼ºè°ƒ*****å¼ºè°ƒä¸”æ–œä½“***</code></pre><hr><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>&gt;</code></p><p><strong>æ•ˆæœ</strong></p><blockquote><p>æ™®é€šå¼•ç”¨</p><p><em>å¼•ç”¨ä¸­ä½¿ç”¨å…¶ä»–å…ƒç´ </em></p><blockquote><p>åµŒå¥—å¼•ç”¨</p><blockquote><p>åµŒå¥—å¼•ç”¨</p><blockquote><p>åµŒå¥—å¼•ç”¨</p></blockquote></blockquote></blockquote><p><strong>å¤šæ®µè½å¼•ç”¨</strong></p></blockquote><p><strong>ä»£ç </strong></p><pre><code>&gt; æ™®é€šå¼•ç”¨&gt;&gt; *å¼•ç”¨ä¸­ä½¿ç”¨å…¶ä»–å…ƒç´ *&gt;&gt;&gt; åµŒå¥—å¼•ç”¨&gt;&gt;&gt; åµŒå¥—å¼•ç”¨&gt;&gt;&gt;&gt; åµŒå¥—å¼•ç”¨&gt;&gt; **å¤šæ®µè½å¼•ç”¨**</code></pre><hr><h2 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>1-inf +</code></p><p><strong>æ•ˆæœ</strong></p><ol><li>æœ‰åºåˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ <ol><li>æœ‰åºåˆ—è¡¨åµŒå¥—</li></ol></li><li>æœ‰åºåˆ—è¡¨ç¬¬äºŒä¸ªå…ƒç´ <ul><li>æ— åºåˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ <ul><li>æ— åºåˆ—è¡¨åµŒå¥—</li></ul></li><li>æ— åºåˆ—è¡¨ç¬¬äºŒä¸ªå…ƒç´ </li></ul></li><li>æœ‰åºåˆ—è¡¨ç¬¬ä¸‰ä¸ªå…ƒç´ </li></ol><p><strong>ä»£ç </strong></p><pre><code>1. æœ‰åºåˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´     1. æœ‰åºåˆ—è¡¨åµŒå¥—2. æœ‰åºåˆ—è¡¨ç¬¬äºŒä¸ªå…ƒç´     + æ— åºåˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´         + æ— åºåˆ—è¡¨åµŒå¥—    + æ— åºåˆ—è¡¨ç¬¬äºŒä¸ªå…ƒç´ 3. æœ‰åºåˆ—è¡¨ç¬¬ä¸‰ä¸ªå…ƒç´ </code></pre><hr><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code> ` æ¯è¡Œç¼©è¿›å››ä¸ªç©ºæ ¼</code></p><p><strong>æ•ˆæœ</strong></p><p><code>ä½¿ç”¨ ` åˆ›å»ºçš„ä»£ç å—</code></p><pre><code>ä½¿ç”¨ç¼©è¿›å››ä¸ªç©ºæ ¼åˆ›å»ºçš„ä»£ç å—å¯ä»¥å¤šè¡Œä½¿ç”¨  </code></pre><p>å¯ä»¥åœ¨æ®µè½æ–‡æœ¬ä¸­ä½¿ç”¨<code>`</code>æ¥åˆ›å»ºå±€éƒ¨ä»£ç å—ï¼Œæ¯”<code>å¦‚è¿™</code>æ ·ã€‚</p><p><strong>ä»£ç </strong></p><pre><code>``ä½¿ç”¨ ` åˆ›å»ºçš„ä»£ç å—``    ä½¿ç”¨ç¼©è¿›å››ä¸ªç©ºæ ¼åˆ›å»ºçš„ä»£ç å—    å¯ä»¥å¤šè¡Œä½¿ç”¨  å¯ä»¥åœ¨æ®µè½æ–‡æœ¬ä¸­ä½¿ç”¨`` ` ``æ¥åˆ›å»ºå±€éƒ¨ä»£ç å—ï¼Œæ¯”`å¦‚è¿™`æ ·ã€‚</code></pre><hr><h2 id="åˆ†éš”çº¿"><a href="#åˆ†éš”çº¿" class="headerlink" title="åˆ†éš”çº¿"></a>åˆ†éš”çº¿</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>---</code></p><p><strong>æ•ˆæœ</strong></p><hr><p><strong>ä»£ç </strong></p><pre><code>---</code></pre><hr><h2 id="åˆ é™¤çº¿"><a href="#åˆ é™¤çº¿" class="headerlink" title="åˆ é™¤çº¿"></a>åˆ é™¤çº¿</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>~~å†…å®¹~~</code></p><p><strong>æ•ˆæœ</strong></p><p><del>æˆ‘å–œæ¬¢å­¦ä¹ </del></p><p><strong>ä»£ç </strong></p><pre><code>~~æˆ‘å–œæ¬¢å­¦ä¹ ~~</code></pre><hr><h2 id="å¾…åŠäº‹é¡¹"><a href="#å¾…åŠäº‹é¡¹" class="headerlink" title="å¾…åŠäº‹é¡¹"></a>å¾…åŠäº‹é¡¹</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>- []</code></p><p><strong>æ•ˆæœ</strong></p><ul><li><input checked="" disabled="" type="checkbox"> å¾…åŠäº‹é¡¹1</li><li><input disabled="" type="checkbox"> å¾…åŠäº‹é¡¹2</li></ul><p><strong>ä»£ç </strong></p><pre><code>- [x] å¾…åŠäº‹é¡¹1- [ ] å¾…åŠäº‹é¡¹2</code></pre><hr><h2 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>[è¶…é“¾æ¥æ˜¾ç¤ºå](è¶…é“¾æ¥åœ°å€ &quot;è¶…é“¾æ¥title&quot;)</code></p><p><strong>æ•ˆæœ</strong></p><p>è¿™æ˜¯ä¸€ä¸ªé“¾æ¥ <a href="https://markdown.com.cn/" title="æœ€å¥½çš„markdownæ•™ç¨‹">Markdownè¯­æ³•</a>ã€‚</p><p>å¯ä»¥ä½¿ç”¨<code>&lt;&gt;</code>æ‹¬èµ·æ¥é“¾æ¥æˆ–é‚®ç®±åœ°å€ï¼š<a href="mailto:&#x72;&#111;&#115;&#x65;&#98;&#x7a;&#105;&#64;&#102;&#111;&#120;&#109;&#97;&#105;&#x6c;&#46;&#x63;&#x6f;&#x6d;">&#x72;&#111;&#115;&#x65;&#98;&#x7a;&#105;&#64;&#102;&#111;&#120;&#109;&#97;&#105;&#x6c;&#46;&#x63;&#x6f;&#x6d;</a></p><p><a href="https://bzi-han.github.io/" title="Bzi-Han&#39;s blog">å ä½é“¾æ¥</a></p><p>å¼•ç”¨å¯¼èˆª1<a href="%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E5%86%99%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E4%BB%BB%E4%BD%95%E5%9C%B0%E6%96%B9">^1</a><br>å¼•ç”¨å¯¼èˆª2<a href="https://bzi-han.github.io/">^2</a></p><p><strong>ä»£ç </strong></p><pre><code>è¿™æ˜¯ä¸€ä¸ªé“¾æ¥ [Markdownè¯­æ³•](https://markdown.com.cn &quot;æœ€å¥½çš„markdownæ•™ç¨‹&quot;)ã€‚å¯ä»¥ä½¿ç”¨`&lt;&gt;`æ‹¬èµ·æ¥é“¾æ¥æˆ–é‚®ç®±åœ°å€ï¼š&lt;rosebzi@foxmail.com&gt;[å ä½é“¾æ¥][reservelink][reservelink]: https://bzi-han.github.io/ &quot;Bzi-Han&#39;s blog&quot;å¼•ç”¨å¯¼èˆª1[^1]å¼•ç”¨å¯¼èˆª2[^2][^1]: è¿™é‡Œå¯ä»¥å†™åœ¨é¡µé¢ä¸­çš„ä»»ä½•åœ°æ–¹[^2]: https://bzi-han.github.io/</code></pre><hr><h2 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>![å›¾ç‰‡alt](å›¾ç‰‡é“¾æ¥ &quot;å›¾ç‰‡title&quot;)</code></p><p><strong>æ•ˆæœ</strong></p><p>åªæ˜¾ç¤ºå›¾ç‰‡</p><p><img src="https://s1.ax1x.com/2020/08/27/dfT9Dx.gif" alt="æ’ç”»" title="image"></p><p>é“¾æ¥ä¸å›¾ç‰‡å¹¶ç”¨ï¼Œç‚¹å‡»å›¾ç‰‡å¯è·³è½¬</p><p><a href="https://baike.baidu.com/item/ASCII/309296"><img src="https://s1.ax1x.com/2022/04/17/LU1KxI.md.png" alt="ASCII" title="ascii"></a></p><p><strong>ä»£ç </strong></p><pre><code>åªæ˜¾ç¤ºå›¾ç‰‡![æ’ç”»](https://s1.ax1x.com/2020/08/27/dfT9Dx.gif &quot;image&quot;)é“¾æ¥ä¸å›¾ç‰‡å¹¶ç”¨ï¼Œç‚¹å‡»å›¾ç‰‡å¯è·³è½¬[![ASCII](https://s1.ax1x.com/2022/04/17/LU1KxI.md.png &quot;ascii&quot;)](https://baike.baidu.com/item/ASCII/309296)</code></pre><hr><h2 id="è½¬ä¹‰"><a href="#è½¬ä¹‰" class="headerlink" title="è½¬ä¹‰"></a>è½¬ä¹‰</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>\ &amp;xxx;</code></p><p><strong>æ•ˆæœ</strong></p><p>&amp;nbsp;æ™®é€šç©ºæ ¼ <code>&amp;nbsp;</code><br>&amp;ensp;åŠè§’ç©ºæ ¼ <code>&amp;ensp;</code><br>&amp;emsp;å…¨è§’ç©ºæ ¼ <code>&amp;emsp;</code></p><p>* è¿™é‡Œä½¿ç”¨<code>\</code>è½¬ä¹‰äº†<code>*</code>ç¬¦å·</p><p><strong>ä»£ç </strong></p><pre><code>&amp;nbsp;æ™®é€šç©ºæ ¼ `&amp;nbsp;`  &amp;ensp;åŠè§’ç©ºæ ¼ `&amp;ensp;`  &amp;emsp;å…¨è§’ç©ºæ ¼ `&amp;emsp;`\* è¿™é‡Œä½¿ç”¨`\`è½¬ä¹‰äº†`*`ç¬¦å·</code></pre><hr><h2 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h2><p><strong>è¯­æ³•ç¬¦å·</strong>ï¼š<code>| : -</code></p><p><strong>æ•ˆæœ</strong></p><table><thead><tr><th align="center">ç¬¬ä¸€åˆ—</th><th align="left">ç¬¬äºŒåˆ—</th><th align="right">ç¬¬ä¸‰åˆ—</th></tr></thead><tbody><tr><td align="center">center aligment</td><td align="left">left aligment</td><td align="right">right aligment</td></tr><tr><td align="center">data1</td><td align="left">data2</td><td align="right">data3</td></tr><tr><td align="center">data1</td><td align="left">data2</td><td align="right">data3</td></tr><tr><td align="center">data1</td><td align="left">data2</td><td align="right">data3</td></tr><tr><td align="center">data1</td><td align="left">data2</td><td align="right">data3</td></tr><tr><td align="center">data1</td><td align="left">data2</td><td align="right">data3</td></tr></tbody></table><p><strong>ä»£ç </strong></p><pre><code>| ç¬¬ä¸€åˆ— | ç¬¬äºŒåˆ— | ç¬¬ä¸‰åˆ— || :-: | :- | -: || center aligment | left aligment | right aligment || data1 | data2 | data3 || data1 | data2 | data3 || data1 | data2 | data3 || data1 | data2 | data3 || data1 | data2 | data3 |</code></pre><hr><h2 id="å†…åµŒHTML"><a href="#å†…åµŒHTML" class="headerlink" title="å†…åµŒHTML"></a>å†…åµŒHTML</h2><p><strong>æ•ˆæœ</strong></p><p><i>label i</i><br><a src="https://bzi-han.github.io/" style="color:#dd001b;cursor:pointer;">è¶…é“¾æ¥</a></p><p><strong>ä»£ç </strong></p><pre><code>&lt;i&gt;label i&lt;/i&gt;  &lt;a src=&quot;https://bzi-han.github.io/&quot; style=&quot;color:#dd001b;cursor:pointer;&quot;&gt;è¶…é“¾æ¥&lt;/a&gt;</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼ŒMarkdownæ–‡ä»¶çš„åç¼€åä¾¿æ˜¯â€œ.mdâ€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2022/03/30/hello-world/"/>
    <id>http://example.com/2022/03/30/hello-world/</id>
    <published>2022-03-30T02:06:52.211Z</published>
    <updated>2022-03-30T02:06:52.212Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
