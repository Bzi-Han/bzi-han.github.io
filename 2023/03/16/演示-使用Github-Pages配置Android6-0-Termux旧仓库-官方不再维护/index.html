<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>[演示] 使用Github Pages配置Android6.0 Termux旧仓库(官方不再维护)</title><meta name="description" content="Bzi-Han's blog, Bzi-Han的博客"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="纯纯的白嫖！
前言本文仅供学习探讨之用，如果侵犯了您的权益请联系我删除。
资源
Github Pages
Termux app and packages for legacy Android OS
Apktool

介绍Github Pages的基本使用就不介绍了，如果还不知道的话建议先阅读一下官方文档。
这里只说几个需要的关注点

创建站点前得先创建一个站点仓库，即以xxx.github.io为名字的仓库，具体可看这里。
每个站点的仓库大小限制为1GB(官方推荐)，但是实测最大限制为1.49GB，不超过这个限制没啥问题，超过的话会上传失败。
如果你其他的仓库启用了Github Pages，则它对应的访问路径为xxx.github.io/仓库名，区分大小写。

搭建假设你已经有了站点仓库(以xxx.gith.."><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Bzi-Han的博客" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Bzi-Han's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">[演示] 使用Github Pages配置Android6.0 Termux旧仓库(官方不再维护)</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90"><span class="toc-text">资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA"><span class="toc-text">搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9App%E5%88%B6%E4%BD%9C%E7%9B%B4%E6%8E%A5%E5%AE%89%E8%A3%85%E7%89%88"><span class="toc-text">修改App制作直接安装版</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">搭建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-text">修改虚拟环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91Bootstrap"><span class="toc-text">编译Bootstrap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E4%B8%8E%E9%87%8D%E6%89%93%E5%8C%85Apk%E5%B9%B6%E8%BF%9B%E8%A1%8C%E9%87%8D%E6%96%B0%E7%AD%BE%E5%90%8D"><span class="toc-text">替换与重打包Apk并进行重新签名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%93%E5%BA%93"><span class="toc-text">仓库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-text">结语</span></a></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">[演示] 使用Github Pages配置Android6.0 Termux旧仓库(官方不再维护)</h1><time class="has-text-grey" datetime="2023-03-16T09:43:02.000Z">2023-03-16</time><article class="mt-2 post-content"><p>纯纯的白嫖！</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文仅供学习探讨之用，如果侵犯了您的权益请联系我删除。</p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.github.com/en/pages" title="Github Pages">Github Pages</a></li>
<li><a target="_blank" rel="noopener" href="https://archive.org/details/termux-repositories-legacy" title="Termux app and packages for legacy Android OS">Termux app and packages for legacy Android OS</a></li>
<li><a target="_blank" rel="noopener" href="https://ibotpeaches.github.io/Apktool/">Apktool</a></li>
</ol>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Github Pages的基本使用就不介绍了，如果还不知道的话建议先阅读一下<a target="_blank" rel="noopener" href="https://docs.github.com/en/pages/quickstart">官方文档</a>。</p>
<p>这里只说几个需要的关注点</p>
<ol>
<li>创建站点前得先创建一个站点仓库，即以<code>xxx.github.io</code>为名字的仓库，具体可看<a target="_blank" rel="noopener" href="https://docs.github.com/zh/pages/getting-started-with-github-pages/creating-a-github-pages-site#creating-a-repository-for-your-site">这里</a>。</li>
<li>每个站点的仓库大小限制为<code>1GB</code>(官方推荐)，但是实测最大限制为<code>1.49GB</code>，不超过这个限制没啥问题，超过的话会上传失败。</li>
<li>如果你其他的仓库启用了Github Pages，则它对应的访问路径为<code>xxx.github.io/仓库名</code>，区分大小写。</li>
</ol>
<h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2><p>假设你已经有了站点仓库(以<code>xxx.github.io</code>为名的仓库，没有的话请看介绍里的内容如何创建)，在Github中新建一个用于此项目的空仓库，我这里起名为TermuxLegacy。</p>
<p>然后在本地新建一个项目文件夹，使用<code>git init</code>命令初始化空仓库。</p>
<p>使用<code>git remote add origin 仓库地址</code>添加TermuxLegacy仓库的地址，例如我这里是<code>https://github.com/Bzi-Han/TermuxLegacy.git</code>。</p>
<p>从<a target="_blank" rel="noopener" href="https://archive.org/details/termux-repositories-legacy">官方历史仓库</a>中下载<code>termux-repositories-legacy-24.12.2019.tar</code>文件，把它解压到项目目录下。</p>
<p>添加.gitignore文件，用于屏蔽过大的文件，防止仓库总大小超过了Github仓库的限制。</p>
<p>然后编写一个py脚本来扫描目录下的大文件，获取文件名单，毕竟手动添加那也太噩梦了。</p>
<pre><code>import os

maxFileSize = 3 * 1024 * 1024 # 3MB
filterFileNames = set()
remainingFileSize = 0

for root, dirs, files in os.walk(&#39;termux-repositories-legacy/webroot/termux-packages/dists/stable/main&#39;):
    for filename in files:
        size = os.path.getsize(os.path.join(root, filename))
        if maxFileSize &lt;= size:
            filterFileNames.add(filename)
        else:
            remainingFileSize += size

for filename in filterFileNames:
    print(filename)

print(remainingFileSize, &quot;&#123;:.2f&#125;MB&quot;.format(remainingFileSize / 1024. / 1024.), &quot;&#123;:.2f&#125;GB&quot;.format(remainingFileSize / 1024. / 1024. / 1024.))
</code></pre>
<p><code>maxFileSize</code>就是限制的单个文件最大大小。</p>
<p>运行一下</p>
<pre><code>...
syncthing_1.3.0-1_x86_64.deb
nodejs-lts_12.13.0-2_i686.deb
git_2.23.0-1_i686.deb
quickjs-static_2019.10.27-1_aarch64.deb
1146961401 1093.83MB 1.07GB
</code></pre>
<p>可以看到排除掉大于3MB的文件之后只剩下1.07GB的文件了，符合我们的基本要求。</p>
<p>把扫描到的文件名直接复制粘贴到.gitignore中，然后再添加<code>unstable-packages-21</code>和<code>x11-packages-21</code>这两个目录的屏蔽，只留下game、science、root和主仓库这4个仓库。</p>
<p>.gitignore文件</p>
<pre><code># repository
unstable-packages-21
x11-packages-21

# package
...
</code></pre>
<p>接下来只需要将仓库提交并上传即可</p>
<ol>
<li>执行<code>git add .</code>将目录下所有的变动添加到本地仓库缓存中。</li>
<li>执行<code>git commit -m &quot;First commit&quot;</code>将缓存中的所有变动提交到本地仓库中。</li>
<li>执行<code>git push origin master</code>将本地仓库推送到Github仓库里。</li>
</ol>
<p>推送完成之后在仓库的<code>Settings</code>-&gt;<code>Pages</code>中把<code>Branch</code>的分支设置成你仓库的主分支，路径设置为<code>/</code>，然后保存即可开启Github Pages。</p>
<p>如下图所示</p>
<p><img src="/images/1650222149.jpg" alt="Github Pages开启"></p>
<p>开启之后需要等待Github Pages的编译部署，等待提交记录上的棕色圈圈变成绿色勾勾就行了</p>
<p><img src="/images/1650222150.jpg" alt="Github Pages编译"></p>
<p>可以尝试访问一下，我这里的地址是<a target="_blank" rel="noopener" href="https://bzi-han.github.io/TermuxLegacy">https://bzi-han.github.io/TermuxLegacy</a>，如果能看到README.md里的内容说明部署成功。</p>
<p>然后就是按照<code>sources.list</code>的格式进行配置访问路径即可，例如主仓库就是<code>deb https://bzi-han.github.io/TermuxLegacy/termux-repositories-legacy/webroot/termux-packages stable main</code>。</p>
<p>如果你不了解的话，这是<code>sources.list</code>的格式<a target="_blank" rel="noopener" href="https://www.debian.org/doc/manuals/debian-handbook/apt.zh-cn.html#sect.apt-sources.list">文档</a>。</p>
<p>简单来说就是<code>deb [选项] 软件包源地址 发布版名称 其他描述信息</code>或者<code>deb-src [选项] 软件包源地址 发布版名称 其他描述信息</code>，对应二进制包和源代码包。</p>
<p>为了部分情况更方便的使用，我们还可以编写一个一键使用本仓库的bash脚本，上代码</p>
<pre><code>#!/bin/bash
baseUrl=&quot;https://bzi-han.github.io/TermuxLegacy&quot;

mainRepository=&quot;deb $baseUrl/termux-repositories-legacy/webroot/termux-packages stable main&quot;
gameRepository=&quot;deb $baseUrl/termux-repositories-legacy/webroot/game-packages-21 games stable&quot;
scienceRepository=&quot;deb $baseUrl/termux-repositories-legacy/webroot/science-packages-21 science stable&quot;

rootRepository=&quot;deb $baseUrl/termux-repositories-legacy/webroot/termux-root-packages-21 root stable&quot;

# x11Repository=&quot;&quot;
# unstableRepository=&quot;&quot;

echo &quot;[=] Checking permission...&quot;
if [ -z $&#123;EUID+x&#125; ]; then
    EUID=$(id -u)
fi
if [ ! -z $&#123;PREFIX+x&#125; ]; then
    if [[ $EUID -eq 0 ]]; then
        echo &quot;[-] Do not run this script as the root user.&quot;
        exit
    fi
fi
echo &quot;[=] User&quot; $(whoami)

echo &quot;[=] Checking environment...&quot;
if [ -z $&#123;PREFIX+x&#125; ]; then
    PREFIX=&quot;/data/data/com.termux/files/usr&quot;
fi

echo &quot;[*] Installing repositories...&quot;
# main repository
if [ -f &quot;$PREFIX/etc/apt/sources.list&quot; ]; then
    mv $PREFIX/etc/apt/sources.list $PREFIX/etc/apt/sources.list.bak
fi
echo $mainRepository &gt; $PREFIX/etc/apt/sources.list.d/termux-legacy-main.list

# game repository
if [ -f &quot;$PREFIX/etc/apt/sources.list.d/game.list&quot; ]; then
    mv $PREFIX/etc/apt/sources.list.d/game.list $PREFIX/etc/apt/sources.list.d/game.list.bak
fi
echo $gameRepository &gt; $PREFIX/etc/apt/sources.list.d/termux-legacy-game.list

# science repository
if [ -f &quot;$PREFIX/etc/apt/sources.list.d/science.list&quot; ]; then
    mv $PREFIX/etc/apt/sources.list.d/science.list $PREFIX/etc/apt/sources.list.d/science.list.bak
fi
echo $scienceRepository &gt; $PREFIX/etc/apt/sources.list.d/termux-legacy-science.list

# root repository
if [ -f &quot;$PREFIX/etc/apt/sources.list.d/root.list&quot; ]; then
    mv $PREFIX/etc/apt/sources.list.d/root.list $PREFIX/etc/apt/sources.list.d/root.list.bak
fi
echo $rootRepository &gt; $PREFIX/etc/apt/sources.list.d/termux-legacy-root.list

if [[ $EUID -eq 0 ]]; then
    echo &quot;[*] Changing files ownership...&quot;
    chown 10143:10143 $PREFIX/etc/apt/sources.list.d/termux-legacy-main.list
    chown 10143:10143 $PREFIX/etc/apt/sources.list.d/termux-legacy-game.list
    chown 10143:10143 $PREFIX/etc/apt/sources.list.d/termux-legacy-science.list
    chown 10143:10143 $PREFIX/etc/apt/sources.list.d/termux-legacy-root.list
    echo &quot;[+] Change succeeded.&quot;
fi
echo &quot;[+] Install successfully.&quot;
</code></pre>
<p>到这里，Termux仓库就已经算是搭建好了。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>如何使用可以看<a target="_blank" rel="noopener" href="https://github.com/Bzi-Han/TermuxLegacy#%E4%BD%BF%E7%94%A8">这里</a>。</p>
<p>直接来看效果</p>
<table>
<thead>
<tr>
<th><img src="/images/1650222151.png" alt="测试结果01"></th>
<th><img src="/images/1650222152.png" alt="测试结果02"></th>
<th><img src="/images/1650222153.png" alt="测试结果03"></th>
</tr>
</thead>
</table>
<p>可以看到结果符合我们的预期。</p>
<h2 id="修改App制作直接安装版"><a href="#修改App制作直接安装版" class="headerlink" title="修改App制作直接安装版"></a>修改App制作直接安装版</h2><p>为了使得使用上更方便，我们直接修改App的默认配置，使其安装完后便直接可以使用Github Pages搭建的仓库。</p>
<p>虽然原本就是开源项目，但我不想直接编译整个App，太慢也比较烦。</p>
<p>Termux是将默认的虚拟环境打包在<code>libtermux-bootstrap.so</code>中的。</p>
<p>在首次运行App的时候会调用JNI函数<code>Java_com_termux_app_TermuxInstaller_getZip</code>来获取虚拟环境压缩包，并解压到<code>/data/data/com.termux/files/usr</code>进行配置。</p>
<p>于是这里我们可以直接修改虚拟环境压缩包中的环境配置，然后重新编译每一份适配各种平台的<code>libtermux-bootstrap.so</code>用来替换Apk中的库，并对Apk进行重新签名来实现。</p>
<h3 id="搭建项目"><a href="#搭建项目" class="headerlink" title="搭建项目"></a>搭建项目</h3><p>我们先从原本的项目中拿出<code>termux-bootstrap-zip.S</code>与<code>termux-bootstrap.c</code>两个源文件，新建一个<code>C++</code>项目并把这两个源文件搞里头。</p>
<p><img src="/images/1650222144.jpg" alt="项目结构01"></p>
<p>我这里用的是<code>CMake</code>+<code>NDK</code>来进行编译，你也可以直接使用<code>NDK-Build</code>，只是个人更喜欢<code>CMake</code>罢了。</p>
<p>编写<code>CMakeLists.txt</code>文件</p>
<pre><code>cmake_minimum_required(VERSION 3.0.0)

enable_language(ASM)

project(termux-bootstrap)

set(CMAKE_CXX_STANDARD 20)

add_library($&#123;PROJECT_NAME&#125; SHARED $&#123;CMAKE_SOURCE_DIR&#125;/src/termux-bootstrap.c $&#123;CMAKE_SOURCE_DIR&#125;/src/termux-bootstrap-zip.S)
set_target_properties($&#123;PROJECT_NAME&#125; PROPERTIES 
    LIBRARY_OUTPUT_DIRECTORY &quot;$&#123;CMAKE_SOURCE_DIR&#125;/lib/$&#123;ANDROID_ABI&#125;&quot;
)
</code></pre>
<p>编写<code>build.bat</code>批量编译<code>arm64-v8a</code> <code>armeabi-v7a</code> <code>x86</code> <code>x86_64</code>这4个平台的脚本文件</p>
<pre><code>@echo off

SETLOCAL ENABLEDELAYEDEXPANSION

SET &quot;ARGV01=%~1&quot;
SET &quot;ARGV02=%~2&quot;
SET &quot;ARGV03=%~3&quot;

@REM Initialize CMAKE_TOOLCHAIN_FILE
IF NOT DEFINED NDK_PATH (
    SET NDK_PATH=%ARGV01%
) ELSE IF DEFINED ARGV01 (
    SET NDK_PATH=%ARGV01%
)
IF NOT DEFINED NDK_PATH (
    SET NDK_PATH=E:/Android/Ndk/android-ndk-r25b
)
SET CMAKE_TOOLCHAIN_FILE=%NDK_PATH%/build/cmake/android.toolchain.cmake
IF NOT EXIST %CMAKE_TOOLCHAIN_FILE% (
    ECHO [-] CMAKE_TOOLCHAIN_FILE %CMAKE_TOOLCHAIN_FILE% does not exist
    EXIT
)

@REM Initialize ANDROID_PLATFORM
SET MINSDKVERSION=%ARGV02%
IF DEFINED MINSDKVERSION (
    SET ANDROID_PLATFORM=android-%MINSDKVERSION%
) ELSE (
    SET ANDROID_PLATFORM=android-23
)

@REM Initialize ANDROID_ABIS
SET ANDROID_ABIS=arm64-v8a armeabi-v7a x86 x86_64

@REM Check cmake tools
WHERE /Q cmake
SET IS_CMAKE_EXIST=%ERRORLEVEL%
SET CMAKE_TOOLS=cmake
IF DEFINED ARGV03 (
    SET CMAKE_TOOLS=%ARGV03%/bin/cmake.exe
) ELSE IF %IS_CMAKE_EXIST% == 1 (
    SET CMAKE_TOOLS=E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe
)
IF NOT %CMAKE_TOOLS% == cmake (
    IF NOT EXIST %CMAKE_TOOLS%  (
        ECHO [-] CMAKE_TOOLS %CMAKE_TOOLS% does not exist
        EXIT
    )
)

@REM Echo environment
ECHO [=] CMAKE_TOOLCHAIN_FILE %CMAKE_TOOLCHAIN_FILE%
ECHO [=] ANDROID_PLATFORM %ANDROID_PLATFORM%
ECHO [=] ANDROID_ABIS %ANDROID_ABIS%
ECHO [=] CMAKE_TOOLS %CMAKE_TOOLS%

@REM Build
FOR %%A IN (%ANDROID_ABIS%) DO (
    ECHO [*] Configuration %%A...
    ECHO [=] Execute command %CMAKE_TOOLS% -DCMAKE_TOOLCHAIN_FILE=%CMAKE_TOOLCHAIN_FILE% -DANDROID_PLATFORM=%ANDROID_PLATFORM% -DANDROID_ABI=%%A -S . -B build -G Ninja
    %CMAKE_TOOLS% -DCMAKE_TOOLCHAIN_FILE=%CMAKE_TOOLCHAIN_FILE% -DANDROID_PLATFORM=%ANDROID_PLATFORM% -DANDROID_ABI=%%A -S . -B build -G Ninja
    ECHO [+] Done.

    ECHO [*] Build %%A...
    ECHO [=] Execute command %CMAKE_TOOLS% --build build --config Release
    %CMAKE_TOOLS% --build build --config Release
    ECHO [+] Done.
)

ECHO All libraries build successfully.

ENDLOCAL
</code></pre>
<p>从<a target="_blank" rel="noopener" href="https://archive.org/details/termux-repositories-legacy">官方历史仓库</a>中下载<code>bootstrap-archives-legacy-24.12.2019.tar</code>压缩包，新建一个<code>binary</code>目录并将压缩包解压进去，如图所示</p>
<p><img src="/images/1650222145.jpg" alt="项目结构02"></p>
<p>修改<code>termux-bootstrap-zip.S</code>文件的代码，把<code>.incbin</code>指令指向的文件路径修改为我们自己的路径</p>
<pre><code>    .global blob
    .global blob_size
    .section .rodata
blob:
#if defined __i686__
    .incbin &quot;../binary/bootstrap-archives/bootstrap-i686.zip&quot;
#elif defined __x86_64__
    .incbin &quot;../binary/bootstrap-archives/bootstrap-x86_64.zip&quot;
#elif defined __aarch64__
    .incbin &quot;../binary/bootstrap-archives/bootstrap-aarch64.zip&quot;
#elif defined __arm__
    .incbin &quot;../binary/bootstrap-archives/bootstrap-arm.zip&quot;
#else
# error Unsupported arch
#endif
1:
blob_size:
    .int 1b - blob
</code></pre>
<h3 id="修改虚拟环境"><a href="#修改虚拟环境" class="headerlink" title="修改虚拟环境"></a>修改虚拟环境</h3><p>这里以<code>aarch64</code>为例，其他的操作流程都是一样的，不进行赘述。</p>
<p>我们将<code>bootstrap-aarch64.zip</code>进行解压，然后进入<code>/etc/apt/</code>目录中，把<code>sources.list</code>文件和<code>/etc/apt/sources.list.d</code>目录中的<code>game.list</code> <code>science.list</code>都做一个备份</p>
<p><img src="/images/1650222146.jpg" alt="项目结构03"></p>
<p>然后分别对这三个文件的内容进行修改。</p>
<p>sources.list</p>
<pre><code># The main termux repository:
deb https://bzi-han.github.io/TermuxLegacy/termux-repositories-legacy/webroot/termux-packages stable main
</code></pre>
<p>game.list</p>
<pre><code>deb https://bzi-han.github.io/TermuxLegacy/termux-repositories-legacy/webroot/game-packages-21 games stable
</code></pre>
<p>science.list</p>
<pre><code>deb https://bzi-han.github.io/TermuxLegacy/termux-repositories-legacy/webroot/science-packages-21 science stable
</code></pre>
<p>然后再在<code>/etc/apt/sources.list.d</code>目录添加一个<code>root.list</code></p>
<pre><code>deb https://bzi-han.github.io/TermuxLegacy/termux-repositories-legacy/webroot/termux-root-packages-21 root stable
</code></pre>
<p>修改完成之后再把它打包成<code>bootstrap-aarch64.zip</code>即可。</p>
<h3 id="编译Bootstrap"><a href="#编译Bootstrap" class="headerlink" title="编译Bootstrap"></a>编译Bootstrap</h3><p>编译直接执行前面编写的<code>build.bat</code>文件即可，有3个可选参数分别是</p>
<ol>
<li>Android NDK路径</li>
<li>最低支持的Android SDK版本</li>
<li>CMake路径</li>
</ol>
<p>如果不指定的话则自动判断当前环境以及使用默认值。</p>
<p>运行脚本进行编译，输出</p>
<pre><code>[=] CMAKE_TOOLCHAIN_FILE E:/Android/Ndk/android-ndk-r25b/build/cmake/android.toolchain.cmake
[=] ANDROID_PLATFORM android-23
[=] ANDROID_ABIS arm64-v8a armeabi-v7a x86 x86_64
[=] CMAKE_TOOLS E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe
[*] Configuration arm64-v8a...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe -DCMAKE_TOOLCHAIN_FILE=E:/Android/Ndk/android-ndk-r25b/build/cmake/android.toolchain.cmake -DANDROID_PLATFORM=android-23 -DANDROID_ABI=arm64-v8a -S . -B build -G Ninja
-- The ASM compiler identification is Clang with GNU-like command-line
-- Found assembler: E:/Android/Ndk/android-ndk-r25b/toolchains/llvm/prebuilt/windows-x86_64/bin/clang.exe
-- The C compiler identification is Clang 14.0.6
-- The CXX compiler identification is Clang 14.0.6
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working C compiler: E:/Android/Ndk/android-ndk-r25b/toolchains/llvm/prebuilt/windows-x86_64/bin/clang.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - done
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: E:/Android/Ndk/android-ndk-r25b/toolchains/llvm/prebuilt/windows-x86_64/bin/clang++.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Configuring done
-- Generating done
-- Build files have been written to: D:/TermuxLegacyBootstrap/build
[+] Done.
[*] Build arm64-v8a...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe --build build --config Release
[3/3] Linking C shared library ..\lib\arm64-v8a\libtermux-bootstrap.so
[+] Done.
[*] Configuration armeabi-v7a...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe -DCMAKE_TOOLCHAIN_FILE=E:/Android/Ndk/android-ndk-r25b/build/cmake/android.toolchain.cmake -DANDROID_PLATFORM=android-23 -DANDROID_ABI=armeabi-v7a -S . -B build -G Ninja
-- Configuring done
-- Generating done
-- Build files have been written to: D:/TermuxLegacyBootstrap/build
[+] Done.
[*] Build armeabi-v7a...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe --build build --config Release
[3/3] Linking C shared library ..\lib\armeabi-v7a\libtermux-bootstrap.so
[+] Done.
[*] Configuration x86...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe -DCMAKE_TOOLCHAIN_FILE=E:/Android/Ndk/android-ndk-r25b/build/cmake/android.toolchain.cmake -DANDROID_PLATFORM=android-23 -DANDROID_ABI=x86 -S . -B build -G Ninja
-- Configuring done
-- Generating done
-- Build files have been written to: D:/TermuxLegacyBootstrap/build
[+] Done.
[*] Build x86...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe --build build --config Release
[3/3] Linking C shared library ..\lib\x86\libtermux-bootstrap.so
[+] Done.
[*] Configuration x86_64...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe -DCMAKE_TOOLCHAIN_FILE=E:/Android/Ndk/android-ndk-r25b/build/cmake/android.toolchain.cmake -DANDROID_PLATFORM=android-23 -DANDROID_ABI=x86_64 -S . -B build -G Ninja
-- Configuring done
-- Generating done
-- Build files have been written to: D:/TermuxLegacyBootstrap/build
[+] Done.
[*] Build x86_64...
[=] Execute command E:/Android/Sdk/cmake/3.22.1/bin/cmake.exe --build build --config Release
[3/3] Linking C shared library ..\lib\x86_64\libtermux-bootstrap.so
[+] Done.
All libraries build successfully.
</code></pre>
<p>编译完成后所有的库会生成在目录下的lib文件夹中</p>
<p><img src="/images/1650222147.jpg" alt="项目结构04"></p>
<p>然后就可以进行下一步了。</p>
<h3 id="替换与重打包Apk并进行重新签名"><a href="#替换与重打包Apk并进行重新签名" class="headerlink" title="替换与重打包Apk并进行重新签名"></a>替换与重打包Apk并进行重新签名</h3><p>从<a target="_blank" rel="noopener" href="https://archive.org/details/termux-repositories-legacy">官方历史仓库</a>中下载<code>termux-v0.79-offline-bootstraps.apk</code>文件，用<a target="_blank" rel="noopener" href="https://ibotpeaches.github.io/Apktool/">Apktool</a>给它解包出来出来</p>
<p>执行<code>apktool d termux-v0.79-offline-bootstraps.apk</code></p>
<p><img src="/images/1650222148.jpg" alt="项目结构05"></p>
<p>可以看到有个<code>lib</code>目录，这里面存的就是虚拟环境的那些东西，然后把我们刚才编译出来的<code>lib</code>文件夹直接复制过去并替换掉同样的文件。</p>
<p>完成之后再用<code>apktool b termux-v0.79-offline-bootstraps</code>命令重新打包为Apk即可。</p>
<p>接下来我们对Apk进行重签名，先使用工具生成一个我们自己的密钥，可以参考</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/studio/publish/app-signing?hl=zh-cn#generate-key">生成上传密钥和密钥库</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html">keytool</a></li>
</ul>
<p>这里不进行演示，生成好密钥之后我们需要在Android SDK目录里找到<code>zipalign</code>工具和<code>apksigner.bat</code>脚本，一般情况下路径为<code>$&#123;SDK_PATH&#125;\build-tools\$&#123;SDK_VERSION&#125;\</code>，例如我这里是<code>E:\Android\Sdk\build-tools\33.0.0\</code>。</p>
<ol>
<li>执行<code>zipalign -v 4 termux-v0.79-offline-bootstraps.zip termux-v0.79-offline-bootstraps.apk</code>使Apk的结构对齐。</li>
<li>执行<code>apksigner.bat sign --ks Termux.keystore termux-v0.79-offline-bootstraps.apk</code>对Apk进行重签名，其中<code>Termux.keystore</code>是上面使用工具生成的密钥。</li>
</ol>
<p>签名完成之后<code>termux-v0.79-offline-bootstraps.apk</code>就已经是我们修改好之后的Apk了，在安装好Apk后首次初始化释放的虚拟环境就是对应我们前面修改的虚拟环境。</p>
<h2 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h2><p>以上的所有东西都可以在这两个仓库中找到</p>
<ul>
<li>本项目仓库：<a target="_blank" rel="noopener" href="https://github.com/Bzi-Han/TermuxLegacy">TermuxLegacy</a></li>
<li>Bootstrap项目仓库：<a target="_blank" rel="noopener" href="https://github.com/Bzi-Han/TermuxLegacyBootstrap">TermuxLegacyBootstrap</a></li>
</ul>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>水水水。</p>
<p>那就这样了，有缘再见~</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2022/12/17/%E7%BC%96%E7%A8%8B-%E4%BD%BF%E7%94%A8C++20%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%8D%95-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8/" title="[编程] 使用C++20实现异步任务与单/多线程的协程调度器"><span class="has-text-weight-semibold">下一页: [编程] 使用C++20实现异步任务与单/多线程的协程调度器</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Bzi-Han/bzi-han.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Bzi-Han"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Bzi-Han 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>